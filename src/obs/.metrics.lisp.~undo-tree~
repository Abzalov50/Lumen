(undo-tree-save-format-version . 1)
"cd5c5bf98be8c1895a2acd1811e9785979915702"
[nil nil nil nil (26800 37175 257638 0) 0 nil]
([nil nil ((1 . 5) (t . -1)) nil (26800 37175 257637 0) 0 nil])
([nil nil ((2 . 12) (#("in-" 0 3 (fontified t)) . -2) (undo-tree-id43 . -3) 5) nil (26800 37175 257637 0) 0 nil])
([nil nil ((12 . 13)) nil (26800 37175 257635 0) 0 nil])
([nil nil ((13 . 17)) nil (26800 37175 257635 0) 0 nil])
([nil nil ((17 . 19)) nil (26800 37175 257635 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7060 . 7061) (nil fontified nil 19 . 7061) (19 . 7061)) nil (26800 37175 257634 0) 0 nil])
([nil nil ((#("

;;;; src/obs/metrics.lisp
" 0 1 (fontified t) 1 2 (fontified t) 2 7 (face font-lock-comment-delimiter-face fontified t) 7 28 (face font-lock-comment-face fontified t)) . 17) (undo-tree-id42 . -28)) nil (26800 37175 257634 0) 0 nil])
([nil nil ((17 . 18)) nil (26800 37175 257633 0) 0 nil])
([nil nil ((#("i" 0 1 (fontified t)) . -1561) (undo-tree-id41 . -1) 1562) nil (26800 37175 257632 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . 1561) (#("s" 0 1 (fontified t)) . 1561)) nil (26800 37175 257631 0) 0 nil])
([nil nil ((#("l" 0 1 (fontified t)) . -1560) (undo-tree-id40 . -1) 1561) nil (26800 37175 257630 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . 1560)) nil (26800 37175 257629 0) 0 nil])
([nil nil ((1559 . 1560)) nil (26800 37175 257629 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -1559) (undo-tree-id39 . -1) 1560) nil (26800 37175 257629 0) 0 nil])
([nil nil ((1559 . 1560)) nil (26800 37175 257628 0) 0 nil])
([nil nil ((1561 . 1562)) nil (26800 37175 257627 0) 0 nil])
([nil nil ((1567 . 1568)) nil (26800 37175 257627 0) 0 nil])
([nil nil ((1568 . 1569)) nil (26800 37175 257626 0) 0 nil])
([nil nil ((1572 . 1573)) nil (26800 37175 257626 0) 0 nil])
([nil nil ((1574 . 1575)) nil (26800 37175 257626 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -1574) (undo-tree-id38 . -1) 1575) nil (26800 37175 257625 0) 0 nil])
([nil nil ((1574 . 1575)) nil (26800 37175 257624 0) 0 nil])
([nil nil ((1581 . 1582)) nil (26800 37175 257624 0) 0 nil])
([nil nil ((1582 . 1583)) nil (26800 37175 257624 0) 0 nil])
([nil nil ((1589 . 1590)) nil (26800 37175 257623 0) 0 nil])
([nil nil ((1536 . 1543) (#(" " 0 1 (fontified nil)) . 1535) (undo-tree-id37 . -1) (1536 . 1537)) nil (26800 37175 257623 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -1616) (undo-tree-id36 . -4) 1620) nil (26800 37175 257621 0) 0 nil])
([nil nil ((1616 . 1625)) nil (26800 37175 257620 0) 0 nil])
([nil nil ((309 . 310)) nil (26800 37175 257620 0) 0 nil])
([nil nil ((310 . 320)) nil (26800 37175 257620 0) 0 nil])
([nil nil ((1627 . 1639)) nil (26800 37175 257619 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -1679) (undo-tree-id35 . -4) 1683) nil (26800 37175 257619 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1699 . 1700) (nil fontified nil 1679 . 1700) (1679 . 1700)) nil (26800 37175 257618 0) 0 nil])
([nil nil ((320 . 321)) nil (26800 37175 257617 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 330 . 331) (nil fontified nil 321 . 331) (321 . 331)) nil (26800 37175 257617 0) 0 nil])
([nil nil ((#("g" 0 1 (face font-lock-builtin-face fontified t)) . 328)) nil (26800 37175 257616 0) 0 nil])
([nil nil ((328 . 329)) nil (26800 37175 257616 0) 0 nil])
([nil nil ((#("setf (getf" 0 10 (fontified t)) . -1734) (undo-tree-id33 . -10) (undo-tree-id34 . -10) 1744) nil (26800 37175 257615 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1754 . 1755) (nil fontified nil 1734 . 1755) (1734 . 1755)) nil (26800 37175 257614 0) 0 nil])
([nil nil ((#("g" 0 1 (fontified t)) . -1752) (undo-tree-id32 . -1) 1753) nil (26800 37175 257613 0) 0 nil])
([nil nil ((1752 . 1753)) nil (26800 37175 257612 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . 1765)) nil (26800 37175 257612 0) 0 nil])
([nil nil ((#("setf (getf" 0 10 (fontified t)) . -1811) (undo-tree-id31 . -10) 1821) nil (26800 37175 257611 0) 0 nil])
([nil nil ((nil fontified nil 1831 . 1832) (nil fontified nil 1811 . 1831) (1811 . 1832)) nil (26800 37175 257610 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -1844) (undo-tree-id30 . -1) 1845) nil (26800 37175 257610 0) 0 nil])
([nil nil ((#("list" 0 4 (fontified t)) . -2037) (undo-tree-id29 . -4) 2041) nil (26800 37175 257609 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . 2037)) nil (26800 37175 257608 0) 0 nil])
([nil nil ((2036 . 2037)) nil (26800 37175 257607 0) 0 nil])
([nil nil ((2038 . 2039)) nil (26800 37175 257607 0) 0 nil])
([nil nil ((2044 . 2045)) nil (26800 37175 257606 0) 0 nil])
([nil nil ((2045 . 2046)) nil (26800 37175 257606 0) 0 nil])
([nil nil ((2049 . 2050)) nil (26800 37175 257606 0) 0 nil])
([nil nil ((2051 . 2052)) nil (26800 37175 257605 0) 0 nil])
([nil nil ((2058 . 2059)) nil (26800 37175 257605 0) 0 nil])
([nil nil ((2059 . 2060)) nil (26800 37175 257605 0) 0 nil])
([nil nil ((2062 . 2063)) nil (26800 37175 257604 0) 0 nil])
([nil nil ((2064 . 2069) (#(" " 0 1 (fontified nil)) . 2063) (undo-tree-id28 . -1) (2064 . 2065)) nil (26800 37175 257604 0) 0 nil])
([nil nil ((2069 . 2070)) nil (26800 37175 257603 0) 0 nil])
([nil nil ((2078 . 2079)) nil (26800 37175 257602 0) 0 nil])
([nil nil ((2079 . 2080)) nil (26800 37175 257602 0) 0 nil])
([nil nil ((2081 . 2082)) nil (26800 37175 257602 0) 0 nil])
([nil nil ((2102 . 2109) (#(" " 0 1 (fontified nil)) . 2101) (undo-tree-id27 . -1) (2102 . 2103)) nil (26800 37175 257601 0) 0 nil])
([nil nil ((2121 . 2133) (#(" " 0 1 (fontified nil)) . 2120) (undo-tree-id26 . -1) (2121 . 2122)) nil (26800 37175 257600 0) 0 nil])
([nil nil ((2171 . 2172)) nil (26800 37175 257599 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -2190) (undo-tree-id25 . -4) 2194) nil (26800 37175 257598 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2210 . 2211) (nil fontified nil 2190 . 2211) (2190 . 2211)) nil (26800 37175 257597 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -2238) (undo-tree-id24 . -4) 2242) nil (26800 37175 257597 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2258 . 2259) (nil fontified nil 2238 . 2259) (2238 . 2259)) nil (26800 37175 257595 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -2288) (undo-tree-id23 . -4) 2292) nil (26800 37175 257594 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2308 . 2309) (nil fontified nil 2288 . 2309) (2288 . 2309)) nil (26800 37175 257593 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -2337) (undo-tree-id22 . -4) 2341) nil (26800 37175 257593 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2357 . 2358) (nil fontified nil 2337 . 2358) (2337 . 2358)) nil (26800 37175 257592 0) 0 nil])
([nil nil ((#("setf (" 0 6 (fontified t)) . -2331) (undo-tree-id21 . -6) 2337) nil (26800 37175 257591 0) 0 nil])
([nil nil ((#("g" 0 1 (fontified t)) . -2349) (undo-tree-id20 . -1) 2350) nil (26800 37175 257589 0) 0 nil])
([nil nil ((2349 . 2350)) nil (26800 37175 257588 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -2359) (undo-tree-id19 . -1) 2360) nil (26800 37175 257588 0) 0 nil])
([nil nil ((#("setf (getf" 0 10 (fontified t)) . -2407) (undo-tree-id18 . -10) 2417) nil (26800 37175 257587 0) 0 nil])
([nil nil ((nil fontified nil 2427 . 2428) (nil fontified nil 2407 . 2427) (2407 . 2428)) nil (26800 37175 257586 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -2437) (undo-tree-id17 . -1) 2438) nil (26800 37175 257585 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -2922) (undo-tree-id16 . -4) 2926) nil (26800 37175 257583 0) 0 nil])
([nil nil ((nil fontified nil 2942 . 2943) (nil fontified nil 2922 . 2942) (2922 . 2943)) nil (26800 37175 257582 0) 0 nil])
([nil nil ((2957 . 2964) (#(" " 0 1 (fontified nil)) . 2957) (2956 . 2957)) nil (26800 37175 257581 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -3198) (undo-tree-id15 . -4) 3202) nil (26800 37175 257580 0) 0 nil])
([nil nil ((nil fontified nil 3218 . 3219) (nil fontified nil 3198 . 3218) (3198 . 3219)) nil (26800 37175 257579 0) 0 nil])
([nil nil ((#("getf" 0 1 (fontified t) 1 4 (fontified t)) . -3391) (undo-tree-id14 . -4) 3395) nil (26800 37175 257579 0) 0 nil])
([nil nil ((nil fontified nil 3411 . 3412) (nil fontified nil 3391 . 3411) (3391 . 3412)) nil (26800 37175 257575 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -3487) (undo-tree-id13 . -4) 3491) nil (26800 37175 257574 0) 0 nil])
([nil nil ((nil fontified nil 3507 . 3508) (nil fontified nil 3487 . 3507) (3487 . 3508)) nil (26800 37175 257573 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -4625) (undo-tree-id12 . -4) 4629) nil (26800 37175 257573 0) 0 nil])
([nil nil ((nil fontified nil 4645 . 4646) (nil fontified nil 4625 . 4645) (4625 . 4646)) nil (26800 37175 257572 0) 0 nil])
([nil nil ((4622 . 4629) (#(" " 0 1 (fontified nil)) . 4622) (4621 . 4622)) nil (26800 37175 257571 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -4749) (undo-tree-id11 . -4) 4753) nil (26800 37175 257570 0) 0 nil])
([nil nil ((nil fontified nil 4769 . 4770) (nil fontified nil 4749 . 4769) (4749 . 4770)) nil (26800 37175 257569 0) 0 nil])
([nil nil ((4746 . 4753) (#(" " 0 1 (fontified nil)) . 4745) (undo-tree-id10 . -1) (4746 . 4747)) nil (26800 37175 257568 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -5080) (undo-tree-id9 . -4) 5084) nil (26800 37175 257567 0) 0 nil])
([nil nil ((nil fontified nil 5100 . 5101) (nil fontified nil 5080 . 5100) (5080 . 5101)) nil (26800 37175 257566 0) 0 nil])
([nil nil ((5077 . 5084) (#(" " 0 1 (fontified nil)) . 5076) (undo-tree-id8 . -1) (5077 . 5078)) nil (26800 37175 257565 0) 0 nil])
([nil nil ((#("getf" 0 4 (fontified t)) . -5203) (undo-tree-id7 . -4) 5207) nil (26800 37175 257564 0) 0 nil])
([nil nil ((nil fontified nil 5223 . 5224) (nil fontified nil 5203 . 5223) (5203 . 5224)) nil (26800 37175 257562 0) 0 nil])
([nil nil ((5200 . 5207) (#(" " 0 1 (fontified nil)) . 5199) (undo-tree-id6 . -1) (5200 . 5201)) nil (26800 37175 257562 0) 0 nil])
([nil nil ((#("cdr (assoc" 0 10 (fontified t)) . -5694) (undo-tree-id4 . -10) (undo-tree-id5 . -10) 5704) nil (26800 37175 257559 0) 0 nil])
([nil nil ((nil fontified nil 5714 . 5715) (nil fontified nil 5694 . 5714) (5694 . 5715)) nil (26800 37175 257557 0) 0 nil])
([nil nil ((#("\"content-length\"" 0 16 (face font-lock-string-face fontified t)) . 5716) (undo-tree-id3 . -16) 5732) nil (26800 37175 257557 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -5715) (undo-tree-id1 . -1) (undo-tree-id2 . -1) 5716) nil (26800 37175 257555 0) 0 nil])
([nil nil ((5749 . 5750)) nil (26800 37175 257552 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5765 . 5766) (nil fontified nil 5750 . 5766) (5750 . 5766)) nil (26800 37175 257552 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 5766)) nil (26800 37175 257551 0) 0 nil])
([nil nil ((#("                               :test #'string-equal)))" 0 31 (fontified t) 31 36 (face font-lock-builtin-face fontified t) 36 54 (fontified t)) . 5766)) nil (26800 37175 257550 0) 0 nil])
([nil nil ((5766 . 5768)) nil (26800 37175 257549 0) 0 nil])
([nil nil ((5750 . 5757) (#(" " 0 1 (fontified nil)) . 5750) (undo-tree-id0 . -1) (5749 . 5750)) nil (26800 37175 257546 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -5480) (undo-tree-id44 . -1) (undo-tree-id45 . -1) (undo-tree-id46 . -1) (undo-tree-id47 . -1) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (undo-tree-id50 . -1) (undo-tree-id51 . -1) (undo-tree-id52 . -1) (undo-tree-id53 . -1) 5481 (t 26800 37175 0 0)) nil (26800 37205 601980 0) 0 nil])
([nil nil ((#("defun" 0 5 (face font-lock-keyword-face fontified t)) . -5483) (undo-tree-id23 . -5) 5488 (t 26800 37205 0 0)) nil (26800 38401 883163 0) 0 nil])
([nil nil ((5483 . 5492)) nil (26800 38401 883162 0) 0 nil])
([nil nil ((#("define-mi" 0 9 (face font-lock-keyword-face fontified t)) . -5483) (undo-tree-id0 . -9) (undo-tree-id1 . -9) (undo-tree-id2 . -9) (undo-tree-id3 . -9) (undo-tree-id4 . -5) (undo-tree-id5 . -6) (undo-tree-id6 . -6) (undo-tree-id7 . -6) (undo-tree-id8 . -6) (undo-tree-id9 . -6) (undo-tree-id10 . -6) (undo-tree-id11 . -6) (undo-tree-id12 . -6) (undo-tree-id13 . -6) (undo-tree-id14 . -6) (undo-tree-id15 . -9) (undo-tree-id16 . -9) (undo-tree-id17 . -9) (undo-tree-id18 . -9) (undo-tree-id19 . -9) (undo-tree-id20 . -9) (undo-tree-id21 . -9) (undo-tree-id22 . -9) 5492) nil (26800 38401 883160 0) 0 nil])
([nil nil ((5483 . 5488)) nil (26800 38401 883129 0) 0 nil])
([nil nil ((1061 . 1062) (t 26993 53276 0 0)) nil (26993 61977 590820 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1123 . 1124) (nil fontified nil 1062 . 1124) (1062 . 1124)) nil (26993 61977 590819 0) 0 nil])
([nil nil ((6651 . 6660)) nil (26993 61977 590819 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6935 . 6936) (nil fontified nil 6660 . 6936) (6660 . 6936)) nil (26993 61977 590817 0) 0 nil])
([nil nil ((6889 . 6894) (#("    " 0 4 (fontified t)) . 6889) (6857 . 6862) (#("    " 0 4 (fontified t)) . 6857) (6784 . 6790) (#("                   " 0 19 (fontified t)) . 6784) (6732 . 6735) (#("  " 0 2 (fontified t)) . 6732) (6460 . 6461) (#(" " 0 1 (fontified t)) . 6460) 5545) nil (26993 61977 590812 0) 0 nil])
([nil nil ((#("(in-package :cl)

(defpackage :lumen.obs.metrics
  (:use :cl :alexandria)
  (:import-from :lumen.core.http
    :request :response :req-headers :req-method :req-path :req-query
    :resp-status :resp-headers :resp-body)
  (:import-from :lumen.core.router :defroute)
  (:import-from :lumen.utils :ensure-header :alist-get :alist-set)
  (:import-from :bordeaux-threads :make-lock :with-lock-held)
  (:export :metrics-middleware :install-metrics-route))

(in-package :lumen.obs.metrics)

(defparameter *lock* (make-lock \"metrics-lock\"))

;; petits compteurs/jauges/histogrammes ad hoc (labels minimales pour éviter la cardinalité)
(defparameter *inflight* 0) ; gauge
(defparameter *req-total* (make-hash-table :test 'equal))   ; key: (method status-class)
(defparameter *req-dur*   (make-hash-table :test 'equal))   ; key: method  -> plist (:sum :count :buckets alist)
(defparameter *resp-size* (make-hash-table :test 'equal))   ; key: method  -> plist (:sum :count)
(defparameter *req-size*  (make-hash-table :test 'equal))   ; key: method  -> plist (:sum :count)
(defparameter *req-path-stats* (make-hash-table :test 'equal))
(defparameter *start-time-seconds* (/ (get-universal-time) 1.0)) ; approx. (UTC secs)

(defparameter *duration-buckets*
  ;; seconds (Prometheus histogram)
  #(0.005 0.01 0.025 0.05 0.1 0.25 0.5 1 2.5 5 10))

(defun %status-class (n)
  (let ((d (truncate n 100))) (format nil \"~Dxx\" d)))

(defun %inc! (ht key &optional (delta 1))
  (with-lock-held (*lock*)
    (incf (gethash key ht 0) delta)))

(defun %sum-count! (ht key value)
  (with-lock-held (*lock*)
    (let* ((cell (or (gethash key ht)
		     (setf (gethash key ht) '((:sum . 0.0) (:count . 0)))))
           (sum  (lumen.utils:alist-get cell :sum))
           (cnt  (lumen.utils:alist-get cell :count)))
      (lumen.utils:alist-set cell :sum (+ sum (coerce value 'double-float)))
      (lumen.utils:alist-set cell :count (1+ cnt))
      cell)))

(defun %hist-observe! (ht key seconds)
  (with-lock-held (*lock*)
    (let* ((h (or (gethash key ht)
                  (setf (gethash key ht)
                        `((:sum . 0.0) (:count . 0)
			  (:buckets . ,(mapcar (lambda (b)
						 (cons b 0))
					       (coerce *duration-buckets* 'list)))))))
           (sum (lumen.utils:alist-get h :sum))
           (cnt (lumen.utils:alist-get h :count))
           (bks (lumen.utils:alist-get h :buckets)))
      (lumen.utils:alist-set h :sum (+ sum (coerce seconds 'double-float)))
      (lumen.utils:alist-set h :count (1+ cnt))
      ;; bucket <= le
      (dolist (bk bks)
        (when (<= seconds (car bk)) (incf (cdr bk))))
      ;; +Inf
      (push (cons :inf (1+ (or (cdar (last bks)) 0))) bks)
      h)))

(defun %utf8-length (s)
  (length (trivial-utf-8:string-to-utf-8-bytes s)))

(defun %render-prometheus ()
  (with-output-to-string (s)
    (labels ((pp (fmt &rest args) (apply #'format s fmt args))
             (emit-hist (name method h)
               (let* ((bks (remove :inf (copy-list (lumen.utils:alist-get h :buckets))
				   :key #'car)))
                 (dolist (bk bks)
                   (pp \"~A_bucket{method=\\\"~A\\\",le=\\\"~A\\\"} ~D~%\"
                       name method (car bk) (cdr bk)))
                 ;; +Inf
                 (let ((inf (assoc :inf (lumen.utils:alist-get h :buckets))))
                   (pp \"~A_bucket{method=\\\"~A\\\",le=\\\"+Inf\\\"} ~D~%\" name method (cdr inf)))
                 (pp \"~A_sum{method=\\\"~A\\\"} ~,6F~%\" name method (lumen.utils:alist-get h :sum))
                 (pp \"~A_count{method=\\\"~A\\\"} ~D~%\" name method (lumen.utils:alist-get h :count)))))
      ;; HELP/TYPE
      (pp \"# HELP lumen_http_requests_total Total HTTP requests by method/status class.~%\")
      (pp \"# TYPE lumen_http_requests_total counter~%\")
      (maphash (lambda (k v)
                 (destructuring-bind (m sc) k
                   (pp \"lumen_http_requests_total{method=\\\"~A\\\",status_class=\\\"~A\\\"} ~D~%\" m sc v)))
               *req-total*)

      (pp \"# HELP lumen_http_inflight_requests In-flight HTTP requests.~%\")
      (pp \"# TYPE lumen_http_inflight_requests gauge~%\")
      (pp \"lumen_http_inflight_requests ~D~%\" (with-lock-held (*lock*) *inflight*))

      (pp \"# HELP lumen_http_request_duration_seconds Request duration histogram.~%\")
      (pp \"# TYPE lumen_http_request_duration_seconds histogram~%\")
      (maphash (lambda (m h) (emit-hist \"lumen_http_request_duration_seconds\" m h)) *req-dur*)

      (pp \"# HELP lumen_http_response_size_bytes Response size bytes (sum/count).~%\")
      (pp \"# TYPE lumen_http_response_size_bytes summary~%\")
      (maphash (lambda (m cell)
                 (pp \"lumen_http_response_size_bytes_sum{method=\\\"~A\\\"} ~,0F~%\"
		     m (lumen.utils:alist-get cell :sum))
                 (pp \"lumen_http_response_size_bytes_count{method=\\\"~A\\\"} ~D~%\"
		     m (lumen.utils:alist-get cell :count)))
               *resp-size*)

      (pp \"# HELP lumen_http_request_size_bytes Request size bytes (sum/count).~%\")
      (pp \"# TYPE lumen_http_request_size_bytes summary~%\")
      (maphash (lambda (m cell)
                 (pp \"lumen_http_request_size_bytes_sum{method=\\\"~A\\\"} ~,0F~%\"
		     m (lumen.utils:alist-get cell :sum))
                 (pp \"lumen_http_request_size_bytes_count{method=\\\"~A\\\"} ~D~%\"
		     m (lumen.utils:alist-get cell :count)))
               *req-size*)

      (pp \"# HELP process_start_time_seconds UNIX time the process started.~%\")
      (pp \"# TYPE process_start_time_seconds gauge~%\")
      (pp \"process_start_time_seconds ~,3F~%\" *start-time-seconds*))))

(defun metrics-middleware (next)
  \"Compteur + histogramme durée + in-flight gauge + tailles.\"
  (lambda (req)
    (let* ((method (string-upcase (or (lumen.core.http:req-method req) \"GET\")))
           (clen   (lumen.utils:alist-get (lumen.core.http:req-headers req)
					  \"content-length\"))
           (req-bytes (when clen (parse-integer clen :junk-allowed t)))
           (t0 (get-internal-real-time)))
      (with-lock-held (*lock*) (incf *inflight*))
      (unwind-protect
           (let ((resp (funcall next req)))
             ;; post
             (let* ((status (lumen.core.http:resp-status resp))
                    (body   (lumen.core.http:resp-body resp))
                    (resp-bytes
                      (cond
                        ((stringp body) (%utf8-length body))
                        ((typep body '(simple-array (unsigned-byte 8) (*))) (length body))
                        (t nil)))	; streaming inconnu
                    (ms (/ (- (get-internal-real-time) t0)
                           (/ internal-time-units-per-second 1000.0)))
                    (sec (/ ms 1000.0)))
	       (let ((key (format nil \"~A ~A\" method (lumen.core.http:req-path req))))
		 (let ((entry (or (gethash key *req-path-stats*) 
				  (setf (gethash key *req-path-stats*) (list :count 0 :sum-ms 0)))))
		   (incf (getf entry :count))
		   (incf (getf entry :sum-ms) ms)))
               (%inc! *req-total* (list method (%status-class status)) 1)
               (%hist-observe! *req-dur* method sec)
               (when resp-bytes (%sum-count! *resp-size* method resp-bytes))
               (when req-bytes  (%sum-count! *req-size*  method req-bytes))
               resp))
        (with-lock-held (*lock*) (decf *inflight*))))))

(defun install-metrics-route ()
  \"Expose /metrics en texte Prometheus.\"
  (defroute GET \"/metrics\" (req)
    (declare (ignore req))
    (make-instance 'lumen.core.http:response
                   :status 200
                   :headers '((\"Content-Type\" . \"text/plain; version=0.0.4; charset=utf-8\")
                              (\"Cache-Control\" . \"no-store\"))
                   :body (%render-prometheus))))
" 0 1 (fontified t) 1 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 15 (face font-lock-builtin-face fontified t) 15 19 (fontified t) 19 29 (face font-lock-keyword-face fontified t) 29 30 (fontified t) 30 48 (face font-lock-type-face fontified t) 48 52 (fontified t) 52 56 (face font-lock-builtin-face fontified t) 56 57 (fontified t) 57 60 (face font-lock-builtin-face fontified t) 60 61 (fontified t) 61 72 (face font-lock-builtin-face fontified t) 72 77 (fontified t) 77 89 (face font-lock-builtin-face fontified t) 89 90 (fontified t) 90 106 (face font-lock-builtin-face fontified t) 106 111 (fontified t) 111 119 (face font-lock-builtin-face fontified t) 119 120 (fontified t) 120 129 (face font-lock-builtin-face fontified t) 129 130 (fontified t) 130 142 (face font-lock-builtin-face fontified t) 142 143 (fontified t) 143 154 (face font-lock-builtin-face fontified t) 154 155 (fontified t) 155 164 (face font-lock-builtin-face fontified t) 164 165 (fontified t) 165 175 (face font-lock-builtin-face fontified t) 175 180 (fontified t) 180 192 (face font-lock-builtin-face fontified t) 192 193 (fontified t) 193 206 (face font-lock-builtin-face fontified t) 206 207 (fontified t) 207 217 (face font-lock-builtin-face fontified t) 217 222 (fontified t) 222 234 (face font-lock-builtin-face fontified t) 234 235 (fontified t) 235 253 (face font-lock-builtin-face fontified t) 253 254 (fontified t) 254 263 (face font-lock-builtin-face fontified t) 263 268 (fontified t) 268 280 (face font-lock-builtin-face fontified t) 280 281 (fontified t) 281 293 (face font-lock-builtin-face fontified t) 293 294 (fontified t) 294 308 (face font-lock-builtin-face fontified t) 308 309 (fontified t) 309 319 (face font-lock-builtin-face fontified t) 319 320 (fontified t) 320 330 (face font-lock-builtin-face fontified t) 330 335 (fontified t) 335 347 (face font-lock-builtin-face fontified t) 347 348 (fontified t) 348 365 (face font-lock-builtin-face fontified t) 365 366 (fontified t) 366 376 (face font-lock-builtin-face fontified t) 376 377 (fontified t) 377 392 (face font-lock-builtin-face fontified t) 392 397 (fontified t) 397 404 (face font-lock-builtin-face fontified t) 404 405 (fontified t) 405 424 (face font-lock-builtin-face fontified t) 424 425 (fontified t) 425 447 (face font-lock-builtin-face fontified t) 447 452 (fontified t) 452 462 (face font-lock-keyword-face fontified t) 462 463 (fontified t) 463 481 (face font-lock-builtin-face fontified t) 481 485 (fontified t) 485 497 (face font-lock-keyword-face fontified t) 497 498 (fontified t) 498 504 (face font-lock-variable-name-face fontified t) 504 516 (fontified t) 516 530 (face font-lock-string-face fontified t) 530 534 (fontified t) 534 537 (face font-lock-comment-delimiter-face fontified t) 537 627 (face font-lock-comment-face fontified t) 627 628 (fontified t) 628 640 (face font-lock-keyword-face fontified t) 640 641 (fontified t) 641 651 (face font-lock-variable-name-face fontified t) 651 655 (fontified t) 655 663 (face font-lock-comment-face fontified t) 663 664 (fontified t) 664 676 (face font-lock-keyword-face fontified t) 676 677 (fontified t) 677 688 (face font-lock-variable-name-face fontified t) 688 706 (fontified t) 706 711 (face font-lock-builtin-face fontified t) 711 723 (fontified t) 723 752 (face font-lock-comment-face fontified t) 752 753 (fontified t) 753 765 (face font-lock-keyword-face fontified t) 765 766 (fontified t) 766 775 (face font-lock-variable-name-face fontified t) 775 795 (fontified t) 795 800 (face font-lock-builtin-face fontified t) 800 812 (fontified t) 812 865 (face font-lock-comment-face fontified t) 865 866 (fontified t) 866 878 (face font-lock-keyword-face fontified t) 878 879 (fontified t) 879 890 (face font-lock-variable-name-face fontified t) 890 908 (fontified t) 908 913 (face font-lock-builtin-face fontified t) 913 925 (fontified t) 925 963 (face font-lock-comment-face fontified t) 963 964 (fontified t) 964 976 (face font-lock-keyword-face fontified t) 976 977 (fontified t) 977 987 (face font-lock-variable-name-face fontified t) 987 1006 (fontified t) 1006 1011 (face font-lock-builtin-face fontified t) 1011 1023 (fontified t) 1023 1061 (face font-lock-comment-face fontified t) 1061 1062 (fontified t) 1062 1074 (face font-lock-keyword-face fontified t) 1074 1075 (fontified t) 1075 1091 (face font-lock-variable-name-face fontified t) 1091 1109 (fontified t) 1109 1114 (face font-lock-builtin-face fontified t) 1114 1125 (fontified t) 1125 1137 (face font-lock-keyword-face fontified t) 1137 1138 (fontified t) 1138 1158 (face font-lock-variable-name-face fontified t) 1158 1189 (fontified t) 1189 1210 (face font-lock-comment-face fontified t) 1210 1212 (fontified t) 1212 1224 (face font-lock-keyword-face fontified t) 1224 1225 (fontified t) 1225 1243 (face font-lock-variable-name-face fontified t) 1243 1246 (fontified t) 1246 1249 (face font-lock-comment-delimiter-face fontified t) 1249 1280 (face font-lock-comment-face fontified t) 1280 1334 (fontified t) 1334 1339 (face font-lock-keyword-face fontified t) 1339 1340 (fontified t) 1340 1353 (face font-lock-function-name-face fontified t) 1353 1361 (fontified t) 1361 1364 (face font-lock-keyword-face fontified t) 1364 1400 (fontified t) 1400 1406 (face font-lock-string-face fontified t) 1406 1414 (fontified t) 1414 1419 (face font-lock-keyword-face fontified t) 1419 1420 (fontified t) 1420 1425 (face font-lock-function-name-face fontified t) 1425 1434 (fontified t) 1434 1443 (face font-lock-type-face fontified t) 1443 1458 (fontified t) 1458 1472 (face font-lock-keyword-face fontified t) 1472 1500 (fontified t) 1500 1520 (fontified t) 1520 1522 (fontified t) 1522 1527 (face font-lock-keyword-face fontified t) 1527 1528 (fontified t) 1528 1539 (face font-lock-function-name-face fontified t) 1539 1558 (fontified t) 1558 1572 (face font-lock-keyword-face fontified t) 1572 1587 (fontified t) 1587 1591 (face font-lock-keyword-face fontified t) 1591 1653 (fontified t) 1653 1657 (face font-lock-builtin-face fontified t) 1657 1666 (fontified t) 1666 1672 (face font-lock-builtin-face fontified t) 1672 1727 (fontified t) 1727 1731 (face font-lock-builtin-face fontified t) 1731 1779 (fontified t) 1779 1785 (face font-lock-builtin-face fontified t) 1785 1823 (fontified t) 1823 1827 (face font-lock-builtin-face fontified t) 1827 1900 (fontified t) 1900 1906 (face font-lock-builtin-face fontified t) 1906 1933 (fontified t) 1933 1938 (face font-lock-keyword-face fontified t) 1938 1939 (fontified t) 1939 1953 (face font-lock-function-name-face fontified t) 1953 1974 (fontified t) 1974 1988 (face font-lock-keyword-face fontified t) 1988 2003 (fontified t) 2003 2007 (face font-lock-keyword-face fontified t) 2007 2101 (fontified t) 2101 2105 (face font-lock-builtin-face fontified t) 2105 2114 (fontified t) 2114 2120 (face font-lock-builtin-face fontified t) 2120 2132 (fontified t) 2132 2140 (face font-lock-builtin-face fontified t) 2140 2153 (fontified t) 2153 2159 (face font-lock-keyword-face fontified t) 2159 2276 (fontified t) 2276 2280 (face font-lock-builtin-face fontified t) 2280 2324 (fontified t) 2324 2330 (face font-lock-builtin-face fontified t) 2330 2374 (fontified t) 2374 2382 (face font-lock-builtin-face fontified t) 2382 2417 (fontified t) 2417 2421 (face font-lock-builtin-face fontified t) 2421 2493 (fontified t) 2493 2499 (face font-lock-builtin-face fontified t) 2499 2516 (fontified t) 2516 2519 (face font-lock-comment-delimiter-face fontified t) 2519 2532 (face font-lock-comment-face fontified t) 2532 2539 (fontified t) 2539 2545 (face font-lock-keyword-face fontified t) 2545 2564 (fontified t) 2564 2568 (face font-lock-keyword-face fontified t) 2568 2615 (fontified t) 2615 2618 (face font-lock-comment-delimiter-face fontified t) 2618 2623 (face font-lock-comment-face fontified t) 2623 2641 (fontified t) 2641 2645 (face font-lock-builtin-face fontified t) 2645 2695 (fontified t) 2695 2700 (face font-lock-keyword-face fontified t) 2700 2701 (fontified t) 2701 2713 (face font-lock-function-name-face fontified t) 2713 2771 (fontified t) 2771 2772 (fontified t) 2772 2777 (face font-lock-keyword-face fontified t) 2777 2778 (fontified t) 2778 2796 (face font-lock-function-name-face fontified t) 2796 2803 (fontified t) 2803 2824 (face font-lock-keyword-face fontified t) 2824 2834 (fontified t) 2834 2840 (face font-lock-keyword-face fontified t) 2840 2851 (fontified t) 2851 2856 (face font-lock-type-face fontified t) 2856 2948 (fontified t) 2948 2952 (face font-lock-keyword-face fontified t) 2952 2967 (fontified t) 2967 2971 (face font-lock-builtin-face fontified t) 2971 3008 (fontified t) 3008 3016 (face font-lock-builtin-face fontified t) 3016 3020 (fontified t) 3020 3026 (fontified t) 3026 3030 (face font-lock-builtin-face fontified t) 3030 3040 (fontified t) 3040 3058 (fontified t) 3058 3064 (face font-lock-keyword-face fontified t) 3064 3097 (fontified t) 3097 3138 (face font-lock-string-face fontified t) 3138 3211 (fontified t) 3211 3214 (face font-lock-comment-delimiter-face fontified t) 3214 3219 (face font-lock-comment-face fontified t) 3219 3237 (fontified t) 3237 3240 (face font-lock-keyword-face fontified t) 3240 3254 (fontified t) 3254 3258 (face font-lock-builtin-face fontified t) 3258 3284 (fontified t) 3284 3292 (face font-lock-builtin-face fontified t) 3292 3320 (fontified t) 3320 3363 (face font-lock-string-face fontified t) 3363 3409 (fontified t) 3409 3439 (face font-lock-string-face fontified t) 3439 3477 (fontified t) 3477 3481 (face font-lock-builtin-face fontified t) 3481 3505 (fontified t) 3505 3535 (face font-lock-string-face fontified t) 3535 3573 (fontified t) 3573 3579 (face font-lock-builtin-face fontified t) 3579 3591 (fontified t) 3591 3594 (face font-lock-comment-delimiter-face fontified t) 3594 3604 (face font-lock-comment-face fontified t) 3604 3614 (fontified t) 3614 3694 (face font-lock-string-face fontified t) 3694 3706 (fontified t) 3706 3750 (face font-lock-string-face fontified t) 3750 3768 (fontified t) 3768 3774 (face font-lock-keyword-face fontified t) 3774 3799 (fontified t) 3799 3817 (face font-lock-keyword-face fontified t) 3817 3850 (fontified t) 3850 3917 (face font-lock-string-face fontified t) 3917 3967 (fontified t) 3967 4031 (face font-lock-string-face fontified t) 4031 4043 (fontified t) 4043 4088 (face font-lock-string-face fontified t) 4088 4100 (fontified t) 4100 4135 (face font-lock-string-face fontified t) 4135 4137 (fontified t) 4137 4151 (face font-lock-keyword-face fontified t) 4151 4185 (fontified t) 4185 4259 (face font-lock-string-face fontified t) 4259 4271 (fontified t) 4271 4327 (face font-lock-string-face fontified t) 4327 4345 (fontified t) 4345 4351 (face font-lock-keyword-face fontified t) 4351 4369 (fontified t) 4369 4406 (face font-lock-string-face fontified t) 4406 4435 (fontified t) 4435 4509 (face font-lock-string-face fontified t) 4509 4521 (fontified t) 4521 4540 (face font-lock-string-face fontified t) 4540 4570 (face font-lock-string-face fontified t) 4570 4572 (fontified t) 4572 4588 (fontified t) 4588 4594 (face font-lock-keyword-face fontified t) 4594 4625 (fontified t) 4625 4683 (face font-lock-string-face fontified t) 4683 4721 (fontified t) 4721 4725 (face font-lock-builtin-face fontified t) 4725 4749 (fontified t) 4749 4807 (face font-lock-string-face fontified t) 4807 4845 (fontified t) 4845 4851 (face font-lock-builtin-face fontified t) 4851 4894 (fontified t) 4894 4966 (face font-lock-string-face fontified t) 4966 4978 (fontified t) 4978 5026 (face font-lock-string-face fontified t) 5026 5044 (fontified t) 5044 5050 (face font-lock-keyword-face fontified t) 5050 5081 (fontified t) 5081 5138 (face font-lock-string-face fontified t) 5138 5176 (fontified t) 5176 5180 (face font-lock-builtin-face fontified t) 5180 5204 (fontified t) 5204 5261 (face font-lock-string-face fontified t) 5261 5299 (fontified t) 5299 5305 (face font-lock-builtin-face fontified t) 5305 5347 (fontified t) 5347 5415 (face font-lock-string-face fontified t) 5415 5427 (fontified t) 5427 5470 (face font-lock-string-face fontified t) 5470 5482 (fontified t) 5482 5517 (face font-lock-string-face fontified t) 5517 5544 (fontified t) 5544 5545 (fontified t) 5545 5550 (face font-lock-keyword-face fontified t) 5550 5551 (fontified t) 5551 5569 (face font-lock-function-name-face fontified t) 5569 5579 (fontified t) 5579 5638 (face font-lock-doc-face fontified t) 5638 5642 (fontified t) 5642 5648 (face font-lock-keyword-face fontified t) 5648 5660 (fontified t) 5660 5664 (face font-lock-keyword-face fontified t) 5664 5726 (fontified t) 5726 5731 (face font-lock-string-face fontified t) 5731 5818 (fontified t) 5818 5834 (face font-lock-string-face fontified t) 5834 5860 (fontified t) 5860 5864 (face font-lock-keyword-face fontified t) 5864 5890 (fontified t) 5890 5903 (face font-lock-builtin-face fontified t) 5903 5958 (fontified t) 5958 5972 (face font-lock-keyword-face fontified t) 5972 6008 (fontified t) 6008 6022 (face font-lock-keyword-face fontified t) 6022 6035 (fontified t) 6035 6038 (face font-lock-keyword-face fontified t) 6038 6072 (fontified t) 6072 6080 (fontified t) 6080 6083 (face font-lock-comment-delimiter-face fontified t) 6083 6088 (face font-lock-comment-face fontified t) 6088 6102 (fontified t) 6102 6106 (face font-lock-keyword-face fontified t) 6106 6269 (fontified t) 6269 6273 (face font-lock-keyword-face fontified t) 6273 6460 (fontified t) 6460 6480 (face font-lock-comment-face fontified t) 6480 6660 (fontified t) 6660 6663 (face font-lock-keyword-face fontified t) 6663 6682 (fontified t) 6682 6689 (face font-lock-string-face fontified t) 6689 6735 (fontified t) 6735 6738 (face font-lock-keyword-face fontified t) 6738 6832 (fontified t) 6832 6838 (face font-lock-builtin-face fontified t) 6838 6841 (fontified t) 6841 6848 (face font-lock-builtin-face fontified t) 6848 6879 (fontified t) 6879 6885 (face font-lock-builtin-face fontified t) 6885 6911 (fontified t) 6911 6918 (face font-lock-builtin-face fontified t) 6918 7069 (fontified t) 7069 7073 (face font-lock-keyword-face fontified t) 7073 7146 (fontified t) 7146 7150 (face font-lock-keyword-face fontified t) 7150 7237 (fontified t) 7237 7251 (face font-lock-keyword-face fontified t) 7251 7285 (fontified t) 7285 7286 (fontified t) 7286 7291 (face font-lock-keyword-face fontified t) 7291 7292 (fontified t) 7292 7313 (face font-lock-function-name-face fontified t) 7313 7319 (fontified t) 7319 7357 (face font-lock-doc-face fontified t) 7357 7374 (fontified t) 7374 7384 (face font-lock-string-face fontified t) 7384 7396 (fontified t) 7396 7403 (face font-lock-keyword-face fontified t) 7403 7482 (fontified t) 7482 7489 (face font-lock-builtin-face fontified t) 7489 7513 (fontified t) 7513 7521 (face font-lock-builtin-face fontified t) 7521 7525 (fontified t) 7525 7539 (face font-lock-string-face fontified t) 7539 7542 (fontified t) 7542 7584 (face font-lock-string-face fontified t) 7584 7588 (fontified t) 7588 7617 (fontified t) 7617 7632 (face font-lock-string-face fontified t) 7632 7635 (fontified t) 7635 7645 (face font-lock-string-face fontified t) 7645 7648 (fontified t) 7648 7667 (fontified t) 7667 7672 (face font-lock-builtin-face fontified t) 7672 7697 (fontified t)) . 1) (undo-tree-id0 . -547) (undo-tree-id1 . -7697) (t 26993 61977 0 0)) nil (26996 28293 445801 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7625 . 7626) (nil fontified nil 1 . 7626) (1 . 7626)) nil (26996 28293 445786 0) 0 nil])
([nil nil ((7626 . 7627) 518) nil (26996 28293 445782 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 5518) (t 26996 28293 0 0)) nil (26997 4079 698296 0) 0 nil])
([nil nil ((5518 . 5519)) nil (26997 4079 698295 0) 0 nil])
([nil nil ((#("(defun metrics-middleware (next)
  \"Compteur + histogramme durée + in-flight gauge + tailles + per-path stats.\"
  (lambda (req)
    (let* ((method (string-upcase (or (lumen.core.http:req-method req) \"GET\")))
           (path   (lumen.core.http:req-path req)) ;; TODO: Idéalement utiliser le route-pattern
           (clen   (lumen.utils:alist-get (lumen.core.http:req-headers req) \"content-length\"))
           (req-bytes (when clen (parse-integer clen :junk-allowed t)))
           (t0 (get-internal-real-time)))
      
      (with-lock-held (*lock*) (incf *inflight*))
      
      (unwind-protect
           (let ((resp (funcall next req)))
             (let* ((status (lumen.core.http:resp-status resp))
                    (body   (lumen.core.http:resp-body resp))
                    (resp-bytes
                      (cond
                        ((stringp body) (%utf8-length body))
                        ((typep body '(simple-array (unsigned-byte 8) (*))) (length body))
                        (t nil)))
                    (ms (/ (- (get-internal-real-time) t0)
                           (/ internal-time-units-per-second 1000.0)))
                    (sec (/ ms 1000.0))
                    ;; Détection erreur (5xx)
                    (is-error (>= status 500)))

               ;; 1. Mise à jour stats globales (Prometheus)
               (%inc! *req-total* (list method (%status-class status)) 1)
               (%hist-observe! *req-dur* method sec)
               (when resp-bytes (%sum-count! *resp-size* method resp-bytes))
               (when req-bytes  (%sum-count! *req-size* method req-bytes))

               ;; 2. Mise à jour stats par route (Inspecteur)
               (%record-path-stats! method path ms is-error)
               
               resp))
        ;; Cleanup
        (with-lock-held (*lock*) (decf *inflight*))))))" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 25 (face font-lock-function-name-face fontified t) 25 35 (fontified t) 35 111 (face font-lock-doc-face fontified t) 111 115 (fontified t) 115 121 (face font-lock-keyword-face fontified t) 121 133 (fontified t) 133 137 (face font-lock-keyword-face fontified t) 137 199 (fontified t) 199 204 (face font-lock-string-face fontified t) 204 259 (fontified t) 259 262 (face font-lock-comment-delimiter-face fontified t) 262 305 (face font-lock-comment-face fontified t) 305 381 (fontified t) 381 397 (face font-lock-string-face fontified t) 397 423 (fontified t) 423 427 (face font-lock-keyword-face fontified t) 427 453 (fontified t) 453 466 (face font-lock-builtin-face fontified t) 466 528 (fontified t) 528 542 (face font-lock-keyword-face fontified t) 542 585 (fontified t) 585 599 (face font-lock-keyword-face fontified t) 599 612 (fontified t) 612 615 (face font-lock-keyword-face fontified t) 615 658 (fontified t) 658 662 (face font-lock-keyword-face fontified t) 662 825 (fontified t) 825 829 (face font-lock-keyword-face fontified t) 829 902 (fontified t) 902 982 (fontified t) 982 1206 (fontified t) 1206 1209 (face font-lock-comment-delimiter-face fontified t) 1209 1232 (face font-lock-comment-face fontified t) 1232 1296 (fontified t) 1296 1299 (face font-lock-comment-delimiter-face fontified t) 1299 1342 (face font-lock-comment-face fontified t) 1342 1485 (fontified t) 1485 1489 (face font-lock-keyword-face fontified t) 1489 1562 (fontified t) 1562 1566 (face font-lock-keyword-face fontified t) 1566 1637 (fontified t) 1637 1640 (face font-lock-comment-delimiter-face fontified t) 1640 1684 (face font-lock-comment-face fontified t) 1684 1791 (fontified t) 1791 1794 (face font-lock-comment-delimiter-face fontified t) 1794 1802 (face font-lock-comment-face fontified t) 1802 1811 (fontified t) 1811 1825 (face font-lock-keyword-face fontified t) 1825 1857 (fontified t)) . -3661) (undo-tree-id0 . -1857) (undo-tree-id1 . -982) 5518) nil (26997 4079 698294 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6312 . 6313) (nil fontified nil 3661 . 6313) (3661 . 6313)) nil (26997 4079 698280 0) 0 nil])
([nil nil ((394 . 397)) nil (26997 4079 698279 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 431 . 432) (nil fontified nil 397 . 432) (397 . 432)) nil (26997 4079 698279 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 411 . 412) (nil fontified nil 411 . 412) (nil fontified nil 410 . 411) (nil fontified nil 398 . 410) (nil fontified nil 397 . 398) (397 . 412)) nil (26997 4079 698278 0) 0 nil])
([nil nil ((447 . 448)) nil (26997 4079 698276 0) 0 nil])
([nil nil ((433 . 434)) nil (26997 4079 698272 0) 0 nil])
([nil nil ((3956 . 3958) (t 26997 4079 0 0)) nil (26998 5729 882142 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4215 . 4216) (nil fontified nil 3958 . 4216) (3958 . 4216)) nil (26998 5729 882141 0) 0 nil])
([nil nil ((3778 . 3779)) nil (26998 5729 882140 0) 0 nil])
([nil nil ((3779 . 3781)) nil (26998 5729 882139 0) 0 nil])
([nil current ((3960 . 3962)) nil (26998 5729 882135 0) 0 nil])
nil
