(undo-tree-save-format-version . 1)
"5c41568dd8b1038eb2a0b9e509764bd258f72443"
[nil nil nil nil (26806 46357 496849 0) 0 nil]
([nil nil ((nil rear-nonsticky nil 9310 . 9311) (nil fontified nil 1 . 9311) (1 . 9311) (t . -1)) nil (26806 46357 496848 0) 0 nil])
([nil nil ((47 . 51)) nil (26806 46357 496847 0) 0 nil])
([nil nil ((#("e" 0 1 (face font-lock-type-face fontified t)) . -50) (undo-tree-id4 . -1) 51) nil (26806 46357 496846 0) 0 nil])
([nil nil ((50 . 52)) nil (26806 46357 496844 0) 0 nil])
([nil nil ((856 . 861)) nil (26806 46357 496844 0) 0 nil])
([nil nil ((#("-" 0 1 (face font-lock-type-face fontified t)) . -47) (undo-tree-id2 . -1) (undo-tree-id3 . -1) 48) nil (26806 46357 496843 0) 0 nil])
([nil nil ((47 . 48)) nil (26806 46357 496841 0) 0 nil])
([nil nil ((#("-" 0 1 (face font-lock-builtin-face fontified t)) . -856) (undo-tree-id0 . -1) (undo-tree-id1 . -1) 857) nil (26806 46357 496839 0) 0 nil])
([nil nil ((856 . 857)) nil (26806 46357 496824 0) 0 nil])
([nil nil ((1731 . 1741) (#(" " 0 1 (fontified nil)) . 1730) (undo-tree-id5 . -1) (1731 . 1732) (t 26806 46357 0 0)) nil (26806 53567 733801 0) 0 nil])
([nil nil ((1 . 6) (t 26806 53567 0 0)) nil (26806 55129 781433 0) 0 nil])
([nil nil ((#("r" 0 1 (fontified t)) . -1) (undo-tree-id0 . -1) (#("e" 0 1 (fontified t)) . -2) (undo-tree-id1 . -1) (#("p" 0 1 (fontified t)) . -3) (undo-tree-id2 . -1) (#("o" 0 1 (fontified t)) . -4) (undo-tree-id3 . -1) (#("-" 0 1 (fontified t)) . -5) (undo-tree-id4 . -1) 6) nil (26806 55129 781431 0) 0 nil])
([nil nil ((6173 . 6175)) nil (26806 55129 781418 0) 0 nil])
([nil nil ((6175 . 6176)) nil (26806 55129 781418 0) 0 nil])
([nil nil ((6207 . 6208)) nil (26806 55129 781417 0) 0 nil])
([nil nil ((6208 . 6210)) nil (26806 55129 781413 0) 0 nil])
([nil nil ((7308 . 7309) (t 26806 55129 0 0)) nil (26806 55218 739910 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7315 . 7316) (nil fontified nil 7309 . 7316) (7309 . 7316)) nil (26806 58422 936426 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1420 . 1421) (nil fontified nil 1420 . 1421) (nil fontified nil 1419 . 1420) (nil fontified nil 1414 . 1419) (nil fontified nil 1406 . 1414) (nil fontified nil 1405 . 1406) (nil fontified nil 1404 . 1405) (nil fontified nil 1384 . 1404) (nil fontified nil 1383 . 1384) (1383 . 1421) (t 26806 55218 0 0)) nil (26807 801 302382 0) 0 nil] [nil nil ((nil rear-nonsticky nil 1424 . 1425) (nil fontified nil 1424 . 1425) (nil fontified nil 1414 . 1424) (nil fontified nil 1409 . 1414) (nil fontified nil 1397 . 1409) (nil fontified nil 1396 . 1397) (nil fontified nil 1384 . 1396) (nil fontified nil 1383 . 1384) (1383 . 1425) (t 26806 55218 0 0)) ((#("(:import-from :lumen.utils
    :alist-get)" 0 1 (fontified nil) 1 13 (face font-lock-builtin-face fontified nil) 13 14 (fontified nil) 14 26 (face font-lock-builtin-face fontified nil) 26 27 (fontified nil) 27 31 (fontified nil) 31 41 (face font-lock-builtin-face fontified nil) 41 42 (rear-nonsticky nil fontified nil)) . 1383) (undo-tree-id24 . -42) (undo-tree-id25 . -8) (undo-tree-id26 . -8) (undo-tree-id27 . -27) (undo-tree-id28 . -27) (nil fontified t 1409 . 1410) (nil rear-nonsticky t 1424 . 1425)) (26806 58422 570949 0) 0 nil] [nil nil ((#("(cdr (assoc :scopes jwt)) (cdr (assoc \"scopes\" jwt))" 0 12 (fontified t) 12 19 (face font-lock-builtin-face fontified t) 19 38 (fontified t) 38 46 (face font-lock-string-face fontified t) 46 52 (fontified t)) . -1383) (undo-tree-id5 . -52) (undo-tree-id6 . -52) (undo-tree-id7 . -52) (undo-tree-id8 . -52) (undo-tree-id9 . -52) (undo-tree-id10 . -52) (undo-tree-id11 . -52) (undo-tree-id12 . -52) (undo-tree-id13 . -52) (undo-tree-id14 . -52) (undo-tree-id15 . -52) (undo-tree-id16 . -52) (undo-tree-id17 . -52) (undo-tree-id18 . -52) 1435 (t 26806 55218 0 0)) ((1383 . 1435)) (26806 58349 450752 0) 0 nil])
([nil nil ((1421 . 1422)) nil (26807 801 302380 0) 0 nil])
([nil nil ((1425 . 1426)) ((#(" " 0 1 (fontified t)) . 1425)) (26806 58422 570905 0) 0 nil])
([nil nil ((nil fontified nil 1403 . 1404) (nil fontified nil 1383 . 1403) (1383 . 1404)) ((#("lumen.utils:alist-get" 0 20 (fontified nil slime-repl-old-input 10) 20 21 (fontified nil rear-nonsticky t slime-repl-old-input 10)) . 1383) (undo-tree-id23 . -21) (nil fontified t 1403 . 1404)) (26806 58349 246095 0) 0 nil])
([nil nil ((#("email" 0 4 (face font-lock-builtin-face fontified t) 4 5 (face font-lock-builtin-face fontified t rear-nonsticky t)) . -1415) (undo-tree-id31 . -5) 1420) nil (26807 801 302380 0) 0 nil])
nil
([nil nil ((1404 . 1405)) ((#(" " 0 1 (fontified t)) . 1404) (undo-tree-id22 . -1)) (26806 58349 51438 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1420 . 1421) (nil fontified nil 1415 . 1421) (1415 . 1421)) nil (26807 801 302378 0) 0 nil])
([nil nil ((1405 . 1408)) ((#("jwt" 0 3 (fontified t)) . 1405) (undo-tree-id21 . -3)) (26806 58348 861624 0) 0 nil])
([nil nil ((#("payload" 0 7 (fontified t)) . -1406) (undo-tree-id30 . -7) 1413) nil (26807 801 302377 0) 0 nil])
([nil nil ((1408 . 1409)) ((#(" " 0 1 (fontified t)) . 1408) (undo-tree-id20 . -1)) (26806 58348 702003 0) 0 nil])
([nil nil ((1406 . 1409)) nil (26807 801 302375 0) 0 nil])
([nil nil ((1409 . 1410)) ((#(":" 0 1 (fontified t)) . 1409) (undo-tree-id19 . -1)) (26806 58348 701928 0) 0 nil])
([nil nil ((#(" (cdr (assoc :scopes jwt)) (cdr (assoc \"scopes\" jwt))" 0 1 (fontified t) 1 13 (fontified t) 13 20 (face font-lock-builtin-face fontified t) 20 39 (fontified t) 39 47 (face font-lock-string-face fontified t) 47 53 (fontified t)) . -1418) (undo-tree-id29 . -53) 1471) nil (26807 801 302372 0) 0 nil])
nil
([nil nil ((508 . 509) (t 26807 801 0 0)) nil (26808 24276 940973 0) 0 nil])
([nil nil ((509 . 517)) nil (26808 24276 940973 0) 0 nil])
([nil nil ((509 . 526) (#("ensure-c" 0 8 (fontified t)) . -509) (undo-tree-id15 . -8) 517) nil (26808 24276 940972 0) 0 nil])
([nil nil ((509 . 510)) nil (26808 24276 940971 0) 0 nil])
([nil nil ((527 . 528)) nil (26808 24276 940971 0) 0 nil])
([nil nil ((#("!" 0 1 (face font-lock-builtin-face fontified t)) . -527) (undo-tree-id14 . -1) 528) nil (26808 24276 940970 0) 0 nil])
([nil nil ((3790 . 3796)) nil (26808 24276 940969 0) 0 nil])
([nil nil ((3796 . 3801)) nil (26808 24276 940969 0) 0 nil])
([nil nil ((#("e" 0 1 (fontified t)) . -3797) (undo-tree-id10 . -1) (#("n" 0 1 (fontified t)) . -3798) (undo-tree-id11 . -1) (#("s" 0 1 (fontified t)) . -3799) (undo-tree-id12 . -1) (#("u" 0 1 (fontified t)) . -3800) (undo-tree-id13 . -1) 3801) nil (26808 24276 940968 0) 0 nil])
([nil nil ((3797 . 3812)) nil (26808 24276 940965 0) 0 nil])
([nil nil ((3812 . 3816)) nil (26808 24276 940965 0) 0 nil])
([nil nil ((3797 . 3828) (#("lumen.data.db:ensur" 0 19 (fontified t)) . -3797) (undo-tree-id9 . -19) 3816) nil (26808 24276 940964 0) 0 nil])
([nil nil ((3828 . 3829)) nil (26808 24276 940963 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -3828) (undo-tree-id8 . -1) 3829) nil (26808 24276 940963 0) 0 nil])
([nil nil ((4158 . 4159)) nil (26808 24276 940962 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -4158) (undo-tree-id7 . -1) 4159) nil (26808 24276 940962 0) 0 nil])
([nil nil ((4158 . 4159)) nil (26808 24276 940960 0) 0 nil])
([nil nil ((4959 . 4964)) nil (26808 24276 940960 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4995 . 4996) (nil fontified nil 4965 . 4996) (nil fontified nil 4964 . 4965) (4964 . 4996)) nil (26808 24276 940960 0) 0 nil])
([nil nil ((5541 . 5542)) nil (26808 24276 940959 0) 0 nil])
([nil nil ((5970 . 5975)) nil (26808 24276 940959 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6006 . 6007) (nil fontified nil 5976 . 6007) (nil fontified nil 5975 . 5976) (5975 . 6007)) nil (26808 24276 940958 0) 0 nil])
([nil nil ((6100 . 6101)) nil (26808 24276 940958 0) 0 nil])
([nil nil ((6401 . 6406)) nil (26808 24276 940957 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6437 . 6438) (nil fontified nil 6407 . 6438) (nil fontified nil 6406 . 6407) (6406 . 6438)) nil (26808 24276 940957 0) 0 nil])
([nil nil ((6567 . 6568)) nil (26808 24276 940956 0) 0 nil])
([nil nil ((7142 . 7149)) nil (26808 24276 940956 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7180 . 7181) (nil fontified nil 7150 . 7181) (nil fontified nil 7149 . 7150) (7149 . 7181)) nil (26808 24276 940956 0) 0 nil])
([nil nil ((7326 . 7327)) nil (26808 24276 940955 0) 0 nil])
([nil nil ((7512 . 7515)) nil (26808 24276 940955 0) 0 nil])
([nil nil ((7515 . 7520)) nil (26808 24276 940954 0) 0 nil])
([nil nil ((#("w" 0 1 (fontified t)) . -7516) (undo-tree-id3 . -1) (#("i" 0 1 (fontified t)) . -7517) (undo-tree-id4 . -1) (#("t" 0 1 (fontified t)) . -7518) (undo-tree-id5 . -1) (#("h" 0 1 (fontified t)) . -7519) (undo-tree-id6 . -1) 7520) nil (26808 24276 940953 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7547 . 7548) (nil fontified nil 7517 . 7548) (nil fontified nil 7516 . 7517) (7516 . 7548)) nil (26808 24276 940949 0) 0 nil])
([nil nil ((#("ensure-connection" 0 16 (fontified t) 16 17 (rear-nonsticky t fontified t)) . -7531) (undo-tree-id2 . -17) 7548) nil (26808 24276 940948 0) 0 nil])
([nil nil ((7531 . 7532)) nil (26808 24276 940947 0) 0 nil])
([nil nil ((7532 . 7538)) nil (26808 24276 940946 0) 0 nil])
([nil nil ((7538 . 7539)) nil (26808 24276 940946 0) 0 nil])
([nil nil ((7539 . 7541)) nil (26808 24276 940945 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -7515) (undo-tree-id0 . -1) (undo-tree-id1 . -1) 7516) nil (26808 24276 940944 0) 0 nil])
([nil nil ((7698 . 7699)) nil (26808 24276 940927 0) 0 nil])
([nil nil ((9568 . 9570) (t 26808 24276 0 0)) nil (26809 12807 760989 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 11179 . 11180) (nil fontified nil 9570 . 11180) (9570 . 11180)) nil (26809 12807 760988 0) 0 nil])
([nil nil ((#("
(defmethod repo-create :around ((entity symbol) payload ctx)
  ;; impose un tenant UUID correct
  (multiple-value-bind (tid payload1) (%coerce-tenant-id payload ctx)
    (unless tid
      (error 'db-error :message \"missing or invalid tenant-id\"))
    ;; réinjecte un tenant_id **UUID** propre
    (let ((payload2 (acons :tenant_id tid payload1)))
      (call-next-method entity payload2 ctx))))

(defmethod repo-update :around ((entity symbol) id payload ctx)
  (multiple-value-bind (tid payload1) (%coerce-tenant-id payload ctx)
    (let ((payload2 (if tid (acons :tenant_id tid payload1) payload1)))
      (call-next-method entity id payload2 ctx))))
" 0 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 23 (face font-lock-function-name-face fontified t) 23 24 (fontified t) 24 31 (face font-lock-builtin-face fontified t) 31 64 (fontified t) 64 67 (face font-lock-comment-delimiter-face fontified t) 67 97 (face font-lock-comment-face fontified t) 97 100 (fontified t) 100 119 (face font-lock-keyword-face fontified t) 119 172 (fontified t) 172 178 (face font-lock-keyword-face fontified t) 178 190 (fontified t) 190 195 (face font-lock-warning-face fontified t) 195 206 (fontified t) 206 214 (face font-lock-builtin-face fontified t) 214 215 (fontified t) 215 245 (face font-lock-string-face fontified t) 245 252 (fontified t) 252 255 (face font-lock-comment-delimiter-face fontified t) 255 294 (face font-lock-comment-face fontified t) 294 299 (fontified t) 299 302 (face font-lock-keyword-face fontified t) 302 321 (fontified t) 321 331 (face font-lock-builtin-face fontified t) 331 397 (fontified t) 397 398 (fontified t) 398 407 (face font-lock-keyword-face fontified t) 407 408 (fontified t) 408 419 (face font-lock-function-name-face fontified t) 419 420 (fontified t) 420 427 (face font-lock-builtin-face fontified t) 427 464 (fontified t) 464 483 (face font-lock-keyword-face fontified t) 483 536 (fontified t) 536 539 (face font-lock-keyword-face fontified t) 539 543 (fontified t) 543 552 (fontified t) 552 554 (face font-lock-keyword-face fontified t) 554 566 (fontified t) 566 576 (face font-lock-builtin-face fontified t) 576 603 (fontified t) 603 652 (fontified t) 652 653 (rear-nonsticky t fontified t) 653 654 (fontified t)) . 10527) (undo-tree-id28 . -654)) nil (26809 12807 760987 0) 0 nil])
([nil nil ((10527 . 10528)) nil (26809 12807 760986 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 11364 . 11365) (nil fontified nil 10528 . 11365) (10528 . 11365)) nil (26809 12807 760985 0) 0 nil])
([nil nil ((9443 . 9445)) nil (26809 12807 760984 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9631 . 9632) (nil fontified nil 9445 . 9632) (9445 . 9632)) nil (26809 12807 760983 0) 0 nil])
([nil nil ((#("
(defmethod repo-index :around (entity ctx &rest args)
  (declare (ignore args))
  (let ((op :index)) (repo-authorize op entity ctx) (call-next-method)))" 0 1 (face font-lock-comment-face fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 22 (face font-lock-function-name-face fontified t) 22 23 (fontified t) 23 30 (face font-lock-builtin-face fontified t) 30 39 (fontified t) 39 43 (fontified t) 43 48 (face font-lock-type-face fontified t) 48 55 (fontified t) 55 58 (fontified t) 58 65 (face font-lock-keyword-face fontified t) 65 81 (fontified t) 81 84 (fontified t) 84 87 (face font-lock-keyword-face fontified t) 87 93 (fontified t) 93 99 (face font-lock-builtin-face fontified t) 99 153 (fontified t)) . 9290) (undo-tree-id27 . -153)) nil (26809 12807 760982 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face fontified t)) . 9290)) nil (26809 12807 760980 0) 0 nil])
([nil nil ((9478 . 9480)) nil (26809 12807 760980 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 10030 . 10031) (nil fontified nil 9480 . 10031) (9480 . 10031)) nil (26809 12807 760979 0) 0 nil])
([nil nil ((#("
" 0 1 (rear-nonsticky t fontified t)) . -10030) (undo-tree-id26 . -1) 10031) nil (26809 12807 760978 0) 0 nil])
([nil nil ((10030 . 10031)) nil (26809 12807 760976 0) 0 nil])
([nil nil ((9290 . 9291)) nil (26809 12807 760976 0) 0 nil])
([nil nil ((9291 . 9293)) nil (26809 12807 760975 0) 0 nil])
([nil nil ((9482 . 9484)) nil (26809 12807 760974 0) 0 nil])
([nil nil ((9484 . 9485)) nil (26809 12807 760974 0) 0 nil])
([nil nil ((3156 . 3158)) nil (26809 12807 760973 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 3938 . 3939) (nil fontified nil 3158 . 3939) (3158 . 3939)) nil (26809 12807 760972 0) 0 nil])
([nil nil ((12742 . 12744)) nil (26809 12807 760972 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 14897 . 14898) (nil fontified nil 12744 . 14898) (12744 . 14898)) nil (26809 12807 760971 0) 0 nil])
([nil nil ((#("
(defun %coerce-tenant-id (payload ctx)
  \"Retourne (tenant-id-uuid, payload-sans-champ-tenant-dangereux).\"
  (let* ((from-ctx (getf ctx :tenant-id))              ; déjà un UUID ? (middleware vhost)
         (raw (or (cdr (assoc :tenant_id payload))     ; ce que le client a envoyé
                  (cdr (assoc \"tenant_id\" payload))))
         ;; si le client envoie un code ('tenant-b'), on résout vers l'UUID
         (resolved (cond
                     (from-ctx from-ctx)
                     ((and raw (crd.backend.repo:maybe-uuid-p raw)) raw)
                     (raw (crd.backend.repo:tenant-id-by-code raw)) ; <— SELECT sur tenants(code)
                     (t nil))))
    (values resolved
            (remove :tenant_id payload :key #'car :test (lambda (a b)
                                                          (or (eq a b)
                                                              (and (stringp a) (string-equal a \"tenant_id\"))))))))

(defun maybe-uuid-p (s)
  (and (stringp s)
       (cl-ppcre:scan \"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$\" (string-downcase s))))" 0 1 (fontified t) 1 2 (fontified t) 2 7 (face font-lock-keyword-face fontified t) 7 8 (fontified t) 8 25 (face font-lock-function-name-face fontified t) 25 42 (fontified t) 42 107 (face font-lock-doc-face fontified t) 107 111 (fontified t) 111 115 (face font-lock-keyword-face fontified t) 115 137 (fontified t) 137 147 (face font-lock-builtin-face fontified t) 147 163 (fontified t) 163 199 (face font-lock-comment-face fontified t) 199 229 (fontified t) 229 239 (face font-lock-builtin-face fontified t) 239 254 (fontified t) 254 282 (face font-lock-comment-face fontified t) 282 312 (fontified t) 312 323 (face font-lock-string-face fontified t) 323 345 (fontified t) 345 348 (face font-lock-comment-delimiter-face fontified t) 348 412 (face font-lock-comment-face fontified t) 412 432 (fontified t) 432 436 (face font-lock-keyword-face fontified t) 436 619 (fontified t) 619 628 (face font-lock-comment-face fontified t) 628 634 (face font-lock-comment-face fontified t) 634 649 (face font-lock-comment-face fontified t) 649 722 (fontified t) 722 732 (face font-lock-builtin-face fontified t) 732 741 (fontified t) 741 745 (face font-lock-builtin-face fontified t) 745 752 (fontified t) 752 757 (face font-lock-builtin-face fontified t) 757 759 (fontified t) 759 765 (face font-lock-keyword-face fontified t) 765 823 (fontified t) 823 843 (fontified t) 843 938 (fontified t) 938 949 (face font-lock-string-face fontified t) 949 958 (fontified t) 958 959 (fontified t) 959 960 (fontified t) 960 965 (face font-lock-keyword-face fontified t) 965 966 (fontified t) 966 978 (face font-lock-function-name-face fontified t) 978 1024 (fontified t) 1024 1088 (face font-lock-string-face fontified t) 1088 1111 (fontified t)) . -10946) (undo-tree-id24 . -959) (undo-tree-id25 . -1111) 12057) nil (26809 12807 760969 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 10946)) nil (26809 12807 760964 0) 0 nil])
([nil nil ((10945 . 10947)) nil (26809 12807 760963 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 11455 . 11456) (nil fontified nil 10947 . 11456) (10947 . 11456)) nil (26809 12807 760962 0) 0 nil])
([nil nil ((10821 . 10822)) nil (26809 12807 760961 0) 0 nil])
([nil nil ((10822 . 10824)) nil (26809 12807 760960 0) 0 nil])
([nil nil ((10949 . 10951)) nil (26809 12807 760959 0) 0 nil])
([nil nil ((10951 . 10952)) nil (26809 12807 760959 0) 0 nil])
([nil nil ((#("(defmethod repo-normalize ((op (eql :create)) (entity symbol) ctx payload)
  (let* ((p0 (%normalize-payload-keys payload))
         ;; on enlève les champs protégés, l’ID est généré côté DB
         (p1 (%remove-protected-fields p0))
         (tid (%resolve-tenant-id ctx p1)))
    (unless tid
      (error 'db-error :message \"missing or invalid tenant-id\"))
    ;; impose tenant_id (écrase toute valeur client)
    (acons :tenant_id tid p1)))

(defmethod repo-normalize ((op (eql :patch)) (entity symbol) ctx payload)
  (let* ((p0 (%normalize-payload-keys payload))
         (p1 (%remove-protected-fields p0))
         (tid (%resolve-tenant-id ctx p1)))
    ;; en PATCH, on **peut** imposer à nouveau tenant_id par défense en profondeur
    (if tid (acons :tenant_id tid p1) p1)))" 0 1 (fontified t) 1 10 (face font-lock-keyword-face fontified t) 10 11 (fontified t) 11 25 (face font-lock-function-name-face fontified t) 25 36 (fontified t) 36 43 (face font-lock-builtin-face fontified t) 43 78 (fontified t) 78 82 (face font-lock-keyword-face fontified t) 82 132 (fontified t) 132 135 (face font-lock-comment-delimiter-face fontified t) 135 190 (face font-lock-comment-face fontified t) 190 283 (fontified t) 283 289 (face font-lock-keyword-face fontified t) 289 301 (fontified t) 301 306 (face font-lock-warning-face fontified t) 306 317 (fontified t) 317 325 (face font-lock-builtin-face fontified t) 325 326 (fontified t) 326 356 (face font-lock-string-face fontified t) 356 363 (fontified t) 363 366 (face font-lock-comment-delimiter-face fontified t) 366 412 (face font-lock-comment-face fontified t) 412 423 (fontified t) 423 433 (face font-lock-builtin-face fontified t) 433 446 (fontified t) 446 455 (face font-lock-keyword-face fontified t) 455 456 (fontified t) 456 470 (face font-lock-function-name-face fontified t) 470 481 (fontified t) 481 487 (face font-lock-builtin-face fontified t) 487 522 (fontified t) 522 526 (face font-lock-keyword-face fontified t) 526 659 (fontified t) 659 662 (face font-lock-comment-delimiter-face fontified t) 662 738 (face font-lock-comment-face fontified t) 738 743 (fontified t) 743 745 (face font-lock-keyword-face fontified t) 745 757 (fontified t) 757 767 (face font-lock-builtin-face fontified t) 767 780 (fontified t) 780 781 (rear-nonsticky t fontified t)) . -3158) (undo-tree-id19 . -122) (undo-tree-id20 . -122) (undo-tree-id21 . -122) (undo-tree-id22 . -443) (undo-tree-id23 . -781) 3939) nil (26809 12807 760957 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5009 . 5010) (nil fontified nil 3158 . 5010) (3158 . 5010)) nil (26809 12807 760951 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face fontified t)) . -3564) (undo-tree-id16 . -1) (undo-tree-id17 . -1) (undo-tree-id18 . -1) 3565) nil (26809 12807 760948 0) 0 nil])
([nil nil ((15373 . 15374)) nil (26809 12807 760928 0) 0 nil])
([nil nil ((842 . 843) (t 26809 12807 0 0)) nil (26809 12900 726444 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -842) (undo-tree-id33 . -1) 843) nil (26809 12900 726442 0) 0 nil])
([nil nil ((843 . 844)) nil (26809 12900 726441 0) 0 nil])
([nil nil ((844 . 845)) nil (26809 12900 726440 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 862 . 863) (nil fontified nil 856 . 863) (nil fontified nil 845 . 856) (845 . 863)) nil (26809 12900 726439 0) 0 nil])
([nil nil ((863 . 864)) nil (26809 12900 726438 0) 0 nil])
([nil nil ((864 . 867)) nil (26809 12900 726437 0) 0 nil])
([nil nil ((#("a" 0 1 (fontified t)) . -866) (undo-tree-id32 . -1) 867) nil (26809 12900 726436 0) 0 nil])
([nil nil ((866 . 870)) nil (26809 12900 726434 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . -868) (undo-tree-id30 . -1) (#("-" 0 1 (fontified t)) . -869) (undo-tree-id31 . -1) 870) nil (26809 12900 726433 0) 0 nil])
([nil nil ((868 . 876)) nil (26809 12900 726428 0) 0 nil])
([nil nil ((864 . 881) (#("tenant-id-by" 0 12 (fontified t)) . -864) (undo-tree-id29 . -12) 876) nil (26809 12900 726425 0) 0 nil])
([nil nil ((864 . 865)) nil (26809 12900 726407 0) 0 nil])
([nil nil ((882 . 883) (t 26809 12900 0 0)) nil (26809 12926 785095 0) 0 nil])
([nil nil ((#("s" 0 1 (face font-lock-builtin-face fontified t)) . -882) (undo-tree-id34 . -1) (undo-tree-id35 . -1) (undo-tree-id36 . -1) (undo-tree-id37 . -1) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) (undo-tree-id42 . -1) (undo-tree-id43 . -1) (undo-tree-id44 . -1) (undo-tree-id45 . -1) (undo-tree-id46 . -1) (undo-tree-id47 . -1) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (undo-tree-id50 . -1) 883) nil (26809 12926 785089 0) 0 nil])
([nil nil ((#("crd.backend.repo:" 0 17 (fontified t)) . -15082) (undo-tree-id51 . -17) (undo-tree-id52 . -17) (undo-tree-id53 . -17) 15099 (t 26809 12926 0 0)) nil (26809 12945 83763 0) 0 nil])
([nil nil ((1 . 15496) (#("(in-package :cl)

(defpackage :lumen.data.repo.core
  (:use :cl)
  (:import-from :lumen.data.dao
    :entity-metadata :entity-fields :row->entity :entity->row-alist
    :entity-insert! :entity-update! :entity-delete! :validate-entity!
    :entity-slot-symbol)
  (:import-from :lumen.data.repo.query   ;; helpers SQL existants (select*, count*, etc.)
    :select* :select-page-keyset* :select-page-keyset-prev* :count*)
  (:import-from :lumen.utils
    :alist-get)
  (:import-from :lumen.data.db
    :with-tx :ensure-connection)
  (:export
    ;; API “haut-niveau” (appelées par les contrôleurs, routes CRUD, jobs…)
    :repo-index :repo-show :repo-create :repo-patch :repo-delete
    ;; Hooks extensibles par entité
    :repo-authorize :repo-normalize :repo-validate :repo-before :repo-persist :repo-after
    ;; Utilitaires
    :ctx-from-req :tenant-id-for-host :tenant-id-by-code))

(in-package :lumen.data.repo.core)

;;; ---------------------------------------------------------------------------
;;; Contexte standard (req -> ctx)
;;; ---------------------------------------------------------------------------
(defun ctx-from-req (req)
  \"Projette le contexte HTTP vers un ctx alist standard utilisé par repo-*.\"
  (let* ((jwt (lumen.core.http:current-jwt req)))
    (list :req       req
          :tenant-id (lumen.core.http:ctx-get req :tenant-id)
          :actor-id  (lumen.core.http:current-user-id req)
          :scopes    (or (lumen.utils:alist-get jwt :scopes) '())
          :audit?    t)))

;;; ---------------------------------------------------------------------------
;;; API générique (génériques CLOS)
;;; ---------------------------------------------------------------------------
(defgeneric repo-index  (entity ctx &key filters order select page
				      page-size limit offset after before key))
(defgeneric repo-show   (entity ctx id))
(defgeneric repo-create (entity ctx payload))
(defgeneric repo-patch  (entity ctx id payload))
(defgeneric repo-delete (entity ctx id))

;;; Hooks transverses (spécialisables par entité)
(defgeneric repo-authorize (op entity ctx &key id payload))
(defgeneric repo-normalize (op entity ctx payload))
(defgeneric repo-validate (op entity ctx payload))
(defgeneric repo-before   (op entity ctx &key id payload))
(defgeneric repo-persist  (op entity ctx &key id payload))
(defgeneric repo-after    (op entity ctx result &key id payload))

;;; ---------------------------------------------------------------------------
;;; Defaults : autorisations, normalisation, validation, after (audit)…
;;; ---------------------------------------------------------------------------
(defmethod repo-authorize (op (entity symbol) ctx &key id payload)
  (declare (ignore id payload))
  ;; Par défaut : lecture libre ; écriture nécessite scope \"<table>:write\"
  (let* ((md (entity-metadata entity))
         (table (string-downcase (or (getf md :table) (symbol-name entity))))
         (write? (member op '(:create :patch :delete))))
    (if write?
        (member (format nil \"~a:write\" table) (getf ctx :scopes) :test #'string=)
        t)))

(defmethod repo-normalize (op (entity symbol) ctx payload)
  (declare (ignore op entity ctx))
  payload)

;;; ---------------------------------------------------------------------------
;;; Garde-fous framework (CLOS :around)
;;; - S'exécutent AVANT tout (CLOS), mais on délègue aux primaires via
;;;   (call-next-method), puis on RÉ-APPLIQUE les invariants.
;;; - Rend le socle plus robuste même si une app oublie call-next-method.
;;; ---------------------------------------------------------------------------
(defmethod repo-normalize :around ((op (eql :create)) (entity symbol) ctx payload)
  \"Pipeline final framework pour CREATE :
   1) Laisse les méthodes primaires spécifiques s’exécuter,
   2) puis garantit les invariants Lumen (idempotents).\"
  (let* ((out (call-next-method))                            ; ← primaires (app + socle)
         (p0 (%normalize-payload-keys out))                  ; clés normalisées (kw/strings)
         (p1 (%remove-protected-fields p0))                  ; retire :id, :created_at, etc.
         (tid (%resolve-tenant-id ctx p1)))                  ; trouve le tenant depuis ctx/payload
    (unless tid
      (error 'lumen.data.errors:db-error
             :message \"missing or invalid tenant-id\"))
    ;; impose/écrase tenant_id (idempotent) + renvoie un payload propre
    (acons :tenant_id tid p1)))

(defmethod repo-normalize :around ((op (eql :patch)) (entity symbol) ctx payload)
  \"Pipeline final framework pour PATCH :
   - Retire les champs protégés
   - Verrouille le tenant (impossible de changer de tenant).\"
  (let* ((out (call-next-method))
         (p0 (%normalize-payload-keys out))
         (p1 (%remove-protected-fields p0))
         (tid (%resolve-tenant-id ctx p1)))
    (unless tid
      (error 'lumen.data.errors:db-error
             :message \"missing or invalid tenant-id\"))
    ;; Ne JAMAIS permettre de modifier :tenant_id par PATCH
    (remf p1 :tenant_id)
    (acons :tenant_id tid p1)))

(defmethod repo-validate (op (entity symbol) ctx payload)
  (declare (ignore op entity))
  ;; Validation DSL si l’app fournit (sinon no-op)
  (ignore-errors
    (let* ((ent (row->entity entity payload)))
      (validate-entity! ent)))
  payload)

(defmethod repo-before (op (entity symbol) ctx &key id payload)
  (declare (ignore op entity ctx id payload))
  ;; no-op par défaut
  (values))

(defmethod repo-after (op (entity symbol) ctx result &key id payload)
  (declare (ignore op entity id payload))
  ;; Audit optionnel (si l’app/ENV a installé une table audit_log et veut logguer)
  (when (getf ctx :audit?)
    (ignore-errors
     (lumen.data.db:ensure-connection
      (lumen.data.db:exec
       \"insert into audit_log(actor_id, tenant_id, action, resource, payload)
        values($1,$2,$3,$4,$5)\"
       (getf ctx :actor-id)
       (getf ctx :tenant-id)
       (string-downcase (symbol-name op))
       (string-downcase (symbol-name entity))
       (cl-json:encode-json-to-string result)))))
  result)

;;; ---------------------------------------------------------------------------
;;; Implémentations par défaut (primaire) — s’appuient sur metadata defentity
;;; ---------------------------------------------------------------------------

;; INDEX (liste)
(defmethod repo-index ((entity symbol) ctx &key filters order select page page-size limit offset after before key)
  (let* ((md (entity-metadata entity))
         (table (getf md :table))
         (allowed (mapcar (lambda (f) (getf f :col)) (entity-fields entity)))
         (filters* (append filters
                           (let ((tid (getf ctx :tenant-id))
                                 (tcol (or (getf md :tenant-id-col) :tenant_id)))
                             (when (and tid (find tcol allowed)) (list '= tcol tid))))))
    (lumen.data.db:ensure-connection
    (cond
      ((or after before)
       ;; key = liste de colonnes correspondant à ORDER
       (select-page-keyset* table
         :filters filters* :order order :key key
         :after after :before before :limit (or limit 20)
         :order-whitelist allowed))
      (t
       (select* table
         :filters filters* :order order :select (or select :*)
         :limit (or (and page-size (* 1 page-size)) limit 20)
         :offset (or offset (and page page-size (* (max 0 (1- page)) page-size)))
         :order-whitelist allowed))))))

;; SHOW (lecture par PK, filtrée tenant si présent)
(defmethod repo-show ((entity symbol) ctx id)
  (let* ((md (entity-metadata entity))
         (table (getf md :table))
         (pk    (or (getf md :primary-key) :id))
         (filters (list '= pk id)))
    (let* ((tid (getf ctx :tenant-id))
           (tcol (or (getf md :tenant-id-col) :tenant_id)))
      (when tid (setf filters (list 'and filters (list '= tcol tid)))))
    (lumen.data.db:ensure-connection
    (let ((rows (select* table :filters filters :limit 1)))
      (and rows (first rows))))))

;; CREATE
(defmethod repo-create ((entity symbol) ctx payload)
  (repo-persist :create entity ctx :payload payload))

(defmethod repo-persist ((op (eql :create)) (entity symbol) ctx &key id payload)
  (declare (ignore ctx id))
  (let* ((ent (row->entity entity payload)))
    (validate-entity! ent)
    (lumen.data.db:ensure-connection
    (multiple-value-bind (n ent2) (entity-insert! ent :returning t)
      (declare (ignore n))
      (entity->row-alist ent2)))))

;; PATCH (partial update)
(defmethod repo-patch ((entity symbol) ctx id payload)
  (repo-persist :patch entity ctx :id id :payload payload))

(defmethod repo-persist ((op (eql :patch)) (entity symbol) ctx &key id payload)
  (declare (ignore ctx))
  (let* ((cur (repo-show entity (list) id)))
    (unless cur (error \"not_found\"))
    (let* ((ent (row->entity entity cur)))
      (dolist (kv payload)
        (let* ((col (car kv)) (val (cdr kv))
               (slot (entity-slot-symbol entity col)))
          (setf (slot-value ent slot) val)))
      (validate-entity! ent)
      (lumen.data.db:ensure-connection
      (multiple-value-bind (n ent2) (entity-update! ent :patch t :returning t)
        (declare (ignore n))
        (entity->row-alist ent2))))))

;; DELETE
(defmethod repo-delete ((entity symbol) ctx id)
  (repo-persist :delete entity ctx :id id))

(defmethod repo-persist ((op (eql :delete)) (entity symbol) ctx &key id payload)
  (lumen.data.db:with-tx ()
  (let ((cur (repo-show entity (list) id)))
    (unless cur (error \"not_found\"))
    (entity-delete! (row->entity entity cur))
    (list :deleted t :id id))))

;;; ---------------------------------------------------------------------------
;;; Transactions & hooks orchestrés via :around
;;; ---------------------------------------------------------------------------

(defmacro %with-read-tx (&body body)
  ;; lecture sans obligation de BEGIN distinct (optionnel)
  `(progn ,@body))

(defmacro %with-write-tx (&body body)
  `(with-tx () ,@body))

;; create
(defmethod repo-create :around (entity ctx payload)
  (%with-write-tx
    (let ((op :create))
      (repo-authorize op entity ctx :payload payload)
      (let ((p1 (repo-normalize op entity ctx payload)))
        (repo-validate op entity ctx p1)
        (repo-before   op entity ctx :payload p1)
        (let ((res (call-next-method entity ctx p1)))
          (repo-after op entity ctx res :payload p1))))))

;; patch
(defmethod repo-patch :around (entity ctx id payload)
  (%with-write-tx
    (let ((op :patch))
      (repo-authorize op entity ctx :id id :payload payload)
      (let ((p1 (repo-normalize op entity ctx payload)))
        (repo-validate op entity ctx p1)
        (repo-before   op entity ctx :id id :payload p1)
        (let ((res (call-next-method entity ctx id p1)))
          (repo-after op entity ctx res :id id :payload p1))))))

;; delete
(defmethod repo-delete :around (entity ctx id)
  (%with-write-tx
    (let ((op :delete))
      (repo-authorize op entity ctx :id id)
      (repo-before   op entity ctx :id id)
      (let ((res (call-next-method entity ctx id)))
        (repo-after op entity ctx res :id id)))))

;; index/show — lecture (pas de BEGIN obligatoire)
#|
(defmethod repo-index :around (entity ctx &rest args)
  (let ((op :index))
    (repo-authorize op entity ctx)
    ;; ⚠️ relayer les args !
    (apply #'call-next-method entity ctx args)))
|#

(defmethod repo-index :around (entity ctx &rest args)
  (destructuring-bind (&key filters &allow-other-keys) args
    (let* ((tid (getf ctx :tenant-id))
           (filters* (if tid (list 'and filters (list '= :tenant_id tid)) filters))
           (args* (alexandria:plist-alist
                   (alexandria:copy-plist args))))
      ;; replace :filters
      (setf (cdr (assoc :filters args*)) filters*)
      (let ((op :index))
        (repo-authorize op entity ctx)
        (apply #'call-next-method entity ctx (alexandria:alist-plist args*))))))

#|
(defmethod repo-show :around (entity ctx id)
  (let ((op :show)) (repo-authorize op entity ctx :id id) (call-next-method)))
|#

(defmethod repo-show :around (entity ctx id)
  (let ((op :show))
    (repo-authorize op entity ctx :id id)
    (let* ((row (call-next-method))      ;; la méthode primaire fait le SELECT
           (tid (getf ctx :tenant-id)))
      (if (and row tid
               (string/= (string-downcase (or (cdr (assoc :tenant_id row)) \"\"))
                         (string-downcase tid)))
          ;; masquer les fuites cross-tenant
          (respond-404)                  ;; ou NIL selon ton contrat
          row))))

(defun tenant-id-by-code (code)
  ;; SELECT id FROM tenants WHERE code = $1 LIMIT 1
  (let ((row (lumen.data.repo.query:select* :tenants
               :filters (list '= :code code) :limit 1)))
    (when (and row (first row))
      (cdr (assoc :id (first row))))))

(defun tenant-id-for-host (host)
  ;; à toi de voir : table tenant_domains, ou mapping mémoire dev
  ;; ex: SELECT t.id FROM tenant_domains d JOIN tenants t ON t.id=d.tenant_id WHERE d.host=$1 LIMIT 1
  (let ((row (lumen.data.repo.query:select* :tenant_domains
               :filters (list '= :host host) :select '(:tenant_id) :limit 1)))
    (when (and row (first row))
      (cdr (assoc :tenant_id (first row))))))

;;; ------------------------------------------------------------
;;; Helpers génériques
;;; ------------------------------------------------------------
(defun %kw (x)
  (etypecase x
    (keyword x)
    (symbol  (intern (string-upcase (symbol-name x)) :keyword))
    (string  (intern (string-upcase x) :keyword))))

(defun %normalize-payload-keys (payload)
  \"Homogénéise les clés (keywords) et enlève les doublons string/keyword.\"
  (let ((ht (make-hash-table :test 'equal)))
    (dolist (kv payload)
      (setf (gethash (%kw (car kv)) ht) (cdr kv)))
    (let (out)
      (maphash (lambda (k v) (push (cons k v) out)) ht)
      (nreverse out))))

(defun %remove-protected-fields (payload &key (extra '()))
  (let* ((protected '(:id :created_at :updated_at :lock_version))
         (drop (append protected extra)))
    (remove-if (lambda (kv) (member (car kv) drop))
               payload)))

(defun %maybe-uuid-p (s)
  (and (stringp s)
       (cl-ppcre:scan \"^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$\"
                      (string-downcase s))))

;;; ------------------------------------------------------------
;;; Sanitation tenant_id
;;;   - ctx :tenant-id prioritaire (UUID attendu)
;;;   - sinon payload :tenant_id (UUID) ou code fonctionnel → résolu via app
;;; ------------------------------------------------------------
(defun %resolve-tenant-id (ctx payload)
  (let* ((ctx-tid (or (getf ctx :tenant-id) (getf ctx :tenant_id)))
         (p-tid   (cdr (assoc :tenant_id payload)))
         (tid
          (cond
            ((and ctx-tid (%maybe-uuid-p ctx-tid)) ctx-tid)
            ((and p-tid (%maybe-uuid-p p-tid))     p-tid)
            (p-tid                                  ;; code fonctionnel → UUID
             (or (handler-case
                     (funcall (or (symbol-function 'tenant-id-by-code)
                                  (lambda (_code) (declare (ignore _code)) nil))
                              p-tid)
                   (undefined-function () nil))
                 ;; dernier recours: NIL provoquera une erreur contrôlée
                 nil))
            (t nil))))
    tid))
" 0 1 (fontified t) 1 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 15 (face font-lock-builtin-face fontified t) 15 19 (fontified t) 19 29 (face font-lock-keyword-face fontified t) 29 30 (fontified t) 30 51 (face font-lock-type-face fontified t) 51 55 (fontified t) 55 59 (face font-lock-builtin-face fontified t) 59 60 (fontified t) 60 63 (face font-lock-builtin-face fontified t) 63 68 (fontified t) 68 80 (face font-lock-builtin-face fontified t) 80 81 (fontified t) 81 96 (face font-lock-builtin-face fontified t) 96 101 (fontified t) 101 117 (face font-lock-builtin-face fontified t) 117 118 (fontified t) 118 132 (face font-lock-builtin-face fontified t) 132 133 (fontified t) 133 145 (face font-lock-builtin-face fontified t) 145 146 (fontified t) 146 164 (face font-lock-builtin-face fontified t) 164 169 (fontified t) 169 184 (face font-lock-builtin-face fontified t) 184 185 (fontified t) 185 200 (face font-lock-builtin-face fontified t) 200 201 (fontified t) 201 216 (face font-lock-builtin-face fontified t) 216 217 (fontified t) 217 234 (face font-lock-builtin-face fontified t) 234 239 (fontified t) 239 258 (face font-lock-builtin-face fontified t) 258 263 (fontified t) 263 275 (face font-lock-builtin-face fontified t) 275 276 (fontified t) 276 298 (face font-lock-builtin-face fontified t) 298 301 (fontified t) 301 304 (face font-lock-comment-delimiter-face fontified t) 304 350 (face font-lock-comment-face fontified t) 350 354 (fontified t) 354 362 (face font-lock-builtin-face fontified t) 362 363 (fontified t) 363 383 (face font-lock-builtin-face fontified t) 383 384 (fontified t) 384 409 (face font-lock-builtin-face fontified t) 409 410 (fontified t) 410 417 (face font-lock-builtin-face fontified t) 417 422 (fontified t) 422 434 (face font-lock-builtin-face fontified t) 434 435 (fontified t) 435 447 (face font-lock-builtin-face fontified t) 447 452 (fontified t) 452 462 (face font-lock-builtin-face fontified t) 462 467 (fontified t) 467 479 (face font-lock-builtin-face fontified t) 479 480 (fontified t) 480 494 (face font-lock-builtin-face fontified t) 494 499 (fontified t) 499 507 (face font-lock-builtin-face fontified t) 507 508 (fontified t) 508 526 (face font-lock-builtin-face fontified t) 526 531 (fontified t) 531 538 (face font-lock-builtin-face fontified t) 538 543 (fontified t) 543 546 (face font-lock-comment-delimiter-face fontified t) 546 615 (face font-lock-comment-face fontified t) 615 619 (fontified t) 619 630 (face font-lock-builtin-face fontified t) 630 631 (fontified t) 631 641 (face font-lock-builtin-face fontified t) 641 642 (fontified t) 642 654 (face font-lock-builtin-face fontified t) 654 655 (fontified t) 655 666 (face font-lock-builtin-face fontified t) 666 667 (fontified t) 667 679 (face font-lock-builtin-face fontified t) 679 684 (fontified t) 684 687 (face font-lock-comment-delimiter-face fontified t) 687 716 (face font-lock-comment-face fontified t) 716 720 (fontified t) 720 735 (face font-lock-builtin-face fontified t) 735 736 (fontified t) 736 751 (face font-lock-builtin-face fontified t) 751 752 (fontified t) 752 766 (face font-lock-builtin-face fontified t) 766 767 (fontified t) 767 779 (face font-lock-builtin-face fontified t) 779 780 (fontified t) 780 793 (face font-lock-builtin-face fontified t) 793 794 (fontified t) 794 805 (face font-lock-builtin-face fontified t) 805 810 (fontified t) 810 813 (face font-lock-comment-delimiter-face fontified t) 813 825 (face font-lock-comment-face fontified t) 825 829 (fontified t) 829 842 (face font-lock-builtin-face fontified t) 842 843 (fontified t) 843 862 (face font-lock-builtin-face fontified t) 862 863 (fontified t) 863 881 (face font-lock-builtin-face fontified t) 881 886 (fontified t) 886 896 (face font-lock-keyword-face fontified t) 896 897 (fontified t) 897 918 (face font-lock-builtin-face fontified t) 918 921 (fontified t) 921 925 (face font-lock-comment-delimiter-face fontified t) 925 1001 (face font-lock-comment-face fontified t) 1001 1005 (face font-lock-comment-delimiter-face fontified t) 1005 1036 (face font-lock-comment-face fontified t) 1036 1040 (face font-lock-comment-delimiter-face fontified t) 1040 1116 (face font-lock-comment-face fontified t) 1116 1117 (fontified t) 1117 1122 (face font-lock-keyword-face fontified t) 1122 1123 (fontified t) 1123 1135 (face font-lock-function-name-face fontified t) 1135 1144 (fontified t) 1144 1218 (face font-lock-doc-face fontified t) 1218 1222 (fontified t) 1222 1226 (face font-lock-keyword-face fontified t) 1226 1279 (fontified t) 1279 1283 (face font-lock-builtin-face fontified t) 1283 1304 (fontified t) 1304 1314 (face font-lock-builtin-face fontified t) 1314 1344 (fontified t) 1344 1354 (face font-lock-builtin-face fontified t) 1354 1366 (fontified t) 1366 1375 (face font-lock-builtin-face fontified t) 1375 1425 (fontified t) 1425 1432 (face font-lock-builtin-face fontified t) 1432 1467 (fontified t) 1467 1474 (face font-lock-builtin-face fontified t) 1474 1491 (fontified t) 1491 1498 (face font-lock-builtin-face fontified t) 1498 1500 (fontified t) 1500 1507 (fontified t) 1507 15395 (fontified nil)) . 1) (t 26809 12945 0 0)) nil (26809 16135 99706 0) 0 nil])
([nil nil ((#("alexandria" 0 10 (fontified t)) . -11777) (undo-tree-id7 . -10) (undo-tree-id8 . -10) (undo-tree-id9 . -1) (undo-tree-id10 . -1) (undo-tree-id11 . -1) (undo-tree-id12 . -1) (undo-tree-id13 . -1) (undo-tree-id14 . -1) (undo-tree-id15 . -10) (undo-tree-id16 . -10) (undo-tree-id17 . -10) (undo-tree-id18 . -10) (undo-tree-id19 . -10) (undo-tree-id20 . -10) (undo-tree-id21 . -10) (undo-tree-id22 . -10) (undo-tree-id23 . -4) (undo-tree-id24 . -4) (undo-tree-id25 . -4) (undo-tree-id26 . -4) (undo-tree-id27 . -4) (undo-tree-id28 . -4) (undo-tree-id29 . -10) (undo-tree-id30 . -10) (undo-tree-id31 . -10) (undo-tree-id32 . -10) 11787 (t 26809 16138 0 0)) nil (26809 17116 410169 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 11788 . 11789) (nil fontified nil 11777 . 11789) (11777 . 11789)) nil (26809 17116 410152 0) 0 nil])
([nil nil ((#(":" 0 1 (face font-lock-builtin-face fontified t)) . -11777) (undo-tree-id0 . -1) (undo-tree-id1 . -1) (undo-tree-id2 . -1) (undo-tree-id3 . -1) (undo-tree-id4 . -1) (undo-tree-id5 . -1) (undo-tree-id6 . -1) 11778) nil (26809 17116 410151 0) 0 nil])
([nil nil ((563 . 564)) nil (26809 17116 410133 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 574 . 575) (nil fontified nil 569 . 575) (nil fontified nil 564 . 569) (564 . 575)) nil (26809 17116 410129 0) 0 nil])
([nil nil ((994 . 995) (t 26809 17116 0 0)) nil (26809 18024 199476 0) 0 nil])
([nil nil ((995 . 996)) nil (26809 18024 199475 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1012 . 1013) (nil fontified nil 996 . 1013) (996 . 1013)) nil (26809 18024 199474 0) 0 nil])
([nil nil ((13388 . 13390)) nil (26809 18024 199474 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 13643 . 13644) (nil fontified nil 13390 . 13644) (13390 . 13644)) nil (26809 18024 199473 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -13389) (undo-tree-id33 . -1) (undo-tree-id34 . -1) 13390) nil (26809 18024 199471 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 13567 . 13568) (nil fontified nil 13546 . 13568) (13546 . 13568)) nil (26809 18024 199459 0) 0 nil])
([nil nil ((#("query" 0 5 (fontified t)) . -13562) (undo-tree-id36 . -5) 13567 (t 26809 18024 0 0)) nil (26809 18067 275497 0) 0 nil])
([nil nil ((13562 . 13564)) nil (26809 18067 275495 0) 0 nil])
([nil nil ((#("repo" 0 4 (fontified t)) . -13557) (undo-tree-id35 . -4) 13561) nil (26809 18067 275494 0) 0 nil])
([nil nil ((#("." 0 1 (fontified t)) . 13557)) nil (26809 18067 275485 0) 0 nil])
([nil nil ((639 . 640)) nil (26809 18067 275484 0) 0 nil])
([nil nil ((640 . 648)) nil (26809 18067 275483 0) 0 nil])
([nil nil ((640 . 641)) nil (26809 18067 275480 0) 0 nil])
([nil nil ((13539 . 13544) (t 26809 18067 0 0)) nil (26809 21786 347173 0) 0 nil])
([nil nil ((13544 . 13553)) nil (26809 21786 347172 0) 0 nil])
([nil nil ((13545 . 13562) (#("ensure-c" 0 8 (fontified t)) . -13545) (undo-tree-id50 . -8) 13553) nil (26809 21786 347172 0) 0 nil])
([nil nil ((13545 . 13553)) nil (26809 21786 347171 0) 0 nil])
([nil nil ((13553 . 13559)) nil (26809 21786 347170 0) 0 nil])
([nil nil ((#(";" 0 1 (face font-lock-comment-face fontified t)) . 13558)) nil (26809 21786 347170 0) 0 nil])
([nil nil ((13558 . 13559)) nil (26809 21786 347169 0) 0 nil])
([nil nil ((13704 . 13705)) nil (26809 21786 347169 0) 0 nil])
([nil nil ((13659 . 13662) (#("      " 0 6 (fontified t)) . 13659) (13577 . 13578) (#("    " 0 4 (fontified t)) . 13577) 13400) nil (26809 21786 347168 0) 0 nil])
([nil nil ((13181 . 13184)) nil (26809 21786 347168 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 13214 . 13215) (nil fontified nil 13198 . 13215) (nil fontified nil 13184 . 13198) (13184 . 13215)) nil (26809 21786 347167 0) 0 nil])
([nil nil ((13184 . 13185)) nil (26809 21786 347166 0) 0 nil])
([nil nil ((13433 . 13434)) nil (26809 21786 347166 0) 0 nil])
([nil nil ((12798 . 12801)) nil (26809 21786 347166 0) 0 nil])
([nil nil ((12801 . 12802)) nil (26809 21786 347165 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 12832 . 12833) (nil fontified nil 12816 . 12833) (nil fontified nil 12802 . 12816) (12802 . 12833)) nil (26809 21786 347165 0) 0 nil])
([nil nil ((13014 . 13015)) nil (26809 21786 347164 0) 0 nil])
([nil nil ((13416 . 13419) (#("      " 0 6 (fontified t)) . 13416) (13387 . 13388) (#("    " 0 4 (fontified t)) . 13387) (13317 . 13323) (#("               " 0 15 (fontified t)) . 13317) (13255 . 13259) 13017) nil (26809 21786 347164 0) 0 nil])
([nil nil ((12968 . 12971) (#("      " 0 6 (fontified t)) . 12968) (12939 . 12940) (#("    " 0 4 (fontified t)) . 12939) (12891 . 12897) (#("               " 0 15 (fontified t)) . 12891) (12836 . 12840) 12715) nil (26809 21786 347162 0) 0 nil])
([nil nil ((13290 . 13294) (#(" " 0 1 (fontified nil)) . 13289) (undo-tree-id49 . -1) (13290 . 13291)) nil (26809 21786 347161 0) 0 nil])
([nil nil ((#("
						" 0 1 (fontified t) 1 7 (fontified t)) . -13309) (undo-tree-id48 . -7) 13316) nil (26809 21786 347160 0) 0 nil])
([nil nil ((13309 . 13310)) nil (26809 21786 347158 0) 0 nil])
([nil nil ((13340 . 13346) (#(" " 0 1 (fontified nil)) . 13339) (undo-tree-id37 . -1) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) (undo-tree-id42 . -1) (undo-tree-id43 . -1) (undo-tree-id44 . -1) (undo-tree-id45 . -1) (undo-tree-id46 . -1) (undo-tree-id47 . -1) (13340 . 13341)) nil (26809 21786 347155 0) 0 nil])
([nil nil ((12882 . 12886) (#(" " 0 1 (fontified nil)) . 12881) (undo-tree-id56 . -1) (undo-tree-id57 . -1) (undo-tree-id58 . -1) (undo-tree-id59 . -1) (undo-tree-id60 . -1) (undo-tree-id61 . -1) (undo-tree-id62 . -1) (12882 . 12883) (t 26809 21786 0 0)) nil (26809 21792 776641 0) 0 nil])
([nil nil ((#("
						" 0 1 (fontified t) 1 7 (fontified t)) . -12894) (undo-tree-id51 . -7) (undo-tree-id52 . -1) (undo-tree-id53 . -1) (undo-tree-id54 . -7) (undo-tree-id55 . -7) 12901) nil (26809 21792 776636 0) 0 nil])
([nil nil ((12894 . 12895)) nil (26809 21792 776619 0) 0 nil])
([nil nil ((13377 . 13379) (t 26809 21792 0 0)) nil (26809 22069 653541 0) 0 nil])
([nil nil ((13379 . 13385)) nil (26809 22069 653540 0) 0 nil])
([nil nil ((13385 . 13386)) nil (26809 22069 653540 0) 0 nil])
([nil nil ((13386 . 13387)) nil (26809 22069 653539 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -13386) (undo-tree-id67 . -1) 13387) nil (26809 22069 653538 0) 0 nil])
([nil nil ((13386 . 13393)) nil (26809 22069 653537 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -13392) (undo-tree-id66 . -1) 13393) nil (26809 22069 653537 0) 0 nil])
([nil nil ((13392 . 13393)) nil (26809 22069 653535 0) 0 nil])
([nil nil ((13393 . 13395)) nil (26809 22069 653535 0) 0 nil])
([nil nil ((13395 . 13401)) nil (26809 22069 653534 0) 0 nil])
([nil nil ((13401 . 13402)) nil (26809 22069 653534 0) 0 nil])
([nil nil ((13402 . 13407)) nil (26809 22069 653534 0) 0 nil])
([nil nil ((#("=" 0 1 (fontified t)) . -13406) (undo-tree-id65 . -1) 13407) nil (26809 22069 653533 0) 0 nil])
([nil nil ((13406 . 13407)) nil (26809 22069 653531 0) 0 nil])
([nil nil ((4360 . 4365)) nil (26809 22069 653531 0) 0 nil])
([nil nil ((4365 . 4372)) nil (26809 22069 653530 0) 0 nil])
([nil nil ((4372 . 4373)) nil (26809 22069 653530 0) 0 nil])
([nil nil ((4373 . 4374)) nil (26809 22069 653529 0) 0 nil])
([nil nil ((4374 . 4375)) nil (26809 22069 653529 0) 0 nil])
([nil nil ((4375 . 4381)) nil (26809 22069 653528 0) 0 nil])
([nil nil ((#("U" 0 1 (face font-lock-string-face fontified t)) . -4379) (undo-tree-id63 . -1) (#("D" 0 1 (face font-lock-string-face fontified t)) . -4380) (undo-tree-id64 . -1) 4381) nil (26809 22069 653527 0) 0 nil])
([nil nil ((4379 . 4382)) nil (26809 22069 653514 0) 0 nil])
([nil nil ((4382 . 4383)) nil (26809 22069 653514 0) 0 nil])
([nil nil ((4383 . 4388)) nil (26809 22069 653513 0) 0 nil])
([nil nil ((4388 . 4389)) nil (26809 22069 653512 0) 0 nil])
([nil nil ((4389 . 4393)) nil (26809 22069 653508 0) 0 nil])
([nil nil ((#("s" 0 1 (fontified t)) . -13438) (undo-tree-id68 . -1) (undo-tree-id69 . -1) (undo-tree-id70 . -1) (undo-tree-id71 . -1) (undo-tree-id72 . -1) (undo-tree-id73 . -1) (undo-tree-id74 . -1) (undo-tree-id75 . -1) (undo-tree-id76 . -1) 13439 (t 26809 22069 0 0)) nil (26809 22104 717768 0) 0 nil])
([nil nil ((13237 . 13240) (t 26809 22104 0 0)) nil (26809 22537 368775 0) 0 nil])
([nil nil ((13240 . 13246)) nil (26809 22537 368775 0) 0 nil])
([nil nil ((13246 . 13247)) nil (26809 22537 368774 0) 0 nil])
([nil nil ((13247 . 13252)) nil (26809 22537 368774 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -13251) (undo-tree-id77 . -1) 13252) nil (26809 22537 368772 0) 0 nil])
([nil nil ((13251 . 13252)) nil (26809 22537 368760 0) 0 nil])
([nil nil ((5427 . 5432) (#(" " 0 1 (fontified nil)) . -5384) (5427 . 5428) (t 26809 22537 0 0)) nil (26809 23315 133794 0) 0 nil])
([nil nil ((5432 . 5438)) nil (26809 23315 133794 0) 0 nil])
([nil nil ((5438 . 5439)) nil (26809 23315 133793 0) 0 nil])
([nil nil ((5439 . 5444)) nil (26809 23315 133793 0) 0 nil])
([nil nil ((#(")" 0 1 (face font-lock-string-face fontified t)) . -5443) (undo-tree-id88 . -1) (undo-tree-id89 . -1) 5444) nil (26809 23315 133792 0) 0 nil])
([nil nil ((5443 . 5445)) nil (26809 23315 133791 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -5444) (undo-tree-id83 . -1) (undo-tree-id84 . -1) (undo-tree-id85 . -1) (undo-tree-id86 . -1) (undo-tree-id87 . -1) 5445) nil (26809 23315 133790 0) 0 nil])
([nil nil ((5444 . 5445)) nil (26809 23315 133787 0) 0 nil])
([nil nil ((5445 . 5451)) nil (26809 23315 133786 0) 0 nil])
([nil nil ((5451 . 5452)) nil (26809 23315 133786 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -5451) (undo-tree-id78 . -1) (undo-tree-id79 . -1) (undo-tree-id80 . -1) (undo-tree-id81 . -1) (undo-tree-id82 . -1) 5452) nil (26809 23315 133785 0) 0 nil])
([nil nil ((5451 . 5457)) nil (26809 23315 133770 0) 0 nil])
([nil nil ((5457 . 5458)) nil (26809 23315 133769 0) 0 nil])
([nil nil ((5458 . 5462)) nil (26809 23315 133765 0) 0 nil])
([nil nil ((5363 . 5366) (t 26809 23315 0 0)) nil (26809 23427 719870 0) 0 nil])
([nil nil ((5366 . 5370)) nil (26809 23427 719870 0) 0 nil])
([nil nil ((5370 . 5372)) nil (26809 23427 719869 0) 0 nil])
([nil nil ((5372 . 5373)) nil (26809 23427 719869 0) 0 nil])
([nil nil ((5373 . 5376)) nil (26809 23427 719868 0) 0 nil])
([nil nil ((5376 . 5377)) nil (26809 23427 719868 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5389 . 5390) (nil fontified nil 5377 . 5390) (5377 . 5390)) nil (26809 23427 719867 0) 0 nil])
([nil nil ((5390 . 5392)) nil (26809 23427 719867 0) 0 nil])
([nil nil ((5377 . 5381) (#("repo" 0 4 (face font-lock-string-face fontified t)) . 5377)) nil (26809 23427 719866 0) 0 nil])
([nil nil ((5381 . 5390) (#("-validate" 0 8 (face font-lock-string-face fontified t) 8 9 (face font-lock-string-face rear-nonsticky t fontified t)) . 5381)) nil (26809 23427 719865 0) 0 nil])
([nil nil ((5374 . 5378)) nil (26809 23427 719864 0) 0 nil])
([nil nil ((5378 . 5379)) nil (26809 23427 719860 0) 0 nil])
([nil nil ((8509 . 8514) (t 26809 23427 0 0)) nil (26809 23765 575119 0) 0 nil])
([nil nil ((8514 . 8520)) nil (26809 23765 575118 0) 0 nil])
([nil nil ((8520 . 8521)) nil (26809 23765 575118 0) 0 nil])
([nil nil ((8521 . 8522)) nil (26809 23765 575118 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -8521) (undo-tree-id101 . -1) 8522) nil (26809 23765 575117 0) 0 nil])
([nil nil ((8521 . 8531)) nil (26809 23765 575116 0) 0 nil])
([nil nil ((8531 . 8536)) nil (26809 23765 575116 0) 0 nil])
([nil nil ((8536 . 8537)) nil (26809 23765 575115 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -8536) (undo-tree-id100 . -1) 8537) nil (26809 23765 575115 0) 0 nil])
([nil nil ((8536 . 8541)) nil (26809 23765 575113 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -8536) (undo-tree-id95 . -1) (#("p" 0 1 (fontified t)) . -8537) (undo-tree-id96 . -1) (#("r" 0 1 (fontified t)) . -8538) (undo-tree-id97 . -1) (#("i" 0 1 (fontified t)) . -8539) (undo-tree-id98 . -1) (#("n" 0 1 (fontified t)) . -8540) (undo-tree-id99 . -1) 8541) nil (26809 23765 575111 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -8531) (undo-tree-id90 . -1) (#(" " 0 1 (fontified t)) . -8532) (undo-tree-id91 . -1) (#(" " 0 1 (fontified t)) . -8533) (undo-tree-id92 . -1) (#(" " 0 1 (fontified t)) . -8534) (undo-tree-id93 . -1) (#(" " 0 1 (fontified t)) . -8535) (undo-tree-id94 . -1) 8536) nil (26809 23765 575103 0) 0 nil])
([nil nil ((8723 . 8728) (t 26809 23765 0 0)) nil (26809 23858 81486 0) 0 nil])
([nil nil ((8728 . 8734)) nil (26809 23858 81486 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . -8732) (undo-tree-id104 . -1) (#("n" 0 1 (fontified t)) . -8733) (undo-tree-id105 . -1) 8734) nil (26809 23858 81485 0) 0 nil])
([nil nil ((8732 . 8734)) nil (26809 23858 81483 0) 0 nil])
([nil nil ((8734 . 8735)) nil (26809 23858 81483 0) 0 nil])
([nil nil ((8735 . 8740)) nil (26809 23858 81482 0) 0 nil])
([nil nil ((8740 . 8741)) nil (26809 23858 81482 0) 0 nil])
([nil nil ((8741 . 8746)) nil (26809 23858 81481 0) 0 nil])
([nil nil ((#("S" 0 1 (face font-lock-string-face fontified t)) . -8745) (undo-tree-id103 . -1) 8746) nil (26809 23858 81481 0) 0 nil])
([nil nil ((8745 . 8746)) nil (26809 23858 81479 0) 0 nil])
([nil nil ((8746 . 8752)) nil (26809 23858 81478 0) 0 nil])
([nil nil ((#("T" 0 1 (face font-lock-string-face fontified t)) . -8751) (undo-tree-id102 . -1) 8752) nil (26809 23858 81478 0) 0 nil])
([nil nil ((8751 . 8753)) nil (26809 23858 81468 0) 0 nil])
([nil nil ((8753 . 8754)) nil (26809 23858 81467 0) 0 nil])
([nil nil ((8754 . 8757)) nil (26809 23858 81467 0) 0 nil])
([nil nil ((8759 . 8760)) nil (26809 23858 81466 0) 0 nil])
([nil nil ((8685 . 8688) (#("      " 0 6 (fontified t)) . 8685) (8661 . 8664) (#("      " 0 6 (fontified t)) . 8661) (8596 . 8597) (#("    " 0 4 (fontified t)) . 8596) 8356) nil (26809 23858 81461 0) 0 nil])
([nil nil ((8558 . 8563) (t 26809 23858 0 0)) nil (26809 23912 69592 0) 0 nil])
([nil nil ((8563 . 8569)) nil (26809 23912 69591 0) 0 nil])
([nil nil ((8569 . 8570)) nil (26809 23912 69591 0) 0 nil])
([nil nil ((8570 . 8577)) nil (26809 23912 69586 0) 0 nil])
([nil nil ((8614 . 8616) (t 26809 23912 0 0)) nil (26809 23988 467940 0) 0 nil])
([nil nil ((8616 . 8622)) nil (26809 23988 467939 0) 0 nil])
([nil nil ((8622 . 8623)) nil (26809 23988 467939 0) 0 nil])
([nil nil ((8623 . 8626)) nil (26809 23988 467938 0) 0 nil])
([nil nil ((#("B" 0 1 (face font-lock-string-face fontified t)) . -8625) (undo-tree-id107 . -1) 8626) nil (26809 23988 467938 0) 0 nil])
([nil nil ((8625 . 8626)) nil (26809 23988 467936 0) 0 nil])
([nil nil ((8626 . 8627)) nil (26809 23988 467936 0) 0 nil])
([nil nil ((8627 . 8630)) nil (26809 23988 467935 0) 0 nil])
([nil nil ((8719 . 8723)) nil (26809 23988 467935 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 8736 . 8737) (nil fontified nil 8736 . 8737) (nil fontified nil 8730 . 8736) (nil fontified nil 8723 . 8730) (8723 . 8737)) nil (26809 23988 467934 0) 0 nil])
([nil nil ((#("A" 0 1 (face font-lock-string-face fontified t)) . -8734) (undo-tree-id106 . -1) 8735) nil (26809 23988 467932 0) 0 nil])
([nil nil ((8734 . 8735)) nil (26809 23988 467920 0) 0 nil])
([nil nil ((#("
    (print \"**** REPO PERSIST OK\")" 0 12 (fontified t) 12 34 (face font-lock-string-face fontified t) 34 35 (fontified t)) . 8767) (undo-tree-id0 . -35) (undo-tree-id1 . -35) (undo-tree-id2 . -35) (undo-tree-id3 . -35) (undo-tree-id4 . -35) (undo-tree-id5 . -35) (t 26809 23988 0 0)) nil (26809 26029 397774 0) 0 nil])
([nil nil ((8719 . 8723) (t 26809 26029 0 0)) nil (26809 26518 41533 0) 0 nil])
([nil nil ((8723 . 8726)) nil (26809 26518 41533 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -8724) (undo-tree-id6 . -1) (undo-tree-id7 . -1) (undo-tree-id8 . -1) (#("r" 0 1 (fontified t)) . -8725) (undo-tree-id9 . -1) 8726) nil (26809 26518 41532 0) 0 nil])
([nil nil ((8724 . 8729)) nil (26809 26518 41520 0) 0 nil])
([nil nil ((8729 . 8730)) nil (26809 26518 41520 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 8753 . 8754) (nil fontified nil 8730 . 8754) (8730 . 8754)) nil (26809 26518 41519 0) 0 nil])
([nil nil ((8754 . 8755)) nil (26809 26518 41515 0) 0 nil])
([nil nil ((10685 . 10689) (t 26809 26518 0 0)) nil (26809 26892 187304 0) 0 nil])
([nil nil ((10689 . 10695)) nil (26809 26892 187303 0) 0 nil])
([nil nil ((10695 . 10696)) nil (26809 26892 187303 0) 0 nil])
([nil nil ((10696 . 10701)) nil (26809 26892 187302 0) 0 nil])
([nil nil ((10701 . 10702)) nil (26809 26892 187301 0) 0 nil])
([nil nil ((10702 . 10709)) nil (26809 26892 187296 0) 0 nil])
([nil nil ((5879 . 5882) (t 26809 26892 0 0)) nil (26809 27073 191192 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6064 . 6065) (nil fontified nil 5930 . 6065) (nil fontified nil 5920 . 5930) (nil fontified nil 5901 . 5920) (nil fontified nil 5892 . 5901) (nil fontified nil 5882 . 5892) (5882 . 6065)) nil (26809 27073 191191 0) 0 nil])
([nil nil ((5882 . 5888)) nil (26809 27073 191191 0) 0 nil])
([nil nil ((5888 . 5889)) nil (26809 27073 191190 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . -5887) (undo-tree-id16 . -1) (#(" " 0 1 (fontified t)) . -5888) (undo-tree-id17 . -1) 5889) nil (26809 27073 191189 0) 0 nil])
([nil nil ((5887 . 5888)) nil (26809 27073 191188 0) 0 nil])
([nil nil ((5888 . 5889)) nil (26809 27073 191187 0) 0 nil])
([nil nil ((#("n" 0 1 (fontified t)) . -5886) (undo-tree-id13 . -1) (#("c" 0 1 (fontified t)) . -5887) (undo-tree-id14 . -1) (#(" " 0 1 (fontified t)) . -5888) (undo-tree-id15 . -1) 5889) nil (26809 27073 191186 0) 0 nil])
([nil nil ((5886 . 5888)) nil (26809 27073 191182 0) 0 nil])
([nil nil ((5888 . 5889)) nil (26809 27073 191182 0) 0 nil])
([nil nil ((5889 . 5890)) nil (26809 27073 191181 0) 0 nil])
([nil nil ((#("\\" 0 1 (fontified t)) . -5889) (undo-tree-id12 . -1) 5890) nil (26809 27073 191181 0) 0 nil])
([nil nil ((5889 . 5894)) nil (26809 27073 191179 0) 0 nil])
([nil nil ((5894 . 5895)) nil (26809 27073 191179 0) 0 nil])
([nil nil ((#("y" 0 1 (fontified t)) . -5893) (undo-tree-id10 . -1) (#(" " 0 1 (fontified t)) . -5894) (undo-tree-id11 . -1) 5895) nil (26809 27073 191178 0) 0 nil])
([nil nil ((5893 . 5894)) nil (26809 27073 191168 0) 0 nil])
([nil nil ((5894 . 5895)) nil (26809 27073 191167 0) 0 nil])
([nil nil ((6078 . 6080)) nil (26809 27073 191163 0) 0 nil])
([nil nil ((15739 . 15742) (t 26809 27073 0 0)) nil (26809 34267 874564 0) 0 nil])
([nil nil ((15742 . 15744)) nil (26809 34267 874563 0) 0 nil])
([nil nil ((15744 . 15745)) nil (26809 34267 874563 0) 0 nil])
([nil nil ((15745 . 15749)) nil (26809 34267 874562 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -15746) (undo-tree-id27 . -1) (#("r" 0 1 (fontified t)) . -15747) (undo-tree-id28 . -1) (#("i" 0 1 (fontified t)) . -15748) (undo-tree-id29 . -1) 15749) nil (26809 34267 874562 0) 0 nil])
([nil nil ((15746 . 15751)) nil (26809 34267 874560 0) 0 nil])
([nil nil ((15751 . 15752)) nil (26809 34267 874559 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -15746) (undo-tree-id21 . -1) (#("r" 0 1 (fontified t)) . -15747) (undo-tree-id22 . -1) (#("o" 0 1 (fontified t)) . -15748) (undo-tree-id23 . -1) (#("g" 0 1 (face font-lock-keyword-face fontified t)) . -15749) (undo-tree-id24 . -1) (#("n" 0 1 (face font-lock-keyword-face fontified t)) . -15750) (undo-tree-id25 . -1) (#(" " 0 1 (fontified t)) . -15751) (undo-tree-id26 . -1) 15752) nil (26809 34267 874558 0) 0 nil])
([nil nil ((15746 . 15752)) nil (26809 34267 874554 0) 0 nil])
([nil nil ((15752 . 15753)) nil (26809 34267 874554 0) 0 nil])
([nil nil ((15753 . 15754)) nil (26809 34267 874554 0) 0 nil])
([nil nil ((15754 . 15755)) nil (26809 34267 874553 0) 0 nil])
([nil nil ((15755 . 15757)) nil (26809 34267 874553 0) 0 nil])
([nil nil ((15757 . 15758)) nil (26809 34267 874553 0) 0 nil])
([nil nil ((15758 . 15762)) nil (26809 34267 874552 0) 0 nil])
([nil nil ((15762 . 15763)) nil (26809 34267 874552 0) 0 nil])
([nil nil ((15763 . 15764)) nil (26809 34267 874552 0) 0 nil])
([nil nil ((#("#" 0 1 (face font-lock-string-face fontified t)) . -15763) (undo-tree-id20 . -1) 15764) nil (26809 34267 874551 0) 0 nil])
([nil nil ((15763 . 15766)) nil (26809 34267 874550 0) 0 nil])
([nil nil ((#("#" 0 1 (face font-lock-string-face fontified t)) . -15765) (undo-tree-id19 . -1) 15766) nil (26809 34267 874549 0) 0 nil])
([nil nil ((15765 . 15767)) nil (26809 34267 874548 0) 0 nil])
([nil nil ((15767 . 15768)) nil (26809 34267 874547 0) 0 nil])
([nil nil ((15768 . 15769)) nil (26809 34267 874547 0) 0 nil])
([nil nil ((15769 . 15776)) nil (26809 34267 874546 0) 0 nil])
([nil nil ((16003 . 16010)) nil (26809 34267 874546 0) 0 nil])
([nil nil ((16010 . 16016)) nil (26809 34267 874546 0) 0 nil])
([nil nil ((16016 . 16017)) nil (26809 34267 874545 0) 0 nil])
([nil nil ((16017 . 16023)) nil (26809 34267 874545 0) 0 nil])
([nil nil ((16023 . 16024)) nil (26809 34267 874544 0) 0 nil])
([nil nil ((16024 . 16030)) nil (26809 34267 874544 0) 0 nil])
([nil nil ((4261 . 4264)) nil (26809 34267 874544 0) 0 nil])
([nil nil ((4264 . 4267)) nil (26809 34267 874543 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -4266) (undo-tree-id18 . -1) 4267) nil (26809 34267 874543 0) 0 nil])
([nil nil ((4266 . 4267)) nil (26809 34267 874534 0) 0 nil])
([nil nil ((4267 . 4273)) nil (26809 34267 874534 0) 0 nil])
([nil nil ((4273 . 4274)) nil (26809 34267 874533 0) 0 nil])
([nil nil ((4274 . 4278)) nil (26809 34267 874533 0) 0 nil])
([nil nil ((4168 . 4171)) nil (26809 34267 874532 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4184 . 4185) (nil fontified nil 4171 . 4185) (4171 . 4185)) nil (26809 34267 874531 0) 0 nil])
([nil nil ((#("1" 0 1 (fontified t)) . 4182)) nil (26809 34267 874530 0) 0 nil])
([nil nil ((4182 . 4183)) nil (26809 34267 874527 0) 0 nil])
([nil nil ((#("cdr (assoc" 0 10 (fontified t)) . -15741) (undo-tree-id37 . -10) 15751 (t 26809 34267 0 0)) nil (26809 34391 378902 0) 0 nil])
([nil nil ((15741 . 15748)) nil (26809 34391 378901 0) 0 nil])
([nil nil ((#("i" 0 1 (fontified t)) . -15747) (undo-tree-id36 . -1) 15748) nil (26809 34391 378900 0) 0 nil])
([nil nil ((15747 . 15748)) nil (26809 34391 378899 0) 0 nil])
([nil nil ((15741 . 15762) (#("lumen.u" 0 7 (fontified t)) . -15741) (undo-tree-id35 . -7) 15748) nil (26809 34391 378898 0) 0 nil])
([nil nil ((15740 . 15742)) nil (26809 34391 378897 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -15741) (undo-tree-id34 . -1) 15742) nil (26809 34391 378897 0) 0 nil])
([nil nil ((15741 . 15743)) nil (26809 34391 378895 0) 0 nil])
([nil nil ((15743 . 15744)) nil (26809 34391 378895 0) 0 nil])
([nil nil ((#("payload" 0 7 (fontified t)) . 15778) (undo-tree-id33 . -7) 15785) nil (26809 34391 378894 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -15777) (undo-tree-id31 . -1) (undo-tree-id32 . -1) 15778) nil (26809 34391 378893 0) 0 nil])
([nil nil ((15766 . 15767)) nil (26809 34391 378888 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15773 . 15774) (nil fontified nil 15767 . 15774) (15767 . 15774)) nil (26809 34391 378887 0) 0 nil])
([nil nil ((15786 . 15795)) nil (26809 34391 378886 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15836 . 15837) (nil fontified nil 15836 . 15837) (nil fontified nil 15826 . 15836) (nil fontified nil 15825 . 15826) (nil fontified nil 15824 . 15825) (nil fontified nil 15818 . 15824) (nil fontified nil 15796 . 15818) (nil fontified nil 15795 . 15796) (15795 . 15837)) nil (26809 34391 378885 0) 0 nil])
([nil nil ((#("_" 0 1 (face font-lock-builtin-face fontified t)) . -15833) (undo-tree-id30 . -1) 15834) nil (26809 34391 378883 0) 0 nil])
([nil nil ((15833 . 15834)) nil (26809 34391 378871 0) 0 nil])
([nil nil ((15721 . 15724) (t 26809 34391 0 0)) nil (26809 34748 165700 0) 0 nil])
([nil nil ((15724 . 15726)) nil (26809 34748 165700 0) 0 nil])
([nil nil ((15726 . 15727)) nil (26809 34748 165699 0) 0 nil])
([nil nil ((15727 . 15733)) nil (26809 34748 165698 0) 0 nil])
([nil nil ((15733 . 15734)) nil (26809 34748 165698 0) 0 nil])
([nil nil ((15734 . 15737)) nil (26809 34748 165697 0) 0 nil])
([nil nil ((#("a" 0 1 (fontified t)) . -15734) (undo-tree-id38 . -1) (#("l" 0 1 (fontified t)) . -15735) (undo-tree-id39 . -1) (#("o" 0 1 (fontified t)) . -15736) (undo-tree-id40 . -1) 15737) nil (26809 34748 165696 0) 0 nil])
([nil nil ((15734 . 15743)) nil (26809 34748 165681 0) 0 nil])
([nil nil ((#("(x (print p0))" 0 13 (fontified t) 13 14 (rear-nonsticky t fontified t)) . 4171) (undo-tree-id42 . -14) (undo-tree-id43 . -14) (undo-tree-id44 . -14) (undo-tree-id45 . -14) (undo-tree-id46 . -14) (undo-tree-id47 . -14) (undo-tree-id48 . -14) (undo-tree-id49 . -14) 4185 (t 26809 34748 0 0)) nil (26809 34916 410429 0) 0 nil])
([nil nil ((4925 . 4928)) nil (26809 34916 410423 0) 0 nil])
([nil nil ((nil fontified nil 4941 . 4942) (nil fontified nil 4928 . 4941) (4928 . 4942)) nil (26809 34916 410423 0) 0 nil])
([nil nil ((#("(x (print p1))" 0 14 (fontified t)) . 4267) (undo-tree-id41 . -14)) nil (26809 34916 410422 0) 0 nil])
([nil nil ((4972 . 4975)) nil (26809 34916 410413 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4988 . 4989) (nil fontified nil 4975 . 4989) (4975 . 4989)) nil (26809 34916 410413 0) 0 nil])
([nil nil ((5033 . 5038)) nil (26809 34916 410411 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5065 . 5066) (nil fontified nil 5061 . 5066) (nil fontified nil 5048 . 5061) (nil fontified nil 5038 . 5048) (5038 . 5066)) nil (26809 34916 410407 0) 0 nil])
([nil nil ((4867 . 4870) (t 26809 34916 0 0)) nil (26809 34967 431177 0) 0 nil])
([nil nil ((4870 . 4872)) nil (26809 34967 431177 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -4871) (undo-tree-id50 . -1) 4872) nil (26809 34967 431172 0) 0 nil])
([nil nil ((4871 . 4872)) nil (26809 34967 431164 0) 0 nil])
([nil nil ((4872 . 4873)) nil (26809 34967 431163 0) 0 nil])
([nil nil ((4873 . 4879)) nil (26809 34967 431163 0) 0 nil])
([nil nil ((4879 . 4880)) nil (26809 34967 431162 0) 0 nil])
([nil nil ((4880 . 4885)) nil (26809 34967 431158 0) 0 nil])
([nil nil ((4865 . 4866) (t 26809 34967 0 0)) nil (26809 35305 154577 0) 0 nil])
([nil nil ((4866 . 4867)) nil (26809 35305 154577 0) 0 nil])
([nil nil ((4867 . 4868)) nil (26809 35305 154576 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4867) (undo-tree-id54 . -1) 4868) nil (26809 35305 154576 0) 0 nil])
([nil nil ((4867 . 4868)) nil (26809 35305 154574 0) 0 nil])
([nil nil ((4868 . 4869)) nil (26809 35305 154574 0) 0 nil])
([nil nil ((4869 . 4871)) nil (26809 35305 154573 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . -4870) (undo-tree-id53 . -1) 4871) nil (26809 35305 154573 0) 0 nil])
([nil nil ((4870 . 4873)) nil (26809 35305 154572 0) 0 nil])
([nil nil ((4869 . 4875) (#("enti" 0 4 (fontified t)) . -4869) (undo-tree-id52 . -4) 4873) nil (26809 35305 154571 0) 0 nil])
([nil nil ((4875 . 4876)) nil (26809 35305 154569 0) 0 nil])
([nil nil ((4876 . 4879)) nil (26809 35305 154568 0) 0 nil])
([nil nil ((#("c" 0 1 (fontified t)) . -4878) (undo-tree-id51 . -1) 4879) nil (26809 35305 154567 0) 0 nil])
([nil nil ((4878 . 4879)) nil (26809 35305 154558 0) 0 nil])
([nil nil ((4879 . 4880)) nil (26809 35305 154557 0) 0 nil])
([nil nil ((4880 . 4887)) nil (26809 35305 154554 0) 0 nil])
([nil nil ((9850 . 9854) (9817 . 9821) (9733 . 9736) (#("      " 0 6 (fontified t)) . 9733) 9263 (t 26809 35305 0 0)) nil (26809 36700 866356 0) 0 nil])
([nil nil ((8514 . 8517) (#("      " 0 6 (fontified t)) . 8514) (8457 . 8458) (#("    " 0 4 (fontified t)) . 8457) 8045 (t 26809 36700 0 0)) nil (26809 36941 918916 0) 0 nil])
([nil nil ((9406 . 9411)) nil (26809 36941 918915 0) 0 nil])
([nil nil ((9411 . 9417)) nil (26809 36941 918915 0) 0 nil])
([nil nil ((9417 . 9418)) nil (26809 36941 918914 0) 0 nil])
([nil nil ((9418 . 9425)) nil (26809 36941 918914 0) 0 nil])
([nil nil ((9425 . 9428)) nil (26809 36941 918913 0) 0 nil])
([nil nil ((9428 . 9433)) nil (26809 36941 918913 0) 0 nil])
([nil nil ((9433 . 9435)) nil (26809 36941 918912 0) 0 nil])
([nil nil ((#("r" 0 1 (fontified t)) . -9434) (undo-tree-id55 . -1) 9435) nil (26809 36941 918911 0) 0 nil])
([nil nil ((9434 . 9439)) nil (26809 36941 918899 0) 0 nil])
([nil nil ((9439 . 9440)) nil (26809 36941 918898 0) 0 nil])
([nil nil ((9440 . 9444)) nil (26809 36941 918895 0) 0 nil])
([nil nil ((15755 . 15756) (t 26809 36941 0 0)) nil (26809 39109 827028 0) 0 nil])
([nil nil ((#("x" 0 1 (face font-lock-function-name-face fontified t)) . -15755) (undo-tree-id65 . -1) 15756) nil (26809 39109 827028 0) 0 nil])
([nil nil ((#("s" 0 1 (fontified t)) . -4593) (undo-tree-id64 . -1) 4594) nil (26809 39109 827027 0) 0 nil])
([nil nil ((4593 . 4594)) nil (26809 39109 827025 0) 0 nil])
([nil nil ((#("(acons :tenant_id tid p1)" 0 7 (fontified t) 7 17 (face font-lock-builtin-face fontified t) 17 25 (fontified t)) . -4588) (undo-tree-id56 . -18) (undo-tree-id57 . -25) (undo-tree-id58 . -25) (undo-tree-id59 . -25) (undo-tree-id60 . -25) (undo-tree-id61 . -25) (undo-tree-id62 . -25) (undo-tree-id63 . -25) 4613) nil (26809 39109 827024 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4639 . 4640) (nil fontified nil 4588 . 4640) (4588 . 4640)) nil (26809 39109 827007 0) 0 nil])
([nil nil ((9752 . 9759) (t 26809 39109 0 0)) nil (26809 39534 85886 0) 0 nil])
([nil nil ((9759 . 9765)) nil (26809 39534 85885 0) 0 nil])
([nil nil ((9765 . 9766)) nil (26809 39534 85884 0) 0 nil])
([nil nil ((9766 . 9767)) nil (26809 39534 85883 0) 0 nil])
([nil nil ((#("
      (print (" 0 1 (fontified t) 1 15 (fontified t)) . 9752) (undo-tree-id66 . -15) (undo-tree-id67 . -15)) nil (26809 39534 85880 0) 0 nil])
([nil nil ((9551 . 9558) (t 26809 39534 0 0)) nil (26809 40431 539615 0) 0 nil])
([nil nil ((9558 . 9560)) nil (26809 40431 539614 0) 0 nil])
([nil nil ((9729 . 9735) (#("    " 0 4 (face font-lock-comment-face fontified nil)) . -9694) (9732 . 9733)) nil (26809 40431 539612 0) 0 nil])
([nil nil ((9735 . 9737)) nil (26809 40431 539608 0) 0 nil])
([nil nil ((9766 . 9773) (t 26809 40431 0 0)) nil (26809 40641 726830 0) 0 nil])
([nil nil ((9773 . 9779)) nil (26809 40641 726829 0) 0 nil])
([nil nil ((9779 . 9780)) nil (26809 40641 726828 0) 0 nil])
([nil nil ((9780 . 9794)) nil (26809 40641 726824 0) 0 nil])
([nil nil ((9766 . 9773) (t 26809 40641 0 0)) nil (26809 40682 795700 0) 0 nil])
([nil nil ((9773 . 9777)) nil (26809 40682 795700 0) 0 nil])
([nil nil ((#("e" 0 1 (fontified t)) . -9776) (undo-tree-id117 . -1) 9777) nil (26809 40682 795699 0) 0 nil])
([nil nil ((9776 . 9784)) nil (26809 40682 795698 0) 0 nil])
([nil nil ((9774 . 9785) (#("lumen.data" 0 10 (fontified t)) . -9774) (undo-tree-id102 . -10) (undo-tree-id103 . -8) (undo-tree-id104 . -8) (undo-tree-id105 . -8) (undo-tree-id106 . -8) (undo-tree-id107 . -8) (undo-tree-id108 . -8) (undo-tree-id109 . -9) (undo-tree-id110 . -9) (undo-tree-id111 . -10) (undo-tree-id112 . -10) (undo-tree-id113 . -10) (undo-tree-id114 . -10) (undo-tree-id115 . -10) (undo-tree-id116 . -10) 9784) nil (26809 40682 795696 0) 0 nil])
([nil nil ((#("
      (lumen.data." 0 1 (fontified t) 1 8 (fontified t) 8 19 (fontified t)) . 9766) (undo-tree-id68 . -19) (undo-tree-id69 . -1) (undo-tree-id70 . -8) (undo-tree-id71 . -8) (undo-tree-id72 . -8) (undo-tree-id73 . -8) (undo-tree-id74 . -8) (undo-tree-id75 . -8) (undo-tree-id76 . -1) (undo-tree-id77 . -8) (undo-tree-id78 . -8) (undo-tree-id79 . -1) (undo-tree-id80 . -8) (undo-tree-id81 . -8) (undo-tree-id82 . -8) (undo-tree-id83 . -8) (undo-tree-id84 . -8) (undo-tree-id85 . -8) (undo-tree-id86 . -1) (undo-tree-id87 . -19) (undo-tree-id88 . -19) (undo-tree-id89 . -19) (undo-tree-id90 . -19) (undo-tree-id91 . -19) (undo-tree-id92 . -19) (undo-tree-id93 . -19) (undo-tree-id94 . -19) (undo-tree-id95 . -19) (undo-tree-id96 . -19) (undo-tree-id97 . -19) (undo-tree-id98 . -19) (undo-tree-id99 . -19) (undo-tree-id100 . -19) (undo-tree-id101 . -19)) nil (26809 40682 795683 0) 0 nil])
([nil nil ((9942 . 9948) (t 26809 40682 0 0)) nil (26809 41525 994752 0) 0 nil])
([nil nil ((9948 . 9954)) nil (26809 41525 994752 0) 0 nil])
([nil nil ((9954 . 9955)) nil (26809 41525 994751 0) 0 nil])
([nil nil ((9955 . 9956)) nil (26809 41525 994751 0) 0 nil])
([nil nil ((#("X" 0 1 (fontified t)) . -9955) (undo-tree-id130 . -1) 9956) nil (26809 41525 994750 0) 0 nil])
([nil nil ((9955 . 9956)) nil (26809 41525 994750 0) 0 nil])
([nil nil ((#("A" 0 1 (fontified t)) . -9955) (undo-tree-id129 . -1) 9956) nil (26809 41525 994749 0) 0 nil])
([nil nil ((9955 . 9964)) nil (26809 41525 994748 0) 0 nil])
([nil nil ((9964 . 9970)) nil (26809 41525 994747 0) 0 nil])
([nil nil ((9970 . 9976)) nil (26809 41525 994747 0) 0 nil])
([nil nil ((9976 . 9977)) nil (26809 41525 994746 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 10000 . 10001) (nil fontified nil 9977 . 10001) (9977 . 10001)) nil (26809 41525 994745 0) 0 nil])
([nil nil ((10001 . 10002)) nil (26809 41525 994744 0) 0 nil])
([nil nil ((10002 . 10008)) nil (26809 41525 994744 0) 0 nil])
([nil nil ((10008 . 10009)) nil (26809 41525 994744 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -10008) (undo-tree-id124 . -1) (undo-tree-id125 . -1) (undo-tree-id126 . -1) (undo-tree-id127 . -1) (undo-tree-id128 . -1) 10009) nil (26809 41525 994743 0) 0 nil])
([nil nil ((10008 . 10013)) nil (26809 41525 994739 0) 0 nil])
([nil nil ((10013 . 10014)) nil (26809 41525 994739 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -10013) (undo-tree-id119 . -1) (undo-tree-id120 . -1) (undo-tree-id121 . -1) (undo-tree-id122 . -1) (undo-tree-id123 . -1) 10014) nil (26809 41525 994738 0) 0 nil])
([nil nil ((10013 . 10014)) nil (26809 41525 994734 0) 0 nil])
([nil nil ((10014 . 10015)) nil (26809 41525 994734 0) 0 nil])
([nil nil ((10015 . 10016)) nil (26809 41525 994733 0) 0 nil])
([nil nil ((10016 . 10022)) nil (26809 41525 994733 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -10021) (undo-tree-id118 . -1) 10022) nil (26809 41525 994731 0) 0 nil])
([nil nil ((10021 . 10022)) nil (26809 42337 290078 0) 0 nil])
([nil nil ((#("ent2" 0 4 (fontified t)) . -9861) (undo-tree-id400 . -4) 9865) nil (26809 42368 946573 0) 0 nil] [nil nil ((#("ent2" 0 4 (fontified t)) . -8991) (undo-tree-id140 . -4) 8995 (t 26809 41525 0 0)) ((8991 . 8995)) (26809 42336 822052 0) 0 nil])
([nil nil ((9861 . 9864)) nil (26809 42368 946572 0) 0 nil])
([nil nil ((8991 . 8994)) ((#("ret" 0 3 (fontified t)) . 8991)) (26809 42335 128734 0) 0 nil])
([nil nil ((#("(entity->row-alist ent2)" 0 23 (fontified t) 23 24 (fontified t rear-nonsticky t)) . -9976) (undo-tree-id393 . -24) (undo-tree-id394 . -23) (undo-tree-id395 . -23) (undo-tree-id396 . -23) (undo-tree-id397 . -23) (undo-tree-id398 . -24) (undo-tree-id399 . -24) 10000) nil (26809 42368 946571 0) 0 nil])
([nil nil ((#("(print (entity->row-alist ent2))
	  (print \"IN B\")
	  (entity->row-alist ent2)" 0 7 (fontified t) 7 30 (fontified t) 30 31 (fontified t rear-nonsticky t) 31 32 (fontified t) 32 33 (fontified t) 33 43 (fontified t) 43 49 (face font-lock-string-face fontified t) 49 51 (fontified t) 51 78 (fontified t)) . -9057) (undo-tree-id131 . -78) (undo-tree-id133 . -78) (undo-tree-id135 . -78) (undo-tree-id137 . -51) (undo-tree-id139 . -78) 9135) ((9057 . 9135)) (26809 42334 663750 0) 0 nil])
([nil nil ((9976 . 9979)) nil (26809 42368 946565 0) 0 nil])
([nil nil ((9057 . 9060)) ((#("ret" 0 3 (fontified t)) . 9057)) (26809 42334 309050 0) 0 nil])
([nil nil ((#("(entity->row-alist ent2)" 0 24 (fontified t)) . -10013) (undo-tree-id390 . -24) (undo-tree-id391 . -24) (undo-tree-id392 . -24) 10037) nil (26809 42368 946564 0) 0 nil])
([nil nil ((9053 . 9057) (t 26809 41759 0 0)) ((#("
	  " 0 1 (fontified t) 1 4 (fontified t)) . 9053) (undo-tree-id373 . -4) (undo-tree-id374 . -4) (undo-tree-id375 . -4) (undo-tree-id376 . -4) (undo-tree-id377 . -4) (undo-tree-id378 . -4) (undo-tree-id379 . -4) (undo-tree-id380 . -4) (undo-tree-id381 . -4) (undo-tree-id382 . -4) (undo-tree-id383 . -4) (undo-tree-id384 . -4) (undo-tree-id385 . -1) (undo-tree-id386 . -1) (undo-tree-id387 . -1) (undo-tree-id388 . -1) (undo-tree-id389 . -1)) (26809 42333 965878 0) 0 nil])
([nil nil ((10013 . 10016)) nil (26809 42368 946550 0) 0 nil])
([nil nil ((9057 . 9063)) ((#("(print" 0 6 (fontified t)) . 9057) (undo-tree-id361 . -6) (undo-tree-id362 . -6) (undo-tree-id363 . -6) (undo-tree-id364 . -6) (undo-tree-id365 . -6) (undo-tree-id366 . -6) (undo-tree-id367 . -6) (undo-tree-id368 . -6) (undo-tree-id369 . -6) (undo-tree-id370 . -6) (undo-tree-id371 . -6) (undo-tree-id372 . -6)) (26809 42333 659922 0) 0 nil])
([nil nil ((#("ret" 0 3 (fontified t)) . -9861) (undo-tree-id429 . -3) 9864 (t 26809 42368 0 0)) nil (26809 43046 250545 0) 0 nil])
([nil nil ((9063 . 9064)) ((#(" " 0 1 (fontified t)) . 9063) (undo-tree-id349 . -1) (undo-tree-id350 . -1) (undo-tree-id351 . -1) (undo-tree-id352 . -1) (undo-tree-id353 . -1) (undo-tree-id354 . -1) (undo-tree-id355 . -1) (undo-tree-id356 . -1) (undo-tree-id357 . -1) (undo-tree-id358 . -1) (undo-tree-id359 . -1) (undo-tree-id360 . -1)) (26809 42333 307557 0) 0 nil])
([nil nil ((9861 . 9865)) nil (26809 43046 250543 0) 0 nil])
([nil nil ((9064 . 9070)) ((#("\"RET\")" 0 5 (face font-lock-string-face fontified t) 5 6 (fontified t)) . 9064) (undo-tree-id337 . -6) (undo-tree-id338 . -6) (undo-tree-id339 . -6) (undo-tree-id340 . -6) (undo-tree-id341 . -6) (undo-tree-id342 . -6) (undo-tree-id343 . -6) (undo-tree-id344 . -6) (undo-tree-id345 . -6) (undo-tree-id346 . -6) (undo-tree-id347 . -6) (undo-tree-id348 . -6)) (26809 42332 867525 0) 0 nil])
([nil nil ((#("ret" 0 3 (fontified t)) . -9977) (undo-tree-id415 . -3) (undo-tree-id416 . -1) (undo-tree-id417 . -1) (undo-tree-id418 . -1) (undo-tree-id419 . -1) (undo-tree-id420 . -1) (undo-tree-id421 . -3) (undo-tree-id422 . -3) (undo-tree-id423 . -3) (undo-tree-id424 . -3) (undo-tree-id425 . -3) (undo-tree-id426 . -3) (undo-tree-id427 . -3) (undo-tree-id428 . -3) 9980) nil (26809 43046 250542 0) 0 nil])
([nil nil ((9070 . 9074)) ((#("
	  " 0 1 (fontified t) 1 4 (fontified t)) . 9070) (undo-tree-id324 . -4) (undo-tree-id325 . -1) (undo-tree-id326 . -4) (undo-tree-id327 . -4) (undo-tree-id328 . -4) (undo-tree-id329 . -4) (undo-tree-id330 . -1) (undo-tree-id331 . -1) (undo-tree-id332 . -1) (undo-tree-id333 . -1) (undo-tree-id334 . -1) (undo-tree-id335 . -1) (undo-tree-id336 . -1)) (26809 42332 506324 0) 0 nil])
([nil nil ((9977 . 9981)) nil (26809 43046 250532 0) 0 nil])
([nil nil ((9074 . 9080)) ((#("(prunt" 0 3 (fontified t) 3 4 (fontified t) 4 5 (fontified t) 5 6 (fontified t)) . 9074) (undo-tree-id319 . -6) (undo-tree-id320 . -3) (undo-tree-id321 . -3) (undo-tree-id322 . -3) (undo-tree-id323 . -3)) (26809 42332 156128 0) 0 nil])
([nil nil ((#("ret" 0 3 (fontified t)) . -10015) (undo-tree-id401 . -3) (undo-tree-id402 . -1) (undo-tree-id403 . -1) (undo-tree-id404 . -1) (undo-tree-id405 . -1) (undo-tree-id406 . -1) (undo-tree-id407 . -3) (undo-tree-id408 . -3) (undo-tree-id409 . -3) (undo-tree-id410 . -3) (undo-tree-id411 . -3) (undo-tree-id412 . -3) (undo-tree-id413 . -3) (undo-tree-id414 . -3) 10018) nil (26809 43046 250529 0) 0 nil])
([nil nil ((9080 . 9081)) ((#(" " 0 1 (fontified t)) . 9080) (undo-tree-id318 . -1)) (26809 42331 836716 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 10038 . 10039) (nil fontified nil 10015 . 10039) (10015 . 10039)) nil (26809 43046 250503 0) 0 nil])
([nil nil ((#("u" 0 1 (fontified t)) . -9077) (undo-tree-id141 . -1) (#("n" 0 1 (fontified t)) . -9078) (undo-tree-id142 . -1) (#("t" 0 1 (fontified t)) . -9079) (undo-tree-id143 . -1) (#(" " 0 1 (fontified t)) . -9080) (undo-tree-id144 . -1) 9081) ((9077 . 9081)) (26809 42331 521893 0) 0 nil])
([nil nil ((9471 . 9476) (t 26809 43046 0 0)) nil (26809 45070 243 0) 0 nil])
([nil nil ((9077 . 9080)) ((#("int" 0 3 (fontified t)) . 9077) (undo-tree-id313 . -3) (undo-tree-id314 . -3) (undo-tree-id315 . -3) (undo-tree-id316 . -3) (undo-tree-id317 . -3)) (26809 42331 190395 0) 0 nil])
([nil nil ((9476 . 9482)) nil (26809 45070 243 0) 0 nil])
([nil nil ((9080 . 9081)) ((#(" " 0 1 (fontified t)) . 9080) (undo-tree-id308 . -1) (undo-tree-id309 . -1) (undo-tree-id310 . -1) (undo-tree-id311 . -1) (undo-tree-id312 . -1)) (26809 42330 840024 0) 0 nil])
([nil nil ((9482 . 9483)) nil (26809 45070 242 0) 0 nil])
([nil nil ((9081 . 9083)) ((#("re" 0 2 (fontified t)) . 9081) (undo-tree-id303 . -2) (undo-tree-id304 . -2) (undo-tree-id305 . -2) (undo-tree-id306 . -2) (undo-tree-id307 . -2)) (26809 42330 187400 0) 0 nil])
([nil nil ((#("t" 0 1 (fontified t)) . -9478) (undo-tree-id430 . -1) (#("i" 0 1 (fontified t)) . -9479) (undo-tree-id431 . -1) (#("n" 0 1 (fontified t)) . -9480) (undo-tree-id432 . -1) (#("t" 0 1 (fontified t)) . -9481) (undo-tree-id433 . -1) (#(" " 0 1 (fontified t)) . -9482) (undo-tree-id434 . -1) 9483) nil (26809 45070 240 0) 0 nil])
([nil nil ((9083 . 9085)) ((#("t)" 0 2 (fontified t)) . 9083)) (26809 42329 727566 0) 0 nil])
([nil nil ((9478 . 9482)) nil (26809 45070 227 0) 0 nil])
([nil nil ((9178 . 9181) (t 26809 42133 0 0)) ((#("
  " 0 1 (fontified t) 1 3 (fontified t)) . 9178) (undo-tree-id289 . -3) (undo-tree-id290 . -3) (undo-tree-id291 . -3) (undo-tree-id292 . -1) (undo-tree-id293 . -1) (undo-tree-id294 . -1) (undo-tree-id295 . -1) (undo-tree-id296 . -1) (undo-tree-id297 . -1) (undo-tree-id298 . -1) (undo-tree-id299 . -1) (undo-tree-id300 . -1) (undo-tree-id301 . -1) (undo-tree-id302 . -1)) (26809 42329 511296 0) 0 nil])
([nil nil ((9482 . 9483)) nil (26809 45070 226 0) 0 nil])
([nil nil ((9181 . 9187)) ((#("(print" 0 6 (fontified t)) . 9181) (undo-tree-id286 . -6) (undo-tree-id287 . -6) (undo-tree-id288 . -6)) (26809 42329 273275 0) 0 nil])
([nil nil ((9483 . 9491)) nil (26809 45070 221 0) 0 nil])
([nil nil ((9187 . 9188)) ((#(" " 0 1 (fontified t)) . 9187) (undo-tree-id283 . -1) (undo-tree-id284 . -1) (undo-tree-id285 . -1)) (26809 42329 54929 0) 0 nil])
([nil nil ((9222 . 9225) (t 26809 45070 0 0)) nil (26809 46036 394100 0) 0 nil])
([nil nil ((9188 . 9191)) ((#("\"IN" 0 3 (face font-lock-string-face fontified t)) . 9188) (undo-tree-id280 . -1) (undo-tree-id281 . -3) (undo-tree-id282 . -3)) (26809 42328 792057 0) 0 nil])
([nil nil ((9225 . 9231)) nil (26809 46036 394100 0) 0 nil])
([nil nil ((9191 . 9192)) ((#(" " 0 1 (face font-lock-string-face fontified t)) . 9191) (undo-tree-id278 . -1) (undo-tree-id279 . -1)) (26809 42328 527818 0) 0 nil])
([nil nil ((9231 . 9232)) nil (26809 46036 394099 0) 0 nil])
([nil nil ((9192 . 9196)) ((#("REPO" 0 4 (face font-lock-string-face fontified t)) . 9192) (undo-tree-id276 . -4) (undo-tree-id277 . -4)) (26809 42328 244346 0) 0 nil])
([nil nil ((9232 . 9241)) nil (26809 46036 394095 0) 0 nil])
([nil nil ((9196 . 9197)) ((#(" " 0 1 (face font-lock-string-face fontified t)) . 9196) (undo-tree-id274 . -1) (undo-tree-id275 . -1)) (26809 42327 948726 0) 0 nil])
([nil nil ((4399 . 4404) (t 26809 46036 0 0)) nil (26809 46119 429979 0) 0 nil])
([nil nil ((9197 . 9203)) ((#("PATCH\"" 0 6 (face font-lock-string-face fontified t)) . 9197) (undo-tree-id272 . -5) (undo-tree-id273 . -6)) (26809 42327 657461 0) 0 nil])
([nil nil ((4404 . 4410)) nil (26809 46119 429978 0) 0 nil])
([nil nil ((9203 . 9204)) ((#("à" 0 1 (fontified t)) . 9203) (undo-tree-id271 . -1)) (26809 42327 378594 0) 0 nil])
([nil nil ((4410 . 4411)) nil (26809 46119 429977 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -9203) (undo-tree-id186 . -1) 9204) ((9203 . 9204)) (26809 42327 30419 0) 0 nil])
([nil nil ((4411 . 4414)) nil (26809 46119 429972 0) 0 nil])
([nil nil ((9203 . 9204)) ((#(")" 0 1 (fontified t)) . 9203)) (26809 42326 475973 0) 0 nil])
([nil nil ((#("(print p1)" 0 10 (fontified t)) . 4404) (undo-tree-id435 . -10) (undo-tree-id436 . -10) (undo-tree-id437 . -10) (undo-tree-id438 . -10) (undo-tree-id439 . -10) (undo-tree-id440 . -10) (undo-tree-id441 . -10) (undo-tree-id442 . -10) (undo-tree-id443 . -10) (undo-tree-id444 . -10) (undo-tree-id445 . -10) (undo-tree-id446 . -10) (t 26809 46119 0 0)) nil (26809 46243 417233 0) 0 nil])
([nil nil ((9263 . 9266)) ((#("
  " 0 1 (fontified t) 1 3 (fontified t)) . 9263) (undo-tree-id267 . -3) (undo-tree-id268 . -3) (undo-tree-id269 . -1) (undo-tree-id270 . -1)) (26809 42326 137292 0) 0 nil])
([nil nil ((5138 . 5143)) nil (26809 46243 417216 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9321 . 9322) (nil fontified nil 9313 . 9322) (nil fontified nil 9305 . 9313) (nil fontified nil 9301 . 9305) (nil fontified nil 9298 . 9301) (nil fontified nil 9286 . 9298) (nil fontified nil 9280 . 9286) (nil fontified nil 9276 . 9280) (nil fontified nil 9266 . 9276) (9266 . 9322)) ((#("(repo-persist :patch entity ctx :id id :payload payload)" 0 10 (fontified nil) 10 14 (fontified nil) 14 20 (face font-lock-builtin-face fontified nil) 20 32 (fontified nil) 32 35 (face font-lock-builtin-face fontified nil) 35 39 (fontified nil) 39 47 (face font-lock-builtin-face fontified nil) 47 55 (fontified nil) 55 56 (fontified nil rear-nonsticky nil)) . 9266) (nil rear-nonsticky t 9321 . 9322)) (26809 42325 804259 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5152 . 5153) (nil fontified nil 5143 . 5153) (5143 . 5153)) nil (26809 46243 417213 0) 0 nil])
([nil nil ((9263 . 9266)) ((#("
  " 0 1 (fontified t) 1 3 (fontified t)) . 9263) (undo-tree-id256 . -3) (undo-tree-id257 . -3) (undo-tree-id258 . -3) (undo-tree-id259 . -1) (undo-tree-id260 . -1) (undo-tree-id261 . -1) (undo-tree-id262 . -1) (undo-tree-id263 . -1) (undo-tree-id264 . -1) (undo-tree-id265 . -1) (undo-tree-id266 . -1)) (26809 42325 544993 0) 0 nil])
([nil nil ((5380 . 5385) (t 26809 46243 0 0)) nil (26809 46328 172346 0) 0 nil])
([nil nil ((9266 . 9272)) ((#("(print" 0 6 (fontified t)) . 9266) (undo-tree-id253 . -6) (undo-tree-id254 . -6) (undo-tree-id255 . -6)) (26809 42325 288686 0) 0 nil])
([nil nil ((5330 . 5332)) nil (26809 46328 172346 0) 0 nil])
([nil nil ((9272 . 9273)) ((#(" " 0 1 (fontified t)) . 9272) (undo-tree-id250 . -1) (undo-tree-id251 . -1) (undo-tree-id252 . -1)) (26809 42325 8381 0) 0 nil])
([nil nil ((5357 . 5359)) nil (26809 46328 172345 0) 0 nil])
([nil nil ((9273 . 9274)) ((#("(" 0 1 (fontified t)) . 9273) (undo-tree-id247 . -1) (undo-tree-id248 . -1) (undo-tree-id249 . -1)) (26809 42324 734269 0) 0 nil])
([nil nil ((5384 . 5389)) nil (26809 46328 172345 0) 0 nil])
([nil nil ((9274 . 9278)) ((#("\"FAT" 0 1 (face font-lock-string-face fontified t) 1 2 (face font-lock-string-face fontified t) 2 3 (face font-lock-string-face fontified t) 3 4 (face font-lock-string-face fontified t)) . 9274) (undo-tree-id244 . -4) (undo-tree-id245 . -1) (undo-tree-id246 . -1)) (26809 42324 464307 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5413 . 5414) (nil fontified nil 5406 . 5414) (nil fontified nil 5396 . 5406) (nil fontified nil 5389 . 5396) (5389 . 5414)) nil (26809 46328 172344 0) 0 nil])
([nil nil ((#("F" 0 1 (face font-lock-string-face fontified t)) . -9275) (undo-tree-id183 . -1) (#("A" 0 1 (face font-lock-string-face fontified t)) . -9276) (undo-tree-id184 . -1) (#("T" 0 1 (face font-lock-string-face fontified t)) . -9277) (undo-tree-id185 . -1) 9278) ((9275 . 9278)) (26809 42324 178552 0) 0 nil])
([nil nil ((#("(acons :tenant_id tid p1)" 0 7 (fontified t) 7 17 (face font-lock-builtin-face fontified t) 17 24 (fontified t) 24 25 (rear-nonsticky t fontified t)) . -5389) (undo-tree-id447 . -25) (undo-tree-id448 . -25) (undo-tree-id449 . -25) (undo-tree-id450 . -4) (undo-tree-id451 . -4) (undo-tree-id452 . -4) (undo-tree-id453 . -4) (undo-tree-id454 . -4) (undo-tree-id455 . -1) (undo-tree-id456 . -6) (undo-tree-id457 . -6) (undo-tree-id458 . -1) (undo-tree-id459 . -6) (undo-tree-id460 . -6) (undo-tree-id461 . -6) (undo-tree-id462 . -6) (undo-tree-id463 . -6) (undo-tree-id464 . -6) (undo-tree-id465 . -1) (undo-tree-id466 . -25) (undo-tree-id467 . -25) (undo-tree-id468 . -25) (undo-tree-id469 . -25) (undo-tree-id470 . -25) (undo-tree-id471 . -25) 5414) nil (26809 46328 172342 0) 0 nil])
([nil nil ((9275 . 9280)) ((#("AFTER" 0 5 (face font-lock-string-face fontified t)) . 9275) (undo-tree-id234 . -5) (undo-tree-id235 . -5) (undo-tree-id236 . -5) (undo-tree-id237 . -5) (undo-tree-id238 . -5) (undo-tree-id239 . -5) (undo-tree-id240 . -5) (undo-tree-id241 . -5) (undo-tree-id242 . -5) (undo-tree-id243 . -5)) (26809 42323 894714 0) 0 nil])
([nil nil ((nil fontified nil 5440 . 5441) (nil fontified nil 5435 . 5440) (nil fontified nil 5430 . 5435) (nil fontified nil 5425 . 5430) (nil fontified nil 5415 . 5425) (nil fontified nil 5389 . 5415) (5389 . 5441)) nil (26809 46328 172313 0) 0 nil])
([nil nil ((9280 . 9281)) ((#(" " 0 1 (face font-lock-string-face fontified t)) . 9280) (undo-tree-id224 . -1) (undo-tree-id225 . -1) (undo-tree-id226 . -1) (undo-tree-id227 . -1) (undo-tree-id228 . -1) (undo-tree-id229 . -1) (undo-tree-id230 . -1) (undo-tree-id231 . -1) (undo-tree-id232 . -1) (undo-tree-id233 . -1)) (26809 42323 586180 0) 0 nil])
([nil nil ((9683 . 9685) (t 26809 46328 0 0)) nil (26809 46398 572879 0) 0 nil])
([nil nil ((9281 . 9285)) ((#("REPO" 0 4 (face font-lock-string-face fontified t)) . 9281) (undo-tree-id214 . -4) (undo-tree-id215 . -4) (undo-tree-id216 . -4) (undo-tree-id217 . -4) (undo-tree-id218 . -4) (undo-tree-id219 . -4) (undo-tree-id220 . -4) (undo-tree-id221 . -4) (undo-tree-id222 . -4) (undo-tree-id223 . -4)) (26809 42323 295186 0) 0 nil])
([nil nil ((9862 . 9864)) nil (26809 46398 572875 0) 0 nil])
([nil nil ((9285 . 9286)) ((#(" " 0 1 (face font-lock-string-face fontified t)) . 9285) (undo-tree-id204 . -1) (undo-tree-id205 . -1) (undo-tree-id206 . -1) (undo-tree-id207 . -1) (undo-tree-id208 . -1) (undo-tree-id209 . -1) (undo-tree-id210 . -1) (undo-tree-id211 . -1) (undo-tree-id212 . -1) (undo-tree-id213 . -1)) (26809 42322 998513 0) 0 nil])
([nil nil ((10433 . 10439) (10389 . 10391) (10430 . 10431) (t 26809 46398 0 0)) nil (26809 46984 818997 0) 0 nil])
([nil nil ((9286 . 9293)) ((#("PATCH\")" 0 6 (face font-lock-string-face fontified t) 6 7 (fontified t)) . 9286) (undo-tree-id195 . -7) (undo-tree-id196 . -5) (undo-tree-id197 . -5) (undo-tree-id198 . -5) (undo-tree-id199 . -5) (undo-tree-id200 . -7) (undo-tree-id201 . -7) (undo-tree-id202 . -7) (undo-tree-id203 . -7)) (26809 42322 684433 0) 0 nil])
([nil nil ((10439 . 10445)) nil (26809 46984 818997 0) 0 nil])
([nil nil ((9207 . 9213)) ((#("(print" 0 6 (fontified t)) . 9207) (undo-tree-id194 . -6)) (26809 42322 355043 0) 0 nil])
([nil nil ((10445 . 10446)) nil (26809 46984 818996 0) 0 nil])
([nil nil ((9213 . 9214)) ((#(" " 0 1 (fontified t)) . 9213)) (26809 42321 950126 0) 0 nil])
([nil nil ((10446 . 10449)) nil (26809 46984 818996 0) 0 nil])
([nil nil ((9270 . 9271)) ((#(")" 0 1 (fontified t)) . 9270) (undo-tree-id192 . -1) (undo-tree-id193 . -1)) (26809 42321 583414 0) 0 nil])
([nil nil ((10449 . 10450)) nil (26809 46984 818996 0) 0 nil])
([nil nil ((9301 . 9302)) ((#(")" 0 1 (fontified t)) . 9301)) (26809 42321 241046 0) 0 nil])
([nil nil ((10450 . 10454)) nil (26809 46984 818995 0) 0 nil])
([nil nil ((9204 . 9205)) ((#(")" 0 1 (fontified t)) . 9204) (undo-tree-id191 . -1)) (26809 42320 852087 0) 0 nil])
([nil nil ((10454 . 10455)) nil (26809 46984 818995 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -9204) (undo-tree-id175 . -1) (undo-tree-id177 . -1) (undo-tree-id179 . -1) (undo-tree-id181 . -1) 9205) ((9204 . 9205)) (26809 42320 506854 0) 0 nil])
([nil nil ((10455 . 10464)) nil (26809 46984 818994 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -9301) (undo-tree-id165 . -1) (undo-tree-id167 . -1) (undo-tree-id169 . -1) (undo-tree-id171 . -1) (undo-tree-id173 . -1) 9302) ((9301 . 9302)) (26809 42320 178614 0) 0 nil])
([nil nil ((10550 . 10556) (10506 . 10508) (10547 . 10548)) nil (26809 46984 818994 0) 0 nil])
([nil nil ((9301 . 9302)) ((#(")" 0 1 (fontified t)) . 9301) (undo-tree-id187 . -1) (undo-tree-id188 . -1) (undo-tree-id189 . -1) (undo-tree-id190 . -1)) (26809 42319 848087 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 10580 . 10581) (nil fontified nil 10580 . 10581) (nil fontified nil 10563 . 10580) (nil fontified nil 10556 . 10563) (10556 . 10581)) nil (26809 46984 818993 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -9281) (undo-tree-id158 . -1) (undo-tree-id160 . -1) (undo-tree-id162 . -1) (undo-tree-id164 . -1) 9282) ((9281 . 9282)) (26809 42319 536858 0) 0 nil])
([nil nil ((10579 . 10580)) nil (26809 46984 818992 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -9300) (undo-tree-id145 . -1) (undo-tree-id146 . -1) (undo-tree-id148 . -1) (undo-tree-id150 . -1) (undo-tree-id152 . -1) (undo-tree-id154 . -1) (undo-tree-id156 . -1) 9301) ((9300 . 9301) (t 26809 42207 0 0)) (26809 42207 465429 0) 0 nil])
([nil nil ((10580 . 10582)) nil (26809 46984 818991 0) 0 nil])
nil
([nil nil ((10591 . 10593) (10469 . 10471) 10278) nil (26809 46984 818988 0) 0 nil])
([nil nil ((10586 . 10593) (t 26809 46984 0 0)) nil (26809 47194 274956 0) 0 nil])
([nil nil ((10593 . 10599)) nil (26809 47194 274955 0) 0 nil])
([nil nil ((10599 . 10600)) nil (26809 47194 274955 0) 0 nil])
([nil nil ((10600 . 10603)) nil (26809 47194 274954 0) 0 nil])
([nil nil ((2521 . 2523)) nil (26809 47194 274953 0) 0 nil])
([nil nil ((#("x" 0 1 (fontified t)) . -2521) (undo-tree-id472 . -1) (#("b" 0 1 (fontified t)) . -2522) (undo-tree-id473 . -1) 2523) nil (26809 47194 274950 0) 0 nil])
([nil nil ((6022 . 6025) (t 26809 47194 0 0)) nil (26809 47585 674223 0) 0 nil])
([nil nil ((6025 . 6031)) nil (26809 47585 674223 0) 0 nil])
([nil nil ((6031 . 6032)) nil (26809 47585 674222 0) 0 nil])
([nil nil ((6032 . 6036)) nil (26809 47585 674222 0) 0 nil])
([nil nil ((6036 . 6039)) nil (26809 47585 674222 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -6035) (undo-tree-id481 . -1) 6036) nil (26809 47585 674221 0) 0 nil])
([nil nil ((6035 . 6036)) nil (26809 47585 674220 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 6036) (undo-tree-id478 . -1) (undo-tree-id479 . -1) (undo-tree-id480 . -1)) nil (26809 47585 674219 0) 0 nil])
([nil nil ((#("	 " 0 1 (fontified nil) 1 2 (fontified nil)) . -6039) (undo-tree-id474 . -2) (undo-tree-id475 . -2) (undo-tree-id476 . -2) (undo-tree-id477 . -2) (6039 . 6040) (#("	" 0 1 (fontified nil)) . 6039) (6036 . 6039)) nil (26809 47585 674216 0) 0 nil])
([nil nil ((6039 . 6045)) nil (26809 47585 674204 0) 0 nil])
([nil nil ((6045 . 6046)) nil (26809 47585 674204 0) 0 nil])
([nil nil ((6046 . 6053)) nil (26809 47585 674200 0) 0 nil])
([nil nil ((12181 . 12183) (t 26809 47585 0 0)) nil (26809 47724 266721 0) 0 nil])
([nil nil ((12183 . 12184)) nil (26809 47724 266721 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -12183) (undo-tree-id490 . -1) 12184) nil (26809 47724 266720 0) 0 nil])
([nil nil ((12183 . 12188)) nil (26809 47724 266719 0) 0 nil])
([nil nil ((12188 . 12189)) nil (26809 47724 266719 0) 0 nil])
([nil nil ((12189 . 12190)) nil (26809 47724 266719 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -12183) (undo-tree-id483 . -1) (#("r" 0 1 (fontified t)) . -12184) (undo-tree-id484 . -1) (#("i" 0 1 (fontified t)) . -12185) (undo-tree-id485 . -1) (#("n" 0 1 (fontified t)) . -12186) (undo-tree-id486 . -1) (#("t" 0 1 (fontified t)) . -12187) (undo-tree-id487 . -1) (#(" " 0 1 (fontified t)) . -12188) (undo-tree-id488 . -1) (#("'" 0 1 (fontified t)) . -12189) (undo-tree-id489 . -1) 12190) nil (26809 47724 266718 0) 0 nil])
([nil nil ((12183 . 12189)) nil (26809 47724 266712 0) 0 nil])
([nil nil ((12189 . 12190)) nil (26809 47724 266711 0) 0 nil])
([nil nil ((12190 . 12191)) nil (26809 47724 266711 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -12190) (undo-tree-id482 . -1) 12191) nil (26809 47724 266710 0) 0 nil])
([nil nil ((12190 . 12197)) nil (26809 47724 266701 0) 0 nil])
([nil nil ((12197 . 12198)) nil (26809 47724 266701 0) 0 nil])
([nil nil ((12198 . 12206)) nil (26809 47724 266700 0) 0 nil])
([nil nil ((12206 . 12208)) nil (26809 47724 266700 0) 0 nil])
([nil nil ((12208 . 12214)) nil (26809 47724 266699 0) 0 nil])
([nil nil ((12214 . 12215)) nil (26809 47724 266699 0) 0 nil])
([nil nil ((12215 . 12219)) nil (26809 47724 266695 0) 0 nil])
([nil nil ((6022 . 6025) (t 26809 47724 0 0)) nil (26809 47774 116141 0) 0 nil])
([nil nil ((6025 . 6031)) nil (26809 47774 116140 0) 0 nil])
([nil nil ((6031 . 6032)) nil (26809 47774 116140 0) 0 nil])
([nil nil ((6032 . 6035)) nil (26809 47774 116140 0) 0 nil])
([nil nil ((6035 . 6036)) nil (26809 47774 116139 0) 0 nil])
([nil nil ((6036 . 6040)) nil (26809 47774 116139 0) 0 nil])
([nil nil ((6040 . 6041)) nil (26809 47774 116138 0) 0 nil])
([nil nil ((6041 . 6047)) nil (26809 47774 116138 0) 0 nil])
([nil nil ((#(")" 0 1 (face font-lock-string-face fontified t)) . -6046) (undo-tree-id491 . -1) (undo-tree-id492 . -1) 6047) nil (26809 47774 116137 0) 0 nil])
([nil nil ((6046 . 6048)) nil (26809 47774 116123 0) 0 nil])
([nil nil ((6048 . 6049) (t 26809 47774 0 0)) nil (26809 47777 64693 0) 0 nil])
([nil nil ((#("o" 0 1 (fontified t)) . -6048) (undo-tree-id493 . -1) (undo-tree-id494 . -1) (undo-tree-id495 . -1) (undo-tree-id496 . -1) (undo-tree-id497 . -1) 6049 (t 26809 47777 0 0)) nil (26809 47778 295272 0) 0 nil])
([nil nil ((#("list" 0 4 (fontified t)) . -10668) (undo-tree-id498 . -4) (undo-tree-id499 . -4) (undo-tree-id500 . -4) 10672 (t 26809 47778 0 0)) nil (26809 48002 674943 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . 10668)) nil (26809 48002 674932 0) 0 nil])
([nil nil ((10667 . 10669)) nil (26809 48002 674931 0) 0 nil])
([nil nil ((10685 . 10686)) nil (26809 48002 674930 0) 0 nil])
([nil nil ((10692 . 10693)) nil (26809 48002 674926 0) 0 nil])
([nil nil ((10680 . 10681) (t 26809 48002 0 0)) nil (26809 48015 473173 0) 0 nil])
([nil nil ((#("à" 0 1 (fontified t)) . -10680) (undo-tree-id501 . -1) (undo-tree-id502 . -1) (undo-tree-id503 . -1) (undo-tree-id504 . -1) (undo-tree-id505 . -1) (undo-tree-id506 . -1) (undo-tree-id507 . -1) (undo-tree-id508 . -1) (undo-tree-id509 . -1) (undo-tree-id510 . -1) (undo-tree-id511 . -1) 10681) nil (26809 48015 473171 0) 0 nil])
([nil nil ((10680 . 10681)) nil (26809 48015 473154 0) 0 nil])
([nil nil ((10679 . 10680)) nil (26809 48015 473154 0) 0 nil])
([nil nil ((10680 . 10681)) nil (26809 48015 473153 0) 0 nil])
([nil nil ((10684 . 10685)) nil (26809 48015 473153 0) 0 nil])
([nil nil ((10688 . 10689)) nil (26809 48015 473152 0) 0 nil])
([nil nil ((10689 . 10690)) nil (26809 48015 473148 0) 0 nil])
([nil nil ((#("
	    (print \"AAAAAA\")
	    (print ent2)
	    (print \"JJJJ\")" 0 1 (fontified t) 1 13 (fontified t) 13 21 (face font-lock-string-face fontified t) 21 23 (fontified t) 23 39 (fontified t) 39 41 (fontified t) 41 53 (fontified t) 53 59 (face font-lock-string-face fontified t) 59 60 (fontified t)) . 10128) (undo-tree-id583 . -60) (t 26809 48015 0 0)) nil (26810 37955 317941 0) 0 nil])
([nil nil ((#("
      (print \"ZZZZZZZZZZZ\")" 0 1 (fontified t) 1 14 (fontified t) 14 27 (face font-lock-string-face fontified t) 27 28 (fontified t)) . 9952) (undo-tree-id582 . -28)) nil (26810 37955 317940 0) 0 nil])
([nil nil ((#("
    (print \"CURRRRR\")
    (print cur)
    (print payload)" 0 1 (fontified t) 1 12 (fontified t) 12 20 (face font-lock-string-face fontified t) 20 21 (face font-lock-string-face fontified t) 21 23 (fontified t) 23 39 (fontified t) 39 58 (fontified t)) . 9595) (undo-tree-id581 . -58)) nil (26810 37955 317939 0) 0 nil])
([nil nil ((#("
  (print \"INNNNN\")" 0 1 (fontified t) 1 10 (fontified t) 10 18 (face font-lock-string-face fontified t) 18 19 (fontified t)) . 9365) (undo-tree-id580 . -19)) nil (26810 37955 317938 0) 0 nil])
([nil nil ((#("
	  (print \"IN B\")" 0 1 (fontified t) 1 11 (fontified t) 11 17 (face font-lock-string-face fontified t) 17 18 (fontified t)) . 9233) (undo-tree-id579 . -18)) nil (26810 37955 317937 0) 0 nil])
([nil nil ((#("
	(print \"IN A\")" 0 1 (fontified t) 1 9 (fontified t) 9 15 (face font-lock-string-face fontified t) 15 16 (fontified t)) . 9092) (undo-tree-id578 . -16)) nil (26810 37955 317936 0) 0 nil])
([nil nil ((#("
    (print \"XXXX\")" 0 12 (fontified t) 12 18 (face font-lock-string-face fontified t) 18 19 (fontified t)) . 9036) (undo-tree-id577 . -19)) nil (26810 37955 317935 0) 0 nil])
([nil nil ((#("
    (print \"ENTTTTT\")" 0 12 (fontified t) 12 21 (face font-lock-string-face fontified t) 21 22 (fontified t)) . 8987) (undo-tree-id576 . -22)) nil (26810 37955 317934 0) 0 nil])
([nil nil ((#("
	(print \"DELETE AROUND\")
	(print res)" 0 1 (fontified t) 1 9 (fontified t) 9 24 (face font-lock-string-face fontified t) 24 26 (fontified t) 26 38 (fontified t)) . 11972) (undo-tree-id575 . -38)) nil (26810 37955 317933 0) 0 nil])
([nil nil ((#("
	  (print \"REPO AFTER\")" 0 1 (fontified t) 1 11 (fontified t) 11 12 (face font-lock-string-face fontified t) 12 22 (face font-lock-string-face fontified t) 22 23 (face font-lock-string-face fontified t) 23 24 (fontified t)) . 11208) (undo-tree-id574 . -24)) nil (26810 37955 317932 0) 0 nil])
([nil nil ((#("
      (print \"IN REPO PERSIST 11\")
      (print id)" 0 1 (fontified t) 1 7 (fontified t) 7 14 (fontified t) 14 34 (face font-lock-string-face fontified t) 34 35 (fontified t rear-nonsticky t) 35 36 (fontified t) 36 52 (fontified t)) . 10368) (undo-tree-id573 . -52)) nil (26810 37955 317931 0) 0 nil])
([nil nil ((#("
      (print \"IN REPO PERSIST\")" 0 1 (fontified t) 1 14 (fontified t) 14 31 (face font-lock-string-face fontified t) 31 32 (fontified t)) . 10249) (undo-tree-id570 . -32) (undo-tree-id571 . -32) (undo-tree-id572 . -32)) nil (26810 37955 317930 0) 0 nil])
([nil nil ((#("
  (print \"IN REPO AFTER\")
  (print ctx)
  (print result)" 0 1 (fontified t) 1 10 (fontified t) 10 25 (face font-lock-string-face fontified t) 25 26 (fontified t) 26 27 (fontified t) 27 41 (fontified t) 41 57 (fontified t)) . 6022) (undo-tree-id569 . -57)) nil (26810 37955 317928 0) 0 nil])
([nil nil ((#("
     (print \"ENT\")
     (print ent)" 0 13 (fontified t) 13 18 (face font-lock-string-face fontified t) 18 36 (fontified t)) . 5686) (undo-tree-id568 . -36)) nil (26810 37955 317927 0) 0 nil])
([nil nil ((#("
  (print \"**** IN REPO-VALIDATE\")" 0 1 (face font-lock-comment-face fontified t) 1 10 (fontified t) 10 33 (face font-lock-string-face fontified t) 33 34 (fontified t)) . 5589) (undo-tree-id567 . -34)) nil (26810 37955 317926 0) 0 nil])
([nil nil ((#("
    (format t \"~&TID: ~A~%\" tid)
    (print p1)" 0 1 (fontified t) 1 5 (fontified t) 5 15 (fontified t) 15 28 (fontified t face font-lock-string-face) 28 32 (fontified t) 32 33 (fontified t rear-nonsticky t) 33 34 (fontified t) 34 38 (fontified t) 38 47 (fontified t) 47 48 (fontified t rear-nonsticky t)) . 5105) (undo-tree-id566 . -48)) nil (26810 37955 317926 0) 0 nil])
([nil nil ((#("
	 (x (print p1))" 0 1 (fontified t) 1 3 (fontified t) 3 16 (fontified t) 16 17 (fontified t rear-nonsticky t)) . 5044) (undo-tree-id565 . -17)) nil (26810 37955 317925 0) 0 nil])
([nil nil ((#("
	 (x (print p0))" 0 1 (fontified t) 1 3 (fontified t) 3 16 (fontified t) 16 17 (fontified t rear-nonsticky t)) . 4983) (undo-tree-id564 . -17)) nil (26810 37955 317924 0) 0 nil])
([nil nil ((#("
	 (x (print out))" 0 1 (fontified t) 1 18 (fontified t)) . 4921) (undo-tree-id563 . -18)) nil (26810 37955 317923 0) 0 nil])
([nil nil ((#("
    (format t \"~&TID: ~A~%\" tid)" 0 1 (face font-lock-comment-face fontified t) 1 15 (fontified t) 15 28 (face font-lock-string-face fontified t) 28 33 (fontified t)) . 4366) (undo-tree-id562 . -33)) nil (26810 37955 317922 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4042) (undo-tree-id556 . -1) (#(" " 0 1 (fontified t)) . -4043) (undo-tree-id557 . -1) (#(" " 0 1 (fontified t)) . -4044) (undo-tree-id558 . -1) (#(" " 0 1 (fontified t)) . -4045) (undo-tree-id559 . -1) (#(" " 0 1 (fontified t)) . -4046) (undo-tree-id560 . -1) (#(" " 0 1 (fontified t)) . -4047) (undo-tree-id561 . -1) 4048) nil (26810 37955 317920 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4125) (undo-tree-id550 . -1) (#(" " 0 1 (fontified t)) . -4126) (undo-tree-id551 . -1) (#(" " 0 1 (fontified t)) . -4127) (undo-tree-id552 . -1) (#(" " 0 1 (fontified t)) . -4128) (undo-tree-id553 . -1) (#(" " 0 1 (fontified t)) . -4129) (undo-tree-id554 . -1) (#(" " 0 1 (fontified t)) . -4130) (undo-tree-id555 . -1) 4131) nil (26810 37955 317916 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4122) (undo-tree-id547 . -1) (#(" " 0 1 (fontified t)) . -4123) (undo-tree-id548 . -1) (#(" " 0 1 (fontified t)) . -4124) (undo-tree-id549 . -1) 4125) nil (26810 37955 317912 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4039) (undo-tree-id544 . -1) (#(" " 0 1 (fontified t)) . -4040) (undo-tree-id545 . -1) (#(" " 0 1 (fontified t)) . -4041) (undo-tree-id546 . -1) 4042) nil (26810 37955 317909 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4206) (undo-tree-id535 . -1) (#(" " 0 1 (fontified t)) . -4207) (undo-tree-id536 . -1) (#(" " 0 1 (fontified t)) . -4208) (undo-tree-id537 . -1) (#(" " 0 1 (fontified t)) . -4209) (undo-tree-id538 . -1) (#(" " 0 1 (fontified t)) . -4210) (undo-tree-id539 . -1) (#(" " 0 1 (fontified t)) . -4211) (undo-tree-id540 . -1) (#(" " 0 1 (fontified t)) . -4212) (undo-tree-id541 . -1) (#(" " 0 1 (fontified t)) . -4213) (undo-tree-id542 . -1) (#(" " 0 1 (fontified t)) . -4214) (undo-tree-id543 . -1) 4215) nil (26810 37955 317906 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4290) (undo-tree-id523 . -1) (#(" " 0 1 (fontified t)) . -4291) (undo-tree-id524 . -1) (#(" " 0 1 (fontified t)) . -4292) (undo-tree-id525 . -1) (#(" " 0 1 (fontified t)) . -4293) (undo-tree-id526 . -1) (#(" " 0 1 (fontified t)) . -4294) (undo-tree-id527 . -1) (#(" " 0 1 (fontified t)) . -4295) (undo-tree-id528 . -1) (#(" " 0 1 (fontified t)) . -4296) (undo-tree-id529 . -1) (#(" " 0 1 (fontified t)) . -4297) (undo-tree-id530 . -1) (#(" " 0 1 (fontified t)) . -4298) (undo-tree-id531 . -1) (#(" " 0 1 (fontified t)) . -4299) (undo-tree-id532 . -1) (#(" " 0 1 (fontified t)) . -4300) (undo-tree-id533 . -1) (#(" " 0 1 (fontified t)) . -4301) (undo-tree-id534 . -1) 4302) nil (26810 37955 317899 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4203) (undo-tree-id520 . -1) (#(" " 0 1 (fontified t)) . -4204) (undo-tree-id521 . -1) (#(" " 0 1 (fontified t)) . -4205) (undo-tree-id522 . -1) 4206) nil (26810 37955 317892 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4116) (undo-tree-id517 . -1) (#(" " 0 1 (fontified t)) . -4117) (undo-tree-id518 . -1) (#(" " 0 1 (fontified t)) . -4118) (undo-tree-id519 . -1) 4119) nil (26810 37955 317889 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4036) (undo-tree-id514 . -1) (#(" " 0 1 (fontified t)) . -4037) (undo-tree-id515 . -1) (#(" " 0 1 (fontified t)) . -4038) (undo-tree-id516 . -1) 4039) nil (26810 37955 317884 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face fontified t)) . -3664) (undo-tree-id513 . -1) 3665) nil (26810 37955 317881 0) 0 nil])
([nil nil ((3664 . 3665)) nil (26810 37955 317878 0) 0 nil])
([nil nil ((#("
	(print \"ROWS\")
	(print row)" 0 9 (fontified t) 9 15 (face font-lock-string-face fontified t) 15 29 (fontified t)) . 13727) (undo-tree-id512 . -29)) nil (26810 37955 317874 0) 0 nil])
([nil nil ((#(" :tenant-id-for-host :tenant-id-by-code :tenant-code-by-id" 0 1 (fontified t) 1 20 (face font-lock-builtin-face fontified t) 20 21 (fontified t) 21 39 (face font-lock-builtin-face fontified t) 39 40 (fontified t) 40 58 (face font-lock-builtin-face fontified t)) . -965) (undo-tree-id617 . -2) (undo-tree-id618 . -20) (undo-tree-id619 . -58) 1023 (t 26810 37955 0 0)) nil (26810 38044 874596 0) 0 nil])
([nil nil ((650 . 652) (#(" " 0 1 (fontified nil)) . -611) (650 . 651)) nil (26810 38044 874593 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 761 . 762) (nil fontified nil 761 . 762) (nil fontified nil 760 . 761) (nil fontified nil 747 . 760) (nil fontified nil 746 . 747) (nil fontified nil 745 . 746) (nil fontified nil 727 . 745) (nil fontified nil 724 . 727) (nil fontified nil 723 . 724) (nil fontified nil 704 . 723) (nil fontified nil 703 . 704) (nil fontified nil 685 . 703) (nil fontified nil 684 . 685) (nil fontified nil 666 . 684) (nil fontified nil 665 . 666) (nil fontified nil 653 . 665) (nil fontified nil 652 . 653) (652 . 762)) nil (26810 38044 874592 0) 0 nil])
([nil nil ((#(":normalize-host" 0 1 (face font-lock-builtin-face fontified t) 1 14 (face font-lock-builtin-face fontified t) 14 15 (face font-lock-builtin-face fontified t rear-nonsticky t)) . -746) (undo-tree-id603 . -15) (undo-tree-id604 . -10) (undo-tree-id605 . -10) (undo-tree-id606 . -10) (undo-tree-id607 . -10) (undo-tree-id608 . -10) (undo-tree-id609 . -15) (undo-tree-id610 . -15) (undo-tree-id611 . -15) (undo-tree-id612 . -15) (undo-tree-id613 . -15) (undo-tree-id614 . -15) (undo-tree-id615 . -15) (undo-tree-id616 . -15) 761) nil (26810 38044 874588 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -745) (undo-tree-id584 . -1) (undo-tree-id585 . -1) (undo-tree-id586 . -1) (undo-tree-id587 . -1) (undo-tree-id588 . -1) (undo-tree-id589 . -1) (undo-tree-id590 . -1) (undo-tree-id591 . -1) (undo-tree-id592 . -1) (undo-tree-id593 . -1) (undo-tree-id594 . -1) (undo-tree-id595 . -1) (undo-tree-id596 . -1) (undo-tree-id597 . -1) (undo-tree-id598 . -1) (undo-tree-id599 . -1) (undo-tree-id600 . -1) (undo-tree-id601 . -1) (undo-tree-id602 . -1) 746) nil (26810 38044 874578 0) 0 nil])
([nil nil ((#("
	 (x (format t \"P TID: ~A~%\" p-tid))" 0 1 (fontified t) 1 11 (fontified t) 11 16 (fontified t) 16 19 (face font-lock-string-face fontified t) 19 29 (face font-lock-string-face fontified t) 29 37 (fontified t)) . 15742) (undo-tree-id622 . -37) (t 26810 38044 0 0)) nil (26810 38822 958582 0) 0 nil])
([nil nil ((#("
	 (x (print payload))" 0 1 (fontified t) 1 22 (fontified t)) . 15602) (undo-tree-id621 . -22)) nil (26810 38822 958579 0) 0 nil])
([nil nil ((#("
	     (print \"C'EST PTID\")" 0 1 (face font-lock-comment-face fontified t) 1 14 (fontified t) 14 17 (face font-lock-string-face fontified t) 17 26 (face font-lock-string-face fontified t) 26 27 (fontified t)) . 15947) (undo-tree-id620 . -27)) nil (26810 38822 958575 0) 0 nil])
([nil nil ((164 . 165) (t 26810 38822 0 0)) nil (26812 49442 76477 0) 0 nil])
([nil nil ((165 . 172)) nil (26812 49442 76476 0) 0 nil])
([nil nil ((165 . 176) (#("respond" 0 7 (fontified t)) . -165) (undo-tree-id0 . -7) (undo-tree-id1 . -7) (undo-tree-id2 . -7) (undo-tree-id3 . -7) 172) nil (26812 49442 76474 0) 0 nil])
([nil nil ((165 . 166)) nil (26812 49442 76445 0) 0 nil])
([nil nil ((#("entity" 0 6 (fontified t)) . -5400) (undo-tree-id59 . -6) 5406 (t 26812 49442 0 0)) nil (26812 50233 431231 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -5399) (undo-tree-id57 . -1) (undo-tree-id58 . -1) 5400) nil (26812 50233 431229 0) 0 nil])
([nil nil ((#("entity" 0 6 (fontified t)) . -5796) (undo-tree-id56 . -6) 5802) nil (26812 50233 431227 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -5792) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (#("o" 0 1 (fontified t)) . -5793) (undo-tree-id50 . -1) (undo-tree-id51 . -1) (#("p" 0 1 (fontified t)) . -5794) (undo-tree-id52 . -1) (undo-tree-id53 . -1) (#(" " 0 1 (fontified t)) . -5795) (undo-tree-id54 . -1) (undo-tree-id55 . -1) 5796) nil (26812 50233 431225 0) 0 nil])
([nil nil ((#(" :before before" 0 1 (fontified t) 1 8 (face font-lock-builtin-face fontified t) 8 15 (fontified t)) . -7537) (undo-tree-id47 . -15) 7552) nil (26812 50233 431220 0) 0 nil])
([nil nil ((#("
         " 0 1 (fontified t) 1 10 (fontified t)) . -7558) (undo-tree-id46 . -10) 7568) nil (26812 50233 431218 0) 0 nil])
([nil nil ((7558 . 7559)) nil (26812 50233 431217 0) 0 nil])
([nil nil ((9156 . 9157)) nil (26812 50233 431217 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9163 . 9164) (nil fontified nil 9157 . 9164) (9157 . 9164)) nil (26812 50233 431216 0) 0 nil])
([nil nil ((#("payload" 0 6 (fontified t) 6 7 (rear-nonsticky t fontified t)) . -9157) (undo-tree-id45 . -7) 9164) nil (26812 50233 431215 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -9156) (undo-tree-id43 . -1) (undo-tree-id44 . -1) 9157) nil (26812 50233 431213 0) 0 nil])
([nil nil ((9877 . 9880)) nil (26812 50233 431207 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9901 . 9902) (nil fontified nil 9900 . 9902) (nil fontified nil 9888 . 9900) (nil fontified nil 9881 . 9888) (nil fontified nil 9880 . 9881) (9880 . 9902)) nil (26812 50233 431206 0) 0 nil])
([nil nil ((9900 . 9901)) nil (26812 50233 431205 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9907 . 9908) (nil fontified nil 9901 . 9908) (9901 . 9908)) nil (26812 50233 431205 0) 0 nil])
([nil nil ((#("(or " 0 4 (fontified t)) . -15966) (undo-tree-id42 . -4) 15970) nil (26812 50233 431204 0) 0 nil])
([nil nil ((#("
                 ;; dernier recours: NIL provoquera une erreur contrôlée
                 nil" 0 18 (fontified t) 18 21 (face font-lock-comment-delimiter-face fontified t) 21 74 (face font-lock-comment-face fontified t) 74 94 (fontified t)) . -16216) (undo-tree-id22 . -94) (undo-tree-id23 . -29) (undo-tree-id24 . -73) (undo-tree-id25 . -73) (undo-tree-id26 . -18) (undo-tree-id27 . -18) (undo-tree-id28 . -18) (undo-tree-id29 . -18) (undo-tree-id30 . -18) (undo-tree-id31 . -18) (undo-tree-id32 . -18) (undo-tree-id33 . -18) (undo-tree-id34 . -18) (undo-tree-id35 . -94) (undo-tree-id36 . -94) (undo-tree-id37 . -94) (undo-tree-id38 . -94) (undo-tree-id39 . -74) (undo-tree-id40 . -94) (undo-tree-id41 . -94) 16310) nil (26812 50233 431200 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -16217) (undo-tree-id4 . -1) (undo-tree-id5 . -1) (undo-tree-id6 . -1) (undo-tree-id7 . -1) (undo-tree-id8 . -1) (undo-tree-id9 . -1) (undo-tree-id10 . -1) (undo-tree-id11 . -1) (undo-tree-id12 . -1) (undo-tree-id13 . -1) (undo-tree-id14 . -1) (undo-tree-id15 . -1) (undo-tree-id16 . -1) (undo-tree-id17 . -1) (undo-tree-id18 . -1) (undo-tree-id19 . -1) (undo-tree-id20 . -1) (undo-tree-id21 . -1) 16218) nil (26812 50233 431179 0) 0 nil])
([nil nil ((#("(defun tenant-id-by-code (code)
  ;; SELECT id FROM tenants WHERE code = $1 LIMIT 1
  (lumen.data.db:ensure-connection
      (let ((row (lumen.data.repo.query:select*
		  :tenants :filters (list '= :code code) :limit 1)))
	(when (and row (first row))
	  (cdr (assoc :id (first row)))))))

(defun tenant-id-for-host (host)
  ;; à toi de voir : table tenant_domains, ou mapping mémoire dev
  ;; ex: SELECT t.id FROM tenant_domains d JOIN tenants t ON t.id=d.tenant_id WHERE d.host=$1 LIMIT 1
  (print host)
  (lumen.data.db:ensure-connection
      (let ((row (lumen.data.repo.query:select*
		  :tenant_domains :filters (list '= :host host)
				  :select '(:tenant_id) :limit 1)))
	(when (and row (first row))
	  (cdr (assoc :tenant_id (first row)))))))

(defun tenant-code-by-id (tid)
  \"Retourne le code (string) du tenant ayant l’ID TID.
   Renvoie NIL si aucun tenant n’existe.\"
  (when tid
    (lumen.data.db:ensure-connection
	(let ((row (lumen.data.db:query-1a \"SELECT code FROM tenants WHERE id=$1\" tid)))
	  (and row (cdr (assoc :code row)))))))" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 24 (face font-lock-function-name-face fontified t) 24 34 (fontified t) 34 37 (face font-lock-comment-delimiter-face fontified t) 37 84 (face font-lock-comment-face fontified t) 84 126 (fontified t) 126 129 (face font-lock-keyword-face fontified t) 129 171 (fontified t) 171 179 (face font-lock-builtin-face fontified t) 179 180 (fontified t) 180 188 (face font-lock-builtin-face fontified t) 188 198 (fontified t) 198 203 (face font-lock-builtin-face fontified t) 203 210 (fontified t) 210 216 (face font-lock-builtin-face fontified t) 216 224 (fontified t) 224 228 (face font-lock-keyword-face fontified t) 228 266 (fontified t) 266 269 (face font-lock-builtin-face fontified t) 269 289 (fontified t) 289 290 (fontified t) 290 295 (face font-lock-keyword-face fontified t) 295 296 (fontified t) 296 314 (face font-lock-function-name-face fontified t) 314 324 (fontified t) 324 327 (face font-lock-comment-delimiter-face fontified t) 327 388 (face font-lock-comment-face fontified t) 388 390 (fontified t) 390 393 (face font-lock-comment-delimiter-face fontified t) 393 490 (face font-lock-comment-face fontified t) 490 547 (fontified t) 547 550 (face font-lock-keyword-face fontified t) 550 592 (fontified t) 592 607 (face font-lock-builtin-face fontified t) 607 608 (fontified t) 608 616 (face font-lock-builtin-face fontified t) 616 626 (fontified t) 626 631 (face font-lock-builtin-face fontified t) 631 635 (fontified t) 635 638 (fontified t) 638 644 (fontified t) 644 651 (face font-lock-builtin-face fontified t) 651 654 (fontified t) 654 664 (face font-lock-builtin-face fontified t) 664 666 (fontified t) 666 672 (face font-lock-builtin-face fontified t) 672 680 (fontified t) 680 684 (face font-lock-keyword-face fontified t) 684 722 (fontified t) 722 732 (face font-lock-builtin-face fontified t) 732 753 (fontified t) 753 758 (face font-lock-keyword-face fontified t) 758 759 (fontified t) 759 776 (face font-lock-function-name-face fontified t) 776 785 (fontified t) 785 879 (face font-lock-doc-face fontified t) 879 883 (fontified t) 883 887 (face font-lock-keyword-face fontified t) 887 931 (fontified t) 931 934 (face font-lock-keyword-face fontified t) 934 965 (fontified t) 965 1003 (face font-lock-string-face fontified t) 1003 1035 (fontified t) 1035 1040 (face font-lock-builtin-face fontified t) 1040 1051 (fontified t)) . 13093) (undo-tree-id0 . -1051) (undo-tree-id1 . -17) (undo-tree-id2 . -17) (undo-tree-id3 . -17) (undo-tree-id4 . -17) (undo-tree-id5 . -17) (undo-tree-id6 . -17) (undo-tree-id7 . -17) (undo-tree-id8 . -17) (undo-tree-id9 . -17) (undo-tree-id10 . -17) (undo-tree-id11 . -17) (undo-tree-id12 . -17) (undo-tree-id13 . -750) (undo-tree-id14 . -750) (undo-tree-id15 . -750) (undo-tree-id16 . -750) (undo-tree-id17 . -750) (undo-tree-id18 . -750) (undo-tree-id19 . -750) (undo-tree-id20 . -750) (undo-tree-id21 . -750) (undo-tree-id22 . -750) (undo-tree-id23 . -750) (undo-tree-id24 . -288) (undo-tree-id25 . -288) (undo-tree-id26 . -288) (undo-tree-id27 . -288) (undo-tree-id28 . -288) (undo-tree-id29 . -288) (undo-tree-id30 . -1051) (undo-tree-id31 . -1051) (undo-tree-id32 . -1051) (undo-tree-id33 . -1051) (undo-tree-id34 . -750) (undo-tree-id35 . -1051) (t 26812 50233 0 0)) nil (26819 3494 267775 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 13093) (#("
" 0 1 (fontified t)) . 13093)) nil (26819 3494 267730 0) 0 nil])
([nil nil ((7111 . 7112) (t 26819 3494 0 0)) nil (26819 12995 798942 0) 0 nil])
([nil nil ((#("(" 0 1 (fontified t)) . -7111) (undo-tree-id48 . -1) 7112) nil (26819 12995 798941 0) 0 nil])
([nil nil ((6886 . 6889)) nil (26819 12995 798940 0) 0 nil])
([nil nil ((6889 . 6896)) nil (26819 12995 798940 0) 0 nil])
([nil nil ((6896 . 6897)) nil (26819 12995 798939 0) 0 nil])
([nil nil ((6897 . 6898)) nil (26819 12995 798939 0) 0 nil])
([nil nil ((6898 . 6899)) nil (26819 12995 798939 0) 0 nil])
([nil nil ((6899 . 6909)) nil (26819 12995 798938 0) 0 nil])
([nil nil ((#("R" 0 1 (face font-lock-string-face fontified t)) . -6907) (undo-tree-id46 . -1) (#("S" 0 1 (face font-lock-string-face fontified t)) . -6908) (undo-tree-id47 . -1) 6909) nil (26819 12995 798938 0) 0 nil])
([nil nil ((#("E" 0 1 (face font-lock-string-face fontified t)) . -6905) (undo-tree-id44 . -1) (#("T" 0 1 (face font-lock-string-face fontified t)) . -6906) (undo-tree-id45 . -1) 6907) nil (26819 12995 798936 0) 0 nil])
([nil nil ((6905 . 6910)) nil (26819 12995 798934 0) 0 nil])
([nil nil ((6910 . 6911)) nil (26819 12995 798934 0) 0 nil])
([nil nil ((6911 . 6914)) nil (26819 12995 798933 0) 0 nil])
([nil nil ((#("#" 0 1 (face font-lock-string-face fontified t)) . -6913) (undo-tree-id43 . -1) 6914) nil (26819 12995 798933 0) 0 nil])
([nil nil ((6913 . 6915)) nil (26819 12995 798932 0) 0 nil])
([nil nil ((6915 . 6916)) nil (26819 12995 798931 0) 0 nil])
([nil nil ((6916 . 6917)) nil (26819 12995 798931 0) 0 nil])
([nil nil ((6917 . 6924)) nil (26819 12995 798930 0) 0 nil])
([nil nil ((#("\"" 0 1 (face font-lock-string-face fontified t)) . -6923) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) (undo-tree-id42 . -1) 6924) nil (26819 12995 798929 0) 0 nil])
([nil nil ((6916 . 6917)) nil (26819 12995 798926 0) 0 nil])
([nil nil ((#(" " 0 1 (face font-lock-string-face fontified t)) . -6915) (undo-tree-id36 . -1) (#("b" 0 1 (face font-lock-string-face fontified t)) . -6916) (undo-tree-id37 . -1) 6917) nil (26819 12995 798925 0) 0 nil])
([nil nil ((6915 . 6916)) nil (26819 12995 798915 0) 0 nil])
([nil nil ((6916 . 6917)) nil (26819 12995 798915 0) 0 nil])
([nil nil ((6924 . 6925)) nil (26819 12995 798914 0) 0 nil])
([nil nil ((7343 . 7348)) nil (26819 12995 798914 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7383 . 7384) (nil fontified nil 7376 . 7384) (nil fontified nil 7375 . 7376) (nil fontified nil 7358 . 7375) (nil fontified nil 7348 . 7358) (7348 . 7384)) nil (26819 12995 798913 0) 0 nil])
([nil nil ((7368 . 7369)) nil (26819 12995 798911 0) 0 nil])
([nil nil ((7384 . 7385)) nil (26819 12995 798907 0) 0 nil])
([nil nil ((7326 . 7331) (t 26819 12995 0 0)) nil (26819 14647 452910 0) 0 nil])
([nil nil ((7331 . 7332)) nil (26819 14647 452910 0) 0 nil])
([nil nil ((7320 . 7330) (#(" " 0 1 (fontified nil)) . 7319) (undo-tree-id51 . -1) (7320 . 7321)) nil (26819 14647 452909 0) 0 nil])
([nil nil ((7359 . 7360)) nil (26819 14647 452907 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 13307 . 13308) (nil fontified nil 11995 . 13308) (11995 . 13308)) nil (26819 14647 452906 0) 0 nil])
([nil nil ((#("
(defmethod repo-index :around (entity ctx &rest args)
  (destructuring-bind (&key filters &allow-other-keys) args
    (let* ((tid (getf ctx :tenant-id))
           (filters* (if tid (list 'and filters (list '= :tenant_id tid)) filters))
           (args* (alexandria:plist-alist
                   (lumen.utils:copy-plist args))))
      ;; replace :filters
      (setf (cdr (assoc :filters args*)) filters*)
      (let ((op :index))
        (repo-authorize op entity ctx)
        (apply #'call-next-method entity ctx (alexandria:alist-plist args*))))))" 0 1 (fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 22 (face font-lock-function-name-face fontified t) 22 23 (fontified t) 23 30 (face font-lock-builtin-face fontified t) 30 43 (fontified t) 43 48 (face font-lock-type-face fontified t) 48 58 (fontified t) 58 76 (face font-lock-keyword-face fontified t) 76 78 (fontified t) 78 82 (face font-lock-type-face fontified t) 82 91 (fontified t) 91 108 (face font-lock-type-face fontified t) 108 120 (fontified t) 120 124 (face font-lock-keyword-face fontified t) 124 141 (fontified t) 141 151 (face font-lock-builtin-face fontified t) 151 176 (fontified t) 176 178 (face font-lock-keyword-face fontified t) 178 211 (fontified t) 211 221 (face font-lock-builtin-face fontified t) 221 319 (fontified t) 319 332 (fontified t) 332 338 (fontified t) 338 341 (face font-lock-comment-delimiter-face fontified t) 341 358 (face font-lock-comment-face fontified t) 358 382 (fontified t) 382 390 (face font-lock-builtin-face fontified t) 390 416 (fontified t) 416 419 (face font-lock-keyword-face fontified t) 419 425 (fontified t) 425 431 (face font-lock-builtin-face fontified t) 431 553 (fontified t)) . -13308) (undo-tree-id50 . -553) 13861) nil (26819 14647 452971 0) 0 nil])
([nil nil ((#("

;;; Méthode corrigée ------------------------------------------------------" 0 2 (fontified t) 2 6 (face font-lock-comment-delimiter-face fontified t) 6 77 (face font-lock-comment-face fontified t)) . 12506) (undo-tree-id92 . -77)) nil (26819 15069 792224 0) 0 nil] [nil nil ((#("

;;; Méthode corrigée ------------------------------------------------------" 0 2 (fontified t) 2 6 (face font-lock-comment-delimiter-face fontified t) 6 77 (face font-lock-comment-face fontified t)) . -12506) (undo-tree-id49 . -77) 12583) ((12506 . 12583)) (26819 14647 452900 0) 0 nil])
([nil nil ((6771 . 6772)) nil (26819 15069 792223 0) 0 nil])
nil
([nil nil ((nil rear-nonsticky nil 8555 . 8556) (nil fontified nil 6772 . 8556) (6772 . 8556)) nil (26819 15069 792222 0) 0 nil])
([nil nil ((7433 . 7436)) nil (26819 15069 792222 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7471 . 7472) (nil fontified nil 7464 . 7472) (nil fontified nil 7463 . 7464) (nil fontified nil 7446 . 7463) (nil fontified nil 7436 . 7446) (7436 . 7472)) nil (26819 15069 792221 0) 0 nil])
([nil nil ((7987 . 7992)) nil (26819 15069 792220 0) 0 nil])
([nil nil ((nil fontified nil 8029 . 8030) (nil fontified nil 8021 . 8029) (nil fontified nil 8020 . 8021) (nil fontified nil 8002 . 8020) (nil fontified nil 7992 . 8002) (7992 . 8030)) nil (26819 15069 792219 0) 0 nil])
([nil nil ((#("
(defmethod repo-index ((entity symbol) ctx &key filters order select page page-size limit offset after before key)
  (format t \"~&FILTERS: ~A~%\" filters)
  (let* ((md (entity-metadata entity))
         (table (getf md :table))
         (allowed (mapcar (lambda (f) (getf f :col)) (entity-fields entity)))
         (filters* (append filters
                           (let ((tid (getf ctx :tenant-id))
                                 (tcol (or (getf md :tenant-id-col) :tenant_id)))
                             (when (and tid (find tcol allowed))
			       (list (list '= tcol tid)))))))
    (format t \"~&FILTERS*: ~A~%\" filters*)
    (lumen.data.db:ensure-connection
    (cond
      ((or after before)
       ;; key = liste de colonnes correspondant à ORDER
       (select-page-keyset* table
         :filters filters* :order order :key key
         :after after :limit (or limit 20) :order-whitelist allowed))
      (t
       (select* table
         :filters filters* :order order :select (or select :*)
         :limit (or (and page-size (* 1 page-size)) limit 20)
         :offset (or offset (and page page-size (* (max 0 (1- page)) page-size)))
         :order-whitelist allowed))))))
" 0 1 (fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 22 (face font-lock-function-name-face fontified t) 22 44 (fontified t) 44 48 (face font-lock-type-face fontified t) 48 116 (fontified t) 116 128 (fontified t) 128 145 (face font-lock-string-face fontified t) 145 146 (fontified t) 146 154 (fontified t) 154 155 (fontified t) 155 158 (fontified t) 158 162 (face font-lock-keyword-face fontified t) 162 219 (fontified t) 219 225 (face font-lock-builtin-face fontified t) 225 255 (fontified t) 255 261 (face font-lock-keyword-face fontified t) 261 274 (fontified t) 274 278 (face font-lock-builtin-face fontified t) 278 341 (fontified t) 341 369 (fontified t) 369 372 (face font-lock-keyword-face fontified t) 372 378 (fontified t) 378 389 (fontified t) 389 399 (face font-lock-builtin-face fontified t) 399 402 (fontified t) 402 454 (fontified t) 454 468 (face font-lock-builtin-face fontified t) 468 470 (fontified t) 470 480 (face font-lock-builtin-face fontified t) 480 484 (fontified t) 484 514 (fontified t) 514 518 (face font-lock-keyword-face fontified t) 518 549 (fontified t) 549 590 (fontified t) 590 594 (fontified t) 594 604 (fontified t) 604 622 (face font-lock-string-face fontified t) 622 623 (fontified t) 623 631 (fontified t) 631 632 (fontified t rear-nonsticky t) 632 633 (fontified t) 633 675 (fontified t) 675 679 (face font-lock-keyword-face fontified t) 679 712 (fontified t) 712 715 (face font-lock-comment-delimiter-face fontified t) 715 761 (face font-lock-comment-face fontified t) 761 804 (fontified t) 804 812 (face font-lock-builtin-face fontified t) 812 822 (fontified t) 822 828 (face font-lock-builtin-face fontified t) 828 835 (fontified t) 835 839 (face font-lock-builtin-face fontified t) 839 853 (fontified t) 853 859 (face font-lock-builtin-face fontified t) 859 866 (fontified t) 866 872 (face font-lock-builtin-face fontified t) 872 887 (fontified t) 887 893 (face font-lock-builtin-face fontified t) 893 903 (face font-lock-builtin-face fontified t) 903 914 (fontified t) 914 954 (fontified t) 954 962 (face font-lock-builtin-face fontified t) 962 964 (fontified t) 964 972 (fontified t) 972 978 (face font-lock-builtin-face fontified t) 978 985 (fontified t) 985 992 (face font-lock-builtin-face fontified t) 992 1004 (fontified t) 1004 1006 (face font-lock-builtin-face fontified t) 1006 1008 (fontified t) 1008 1017 (fontified t) 1017 1023 (face font-lock-builtin-face fontified t) 1023 1079 (fontified t) 1079 1086 (face font-lock-builtin-face fontified t) 1086 1161 (fontified t) 1161 1177 (face font-lock-builtin-face fontified t) 1177 1192 (fontified t)) . -8638) (undo-tree-id52 . -594) (undo-tree-id53 . -12) (undo-tree-id54 . -22) (undo-tree-id55 . -1192) (undo-tree-id56 . -1) (undo-tree-id57 . -118) (undo-tree-id58 . -594) (undo-tree-id59 . -594) (undo-tree-id60 . -594) (undo-tree-id61 . -594) (undo-tree-id62 . -632) (undo-tree-id63 . -632) (undo-tree-id64 . -632) (undo-tree-id65 . -632) (undo-tree-id66 . -632) (undo-tree-id67 . -632) (undo-tree-id68 . -632) (undo-tree-id69 . -632) (undo-tree-id70 . -632) (undo-tree-id71 . -632) (undo-tree-id72 . -594) (undo-tree-id73 . -46) (undo-tree-id74 . -46) (undo-tree-id75 . -46) (undo-tree-id76 . -46) (undo-tree-id77 . -46) (undo-tree-id78 . -46) (undo-tree-id79 . -46) (undo-tree-id80 . -46) (undo-tree-id81 . -46) (undo-tree-id82 . -1) (undo-tree-id83 . -1) (undo-tree-id84 . -1) (undo-tree-id85 . -914) (undo-tree-id86 . -590) (undo-tree-id87 . -795) (undo-tree-id88 . -795) (undo-tree-id89 . -844) (undo-tree-id90 . -844) (undo-tree-id91 . -1192) 9830) nil (26819 15069 792217 0) 0 nil])
([nil nil ((7416 . 7420) (#(" " 0 1 (fontified nil)) . 7416) (7415 . 7416)) nil (26819 15069 792181 0) 0 nil])
([nil nil ((8536 . 8542) (#("           " 0 11 (fontified t)) . 8536) (8456 . 8462) (#("           " 0 11 (fontified t)) . 8456) (8395 . 8401) (#("           " 0 11 (fontified t)) . 8395) (8365 . 8371) (#("           " 0 11 (fontified t)) . 8365) (8344 . 8350) (#("           " 0 11 (fontified t)) . 8344) (8320 . 8326) (#("           " 0 11 (fontified t)) . 8320) (8303 . 8305) (8289 . 8291) (8250 . 8254) (#("           " 0 11 (fontified t)) . 8250) (8223 . 8227) (#("           " 0 11 (fontified t)) . 8223) (8204 . 8208) (#("           " 0 11 (fontified t)) . 8204) (8187 . 8191) (#("           " 0 11 (fontified t)) . 8187) (8168 . 8172) (#("           " 0 11 (fontified t)) . 8168) (8146 . 8150) (#("           " 0 11 (fontified t)) . 8146) (8117 . 8119) (8087 . 8089) (8072 . 8073) (#("      " 0 6 (fontified t)) . 8072) 7296) nil (26819 15069 792175 0) 0 nil])
([nil nil ((#("
(defun %ensure-filter-list (f)
  \"Normalise :filters en liste de clauses (AND implicite).\"
  (cond
    ((null f) '())
    ((and (listp f) (member (first f) '(and :AND))) (rest f))
    ((and (listp f) (every #'listp f)) f)
    (t (list f))))" 0 1 (face font-lock-comment-face fontified t) 1 2 (fontified t) 2 7 (face font-lock-keyword-face fontified t) 7 8 (fontified t) 8 27 (face font-lock-function-name-face fontified t) 27 34 (fontified t) 34 91 (face font-lock-doc-face fontified t) 91 95 (fontified t) 95 99 (face font-lock-keyword-face fontified t) 99 163 (fontified t) 163 167 (face font-lock-builtin-face fontified t) 167 241 (fontified t)) . 6771) (undo-tree-id93 . -241) (undo-tree-id94 . -241) (undo-tree-id95 . -1) (undo-tree-id96 . -241) (undo-tree-id97 . -241) (undo-tree-id98 . -241) (undo-tree-id99 . -15) (undo-tree-id100 . -15) (undo-tree-id101 . -15) (undo-tree-id102 . -15) (undo-tree-id103 . -15) (undo-tree-id104 . -8) (undo-tree-id105 . -27) (undo-tree-id106 . -27) (undo-tree-id107 . -8) (undo-tree-id108 . -27) (undo-tree-id109 . -27) (undo-tree-id110 . -27) (undo-tree-id111 . -27) (undo-tree-id112 . -27) (undo-tree-id113 . -27) (undo-tree-id114 . -27) (undo-tree-id115 . -27) (undo-tree-id116 . -27) (undo-tree-id117 . -27) (undo-tree-id118 . -27) (undo-tree-id119 . -27) (undo-tree-id120 . -27) (undo-tree-id121 . -27) (undo-tree-id122 . -27) (undo-tree-id123 . -27) (undo-tree-id124 . -27) (undo-tree-id125 . -27) (undo-tree-id126 . -27) (undo-tree-id127 . -27) (undo-tree-id128 . -27) (undo-tree-id129 . -27) (undo-tree-id130 . -27) (undo-tree-id131 . -27) (undo-tree-id132 . -27) (undo-tree-id133 . -241) (undo-tree-id134 . -241) (undo-tree-id135 . -241) (undo-tree-id136 . -8) (undo-tree-id137 . -241) (t 26819 15069 0 0)) nil (26819 15116 597576 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face fontified t)) . 6771)) nil (26819 15116 597538 0) 0 nil])
([nil nil ((7052 . 7054) (t 26819 15116 0 0)) nil (26819 16659 226409 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 8441 . 8442) (nil fontified nil 7054 . 8442) (7054 . 8442)) nil (26819 16659 226408 0) 0 nil])
([nil nil ((#("
" 0 1 (rear-nonsticky t fontified t)) . -8441) (undo-tree-id144 . -1) (undo-tree-id145 . -1) (undo-tree-id146 . -1) 8442) nil (26819 16659 226407 0) 0 nil])
([nil nil ((#("(allowed (mapcar (lambda (f) (getf f :col)) (entity-fields entity)))" 0 18 (fontified t) 18 24 (face font-lock-keyword-face fontified t) 24 37 (fontified t) 37 41 (face font-lock-builtin-face fontified t) 41 68 (fontified t)) . -8713) (undo-tree-id138 . -68) (undo-tree-id139 . -68) (undo-tree-id140 . -68) (undo-tree-id141 . -68) (undo-tree-id142 . -68) (undo-tree-id143 . -68) 8781) nil (26819 16659 226404 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 8784 . 8785) (nil fontified nil 8713 . 8785) (8713 . 8785)) nil (26819 16659 226386 0) 0 nil])
([nil nil ((6514 . 6515) (t 26819 16659 0 0)) nil (26821 14732 141104 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 7540 . 7541) (nil fontified nil 6515 . 7541) (6515 . 7541)) nil (26821 14732 141104 0) 0 nil])
([nil nil ((#("(defmethod repo-after (op (entity symbol) ctx result &key id payload)
  (declare (ignore id payload))
  ;; Audit optionnel (si l’app/ENV a installé une table audit_log et veut logguer)
  (print (list (getf ctx :actor-id)
       (getf ctx :tenant-id)
       (string-downcase (symbol-name op))
       (string-downcase (symbol-name entity))
       (cl-json:encode-json-to-string result)))
  (when (getf ctx :audit?)
    (ignore-errors
     (lumen.data.db:ensure-connection
      (lumen.data.db:exec
       \"insert into audit_log(actor_id, tenant_id, action, resource, payload)
        values($1,$2,$3,$4,$5)\"
       (getf ctx :actor-id)
       (getf ctx :tenant-id)
       (string-downcase (symbol-name op))
       (string-downcase (symbol-name entity))
       (cl-json:encode-json-to-string result)))))
  result)" 0 1 (fontified t) 1 10 (face font-lock-keyword-face fontified t) 10 11 (fontified t) 11 21 (face font-lock-function-name-face fontified t) 21 53 (fontified t) 53 57 (face font-lock-type-face fontified t) 57 73 (fontified t) 73 80 (face font-lock-keyword-face fontified t) 80 104 (fontified t) 104 107 (face font-lock-comment-delimiter-face fontified t) 107 185 (face font-lock-comment-face fontified t) 185 210 (fontified t) 210 219 (face font-lock-builtin-face fontified t) 219 238 (fontified t) 238 248 (face font-lock-builtin-face fontified t) 248 389 (fontified t) 389 393 (face font-lock-keyword-face fontified t) 393 404 (fontified t) 404 411 (face font-lock-builtin-face fontified t) 411 414 (fontified t) 414 418 (fontified t) 418 431 (face font-lock-keyword-face fontified t) 431 432 (fontified t) 432 503 (fontified t) 503 605 (face font-lock-string-face fontified t) 605 623 (fontified t) 623 632 (face font-lock-builtin-face fontified t) 632 651 (fontified t) 651 661 (face font-lock-builtin-face fontified t) 661 801 (fontified t) 801 810 (fontified t)) . 5704) (undo-tree-id149 . -810) (undo-tree-id150 . -386) (undo-tree-id151 . -810) (undo-tree-id152 . -810) (undo-tree-id153 . -810) (undo-tree-id154 . -810) (undo-tree-id155 . -810) (undo-tree-id156 . -810)) nil (26821 14732 141102 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 5704) (undo-tree-id147 . -1) (undo-tree-id148 . -1)) nil (26821 14732 141089 0) 0 nil])
([nil nil ((#(":ctx-from-req" 0 13 (face font-lock-builtin-face fontified t)) . 1061) (undo-tree-id158 . -13) 1074 (t 26821 14732 0 0)) nil (26821 16741 939468 0) 0 nil])
([nil nil ((#("

;;; ---------------------------------------------------------------------------
;;; Contexte standard (req -> ctx)
;;; ---------------------------------------------------------------------------
(defun ctx-from-req (req)
  \"Projette le contexte HTTP vers un ctx alist standard utilisé par repo-*.\"
  (let* ((jwt (lumen.core.http:current-jwt req)))
    (list :req       req
          :tenant-id (lumen.core.http:ctx-get req :tenant-id)
          :actor-id  (lumen.core.http:current-user-id req)
          :scopes    (or (lumen.utils:alist-get jwt :scopes) '())
          :audit?    t)))" 0 2 (fontified t) 2 6 (face font-lock-comment-delimiter-face fontified t) 6 82 (face font-lock-comment-face fontified t) 82 86 (face font-lock-comment-delimiter-face fontified t) 86 117 (face font-lock-comment-face fontified t) 117 121 (face font-lock-comment-delimiter-face fontified t) 121 197 (face font-lock-comment-face fontified t) 197 198 (fontified t) 198 203 (face font-lock-keyword-face fontified t) 203 204 (fontified t) 204 216 (face font-lock-function-name-face fontified t) 216 225 (fontified t) 225 299 (face font-lock-doc-face fontified t) 299 303 (fontified t) 303 307 (face font-lock-keyword-face fontified t) 307 360 (fontified t) 360 364 (face font-lock-builtin-face fontified t) 364 385 (fontified t) 385 389 (face font-lock-builtin-face fontified t) 389 395 (face font-lock-builtin-face fontified t) 395 425 (fontified t) 425 435 (face font-lock-builtin-face fontified t) 435 437 (fontified t) 437 447 (fontified t) 447 456 (face font-lock-builtin-face fontified t) 456 506 (fontified t) 506 513 (face font-lock-builtin-face fontified t) 513 548 (fontified t) 548 555 (face font-lock-builtin-face fontified t) 555 572 (fontified t) 572 579 (face font-lock-builtin-face fontified t) 579 587 (fontified t)) . 1099) (undo-tree-id157 . -587)) nil (26821 16741 939463 0) 0 nil])
([nil nil ((177 . 181)) nil (26821 16741 939450 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 193 . 194) (nil fontified nil 181 . 194) (181 . 194)) nil (26821 16741 939444 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -15031) (undo-tree-id14 . -1) 15032 (t 26821 16741 0 0)) nil (26821 17811 621791 0) 0 nil])
([nil nil ((15031 . 15032)) nil (26821 17811 621789 0) 0 nil])
([nil nil ((#("=" 0 1 (fontified t)) . -15030) (undo-tree-id13 . -1) 15031) nil (26821 17811 621789 0) 0 nil])
([nil nil ((15030 . 15031)) nil (26821 17811 621787 0) 0 nil])
([nil nil ((15267 . 15269)) nil (26821 17811 621786 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15960 . 15961) (nil fontified nil 15269 . 15961) (15269 . 15961)) nil (26821 17811 621785 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face rear-nonsticky t fontified t)) . -15960) (undo-tree-id12 . -1) 15961) nil (26821 17811 621784 0) 0 nil])
([nil nil ((#("prudence" 0 8 (face font-lock-comment-face fontified t)) . 15786) (undo-tree-id11 . -8) 15794) nil (26821 17811 621783 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15702 . 15703) (nil fontified nil 15695 . 15703) (15695 . 15703)) nil (26821 17811 621781 0) 0 nil])
([nil nil ((#("renvoie" 0 7 (face font-lock-comment-face fontified t)) . 15703)) nil (26821 17811 621779 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15793 . 15794) (nil fontified nil 15787 . 15794) (15787 . 15794)) nil (26821 17811 621778 0) 0 nil])
([nil nil ((#("row" 0 3 (fontified t)) . 15634) (undo-tree-id10 . -3) 15637) nil (26821 17811 621777 0) 0 nil])
([nil nil ((15634 . 15637)) nil (26821 17811 621775 0) 0 nil])
([nil nil ((#("nil" 0 3 (fontified t)) . -15724) (undo-tree-id9 . -3) 15727) nil (26821 17811 621773 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15726 . 15727) (nil fontified nil 15724 . 15727) (15724 . 15727)) nil (26821 17811 621770 0) 0 nil])
([nil nil ((#("
(defmethod repo-show :around (entity ctx id)
  (let ((op :show))
    (repo-authorize op entity ctx :id id)
    (let* ((row (call-next-method))      ;; la méthode primaire fait le SELECT
           (tid (getf ctx :tenant-id)))
      (if (and row tid
               (string/= (string-downcase (or (cdr (assoc :tenant_id row)) \"\"))
                         (string-downcase tid)))
          ;; masquer les fuites cross-tenant
          (respond-404)                  ;; ou NIL selon ton contrat
          row))))
" 0 1 (fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 21 (face font-lock-function-name-face fontified t) 21 22 (fontified t) 22 29 (face font-lock-builtin-face fontified t) 29 49 (fontified t) 49 52 (face font-lock-keyword-face fontified t) 52 58 (fontified t) 58 63 (face font-lock-builtin-face fontified t) 63 100 (fontified t) 100 103 (face font-lock-builtin-face fontified t) 103 113 (fontified t) 113 117 (face font-lock-keyword-face fontified t) 117 149 (fontified t) 149 152 (face font-lock-comment-delimiter-face fontified t) 152 187 (face font-lock-comment-face fontified t) 187 213 (fontified t) 213 223 (face font-lock-builtin-face fontified t) 223 234 (fontified t) 234 236 (face font-lock-keyword-face fontified t) 236 250 (fontified t) 250 308 (fontified t) 308 318 (face font-lock-builtin-face fontified t) 318 325 (fontified t) 325 327 (face font-lock-string-face fontified t) 327 330 (fontified t) 330 389 (fontified t) 389 392 (face font-lock-comment-delimiter-face fontified t) 392 424 (face font-lock-comment-face fontified t) 424 465 (fontified t) 465 468 (face font-lock-comment-delimiter-face fontified t) 468 493 (face font-lock-comment-face fontified t) 493 511 (fontified t)) . 14757) (undo-tree-id0 . -511) (undo-tree-id1 . -378) (undo-tree-id2 . -249) (undo-tree-id3 . -328) (undo-tree-id4 . -378) (undo-tree-id5 . -446) (undo-tree-id6 . -273) (undo-tree-id7 . -1) (undo-tree-id8 . -511)) nil (26821 17811 621765 0) 0 nil])
([nil nil ((10339 . 10341) (t 26821 17811 0 0)) nil (26822 36089 914634 0) 0 nil])
([nil nil ((8220 . 8222)) nil (26822 36089 914633 0) 0 nil])
([nil nil ((8782 . 8784)) nil (26822 36089 914629 0) 0 nil])
([nil nil ((7395 . 7397) (t 26822 36089 0 0)) nil (26832 36358 865992 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 8065 . 8066) (nil fontified nil 7397 . 8066) (7397 . 8066)) nil (26832 36358 865991 0) 0 nil])
([nil nil ((8067 . 8069) (#("  " 0 2 (fontified nil)) . 8066) (8066 . 8068) (8066 . 8067)) nil (26832 36358 865990 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 9152 . 9153) (nil fontified nil 8069 . 9153) (8069 . 9153)) nil (26832 36358 865989 0) 0 nil])
([nil nil ((#("

(defun entity-allowed-cols (entity &key include-pk? include-tenant? include-lock?)
  \"Union des colonnes :fields + timestamps + (optionnel) pk/tenant/lock_version.\"
  (let* ((md        (entity-metadata entity))
         (pk        (and include-pk?     (%kw-col (or (getf md :primary-key) :id))))
         (tenantcol (and include-tenant? (%kw-col (or (getf md :tenant-id-col) :tenant_id))))
         (lockcol   (and include-lock?   (%kw-col (getf md :lock-version)))))
    (remove-duplicates
     (remove nil
             (append (entity-field-cols entity)
                     (entity-timestamp-cols entity)
                     (list pk tenantcol lockcol)))
     :test #'eq)))
" 0 1 (fontified t) 1 2 (fontified t) 2 3 (fontified t) 3 8 (face font-lock-keyword-face fontified t) 8 9 (fontified t) 9 28 (face font-lock-function-name-face fontified t) 28 37 (fontified t) 37 41 (face font-lock-type-face fontified t) 41 87 (fontified t) 87 166 (face font-lock-doc-face fontified t) 166 170 (fontified t) 170 174 (face font-lock-keyword-face fontified t) 174 276 (fontified t) 276 288 (face font-lock-builtin-face fontified t) 288 290 (fontified t) 290 293 (face font-lock-builtin-face fontified t) 293 361 (fontified t) 361 375 (face font-lock-builtin-face fontified t) 375 377 (fontified t) 377 387 (face font-lock-builtin-face fontified t) 387 451 (fontified t) 451 464 (face font-lock-builtin-face fontified t) 464 666 (fontified t) 666 671 (face font-lock-builtin-face fontified t) 671 680 (fontified t)) . -9153) (undo-tree-id33 . -680) 9833) nil (26832 36358 865988 0) 0 nil])
([nil nil ((8001 . 8002)) nil (26832 36358 865987 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -8068) (undo-tree-id31 . -1) (undo-tree-id32 . -1) 8069) nil (26832 36358 865986 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . 8068) (undo-tree-id30 . -1)) nil (26832 36358 865984 0) 0 nil])
([nil nil ((#("
" 0 1 (face font-lock-comment-face fontified t)) . -12895) (undo-tree-id28 . -1) (undo-tree-id29 . -1) 12896) nil (26832 36358 865983 0) 0 nil])
([nil nil ((8066 . 8068)) nil (26832 36358 865981 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 11075 . 11076) (nil fontified nil 8068 . 11076) (8068 . 11076)) nil (26832 36358 865980 0) 0 nil])
([nil nil ((11076 . 11077)) nil (26832 36358 865979 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -11076) (undo-tree-id27 . -1) 11077) nil (26832 36358 865978 0) 0 nil])
([nil nil ((#("(defmethod repo-index ((entity symbol) ctx
                       &key filters order select page page-size limit offset
			 after before key)
  ;;(format t \"~&FILTERS: ~A~%\" filters)
  (let* ((md      (entity-metadata entity))
         (table   (getf md :table))
         (allowed (entity-allowed-cols entity :include-pk? t :include-tenant? t))
         (tid     (getf ctx :tenant-id))
         (tcol    (or (getf md :tenant-id-col) :tenant_id))
         (filters* (let ((flt (%ensure-filter-list filters)))
                     (if (and tid (find tcol allowed) (not (%has-tenant-clause-p flt tcol tid)))
                         (append flt (list (list '= tcol tid)))
                         flt))))
    ;;(format t \"~&FILTERS*: ~A~%\" filters*)
    (lumen.data.db:ensure-connection
	(cond
          ((or after before)
           (select-page-keyset* table
				:filters filters*
				:order   order
				:key     key
				:after   after
				:limit   (or limit 20)
				:order-whitelist allowed))
          (t
           (select* table
		    :filters filters*
		    :order   order
		    :select  (or select :*)
		    :limit   (or (and page-size (* 1 page-size)) limit 20)
		    :offset  (or offset (and page page-size (* (max 0 (1- page)) page-size)))
		    :order-whitelist allowed))))))" 0 1 (fontified t) 1 10 (face font-lock-keyword-face fontified t) 10 11 (fontified t) 11 21 (face font-lock-function-name-face fontified t) 21 66 (fontified t) 66 70 (face font-lock-type-face fontified t) 70 144 (fontified t) 144 146 (face font-lock-comment-delimiter-face fontified t) 146 183 (face font-lock-comment-face fontified t) 183 186 (fontified t) 186 190 (face font-lock-keyword-face fontified t) 190 254 (fontified t) 254 260 (face font-lock-builtin-face fontified t) 260 309 (fontified t) 309 321 (face font-lock-builtin-face fontified t) 321 324 (fontified t) 324 340 (face font-lock-builtin-face fontified t) 340 373 (fontified t) 373 383 (face font-lock-builtin-face fontified t) 383 412 (fontified t) 412 414 (fontified t) 414 417 (fontified t) 417 431 (face font-lock-builtin-face fontified t) 431 433 (fontified t) 433 443 (face font-lock-builtin-face fontified t) 443 446 (fontified t) 446 466 (fontified t) 466 469 (face font-lock-keyword-face fontified t) 469 498 (fontified t) 498 508 (fontified t) 508 530 (fontified t) 530 532 (face font-lock-keyword-face fontified t) 532 706 (fontified t) 706 708 (face font-lock-comment-delimiter-face fontified t) 708 747 (face font-lock-comment-face fontified t) 747 786 (fontified t) 786 790 (face font-lock-keyword-face fontified t) 790 820 (fontified t) 820 847 (fontified t) 847 858 (fontified t) 858 862 (fontified t) 862 870 (face font-lock-builtin-face fontified t) 870 884 (fontified t) 884 890 (face font-lock-builtin-face fontified t) 890 903 (fontified t) 903 907 (face font-lock-builtin-face fontified t) 907 920 (fontified t) 920 926 (face font-lock-builtin-face fontified t) 926 939 (fontified t) 939 945 (face font-lock-builtin-face fontified t) 945 966 (fontified t) 966 982 (face font-lock-builtin-face fontified t) 982 1038 (fontified t) 1038 1046 (face font-lock-builtin-face fontified t) 1046 1062 (fontified t) 1062 1068 (face font-lock-builtin-face fontified t) 1068 1083 (fontified t) 1083 1090 (face font-lock-builtin-face fontified t) 1090 1103 (fontified t) 1103 1105 (face font-lock-builtin-face fontified t) 1105 1113 (fontified t) 1113 1119 (face font-lock-builtin-face fontified t) 1119 1174 (fontified t) 1174 1181 (face font-lock-builtin-face fontified t) 1181 1254 (fontified t) 1254 1270 (face font-lock-builtin-face fontified t) 1270 1284 (fontified t)) . -12163) (undo-tree-id26 . -1284) 13447) nil (26832 36358 865977 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 13410 . 13411) (nil fontified nil 12163 . 13411) (12163 . 13411)) nil (26832 36358 865976 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -13409) (undo-tree-id22 . -1) (undo-tree-id23 . -1) (#("
" 0 1 (rear-nonsticky t fontified t)) . -13410) (undo-tree-id24 . -1) (undo-tree-id25 . -1) 13411) nil (26832 36358 865975 0) 0 nil])
([nil nil ((13462 . 13463)) nil (26832 36358 865970 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 14005 . 14006) (nil fontified nil 13463 . 14006) (13463 . 14006)) nil (26832 36358 865969 0) 0 nil])
([nil nil ((#("
(defmethod repo-show ((entity symbol) ctx id)
  (let* ((md (entity-metadata entity))
         (table (getf md :table))
         (pk    (or (getf md :primary-key) :id))
         (filters (list '= pk id)))
    (let* ((tid (getf ctx :tenant-id))
           (tcol (or (getf md :tenant-id-col) :tenant_id)))
      (when tid (setf filters (list 'and filters (list '= tcol tid)))))
    (lumen.data.db:ensure-connection
	(let ((rows (select* table :filters filters :limit 1)))
	  (and rows (first rows))))))
" 0 1 (fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 21 (face font-lock-function-name-face fontified t) 21 50 (fontified t) 50 54 (face font-lock-keyword-face fontified t) 54 111 (fontified t) 111 117 (face font-lock-builtin-face fontified t) 117 149 (fontified t) 149 161 (face font-lock-builtin-face fontified t) 161 162 (fontified t) 162 163 (fontified t) 163 166 (face font-lock-builtin-face fontified t) 166 169 (fontified t) 169 210 (fontified t) 210 214 (face font-lock-keyword-face fontified t) 214 231 (fontified t) 231 241 (face font-lock-builtin-face fontified t) 241 274 (fontified t) 274 288 (face font-lock-builtin-face fontified t) 288 290 (fontified t) 290 300 (face font-lock-builtin-face fontified t) 300 311 (fontified t) 311 315 (face font-lock-keyword-face fontified t) 315 415 (fontified t) 415 418 (face font-lock-keyword-face fontified t) 418 441 (fontified t) 441 449 (face font-lock-builtin-face fontified t) 449 458 (fontified t) 458 464 (face font-lock-builtin-face fontified t) 464 501 (fontified t)) . -14006) (undo-tree-id17 . -501) (undo-tree-id18 . -1) (undo-tree-id19 . -1) (undo-tree-id20 . -304) (undo-tree-id21 . -501) 14507) nil (26832 36358 865968 0) 0 nil])
([nil nil ((#("(defmethod repo-create ((entity symbol) ctx payload)
  (repo-persist :create entity ctx :payload payload))

(defmethod repo-persist ((op (eql :create)) (entity symbol) ctx &key id payload)
  (declare (ignore ctx id))
  (let* ((ent (row->entity entity payload)))
    (validate-entity! ent)
    (lumen.data.db:ensure-connection
	(multiple-value-bind (n ent2) (entity-insert! ent :returning t)
	  (declare (ignore n))
	  ;;(print (entity->row-alist ent2))
	  (entity->row-alist ent2)))))" 0 1 (fontified t) 1 10 (face font-lock-keyword-face fontified t) 10 11 (fontified t) 11 22 (face font-lock-function-name-face fontified t) 22 69 (fontified t) 69 76 (face font-lock-builtin-face fontified t) 76 88 (fontified t) 88 96 (face font-lock-builtin-face fontified t) 96 97 (fontified t) 97 107 (fontified t) 107 108 (fontified t) 108 109 (fontified t) 109 118 (face font-lock-keyword-face fontified t) 118 119 (fontified t) 119 131 (face font-lock-function-name-face fontified t) 131 142 (fontified t) 142 149 (face font-lock-builtin-face fontified t) 149 159 (fontified t) 159 172 (fontified t) 172 176 (face font-lock-type-face fontified t) 176 189 (fontified t) 189 192 (fontified t) 192 199 (face font-lock-keyword-face fontified t) 199 220 (fontified t) 220 224 (face font-lock-keyword-face fontified t) 224 328 (fontified t) 328 347 (face font-lock-keyword-face fontified t) 347 377 (fontified t) 377 387 (face font-lock-builtin-face fontified t) 387 395 (fontified t) 395 402 (face font-lock-keyword-face fontified t) 402 418 (fontified t) 418 420 (face font-lock-comment-delimiter-face fontified t) 420 453 (face font-lock-comment-face fontified t) 453 484 (fontified t)) . -14017) (undo-tree-id13 . -484) (undo-tree-id14 . -453) (undo-tree-id15 . -484) (undo-tree-id16 . -484) 14501) nil (26832 36358 865964 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 14560 . 14561) (nil fontified nil 14017 . 14561) (14017 . 14561)) nil (26832 36358 865960 0) 0 nil])
([nil nil ((#("
(defmethod repo-patch ((entity symbol) ctx id payload)
  (repo-persist :patch entity ctx :id id :payload payload))

(defmethod repo-persist ((op (eql :patch)) (entity symbol) ctx &key id payload)
  (declare (ignore ctx))
  (let* ((cur (repo-show entity (list) id)))
    (unless cur (error \"not_found\"))
    (let* ((ent (row->entity entity cur)))
      ;;#|
      (dolist (kv payload)
        (let* ((col (car kv)) (val (cdr kv))
               (slot (entity-slot-symbol entity col)))
      (setf (slot-value ent slot) val)))
      ;;|#
      (validate-entity! ent)
      (lumen.data.db:ensure-connection
	  (multiple-value-bind (n ent2) (entity-update! ent :patch t :returning t)
            (declare (ignore n))
            (entity->row-alist ent2))))))" 0 1 (face font-lock-comment-face fontified t) 1 2 (fontified t) 2 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 22 (face font-lock-function-name-face fontified t) 22 72 (fontified t) 72 78 (face font-lock-builtin-face fontified t) 78 90 (fontified t) 90 93 (face font-lock-builtin-face fontified t) 93 97 (fontified t) 97 105 (face font-lock-builtin-face fontified t) 105 118 (fontified t) 118 127 (face font-lock-keyword-face fontified t) 127 128 (fontified t) 128 140 (face font-lock-function-name-face fontified t) 140 151 (fontified t) 151 157 (face font-lock-builtin-face fontified t) 157 180 (fontified t) 180 184 (face font-lock-type-face fontified t) 184 200 (fontified t) 200 207 (face font-lock-keyword-face fontified t) 207 225 (fontified t) 225 229 (face font-lock-keyword-face fontified t) 229 272 (fontified t) 272 278 (face font-lock-keyword-face fontified t) 278 284 (fontified t) 284 289 (face font-lock-warning-face fontified t) 289 290 (fontified t) 290 301 (face font-lock-string-face fontified t) 301 309 (fontified t) 309 313 (face font-lock-keyword-face fontified t) 313 353 (fontified t) 353 355 (face font-lock-comment-delimiter-face fontified t) 355 358 (face font-lock-comment-face fontified t) 358 365 (fontified t) 365 371 (face font-lock-keyword-face fontified t) 371 394 (fontified t) 394 398 (face font-lock-keyword-face fontified t) 398 424 (fontified t) 424 425 (fontified t) 425 430 (fontified t) 430 478 (fontified t) 478 485 (fontified t) 485 532 (fontified t) 532 534 (face font-lock-comment-delimiter-face fontified t) 534 537 (face font-lock-comment-face fontified t) 537 609 (fontified t) 609 628 (face font-lock-keyword-face fontified t) 628 646 (fontified t) 646 658 (fontified t) 658 664 (face font-lock-builtin-face fontified t) 664 667 (fontified t) 667 677 (face font-lock-builtin-face fontified t) 677 681 (fontified t) 681 694 (fontified t) 694 701 (face font-lock-keyword-face fontified t) 701 755 (fontified t)) . -14588) (undo-tree-id9 . -755) (undo-tree-id10 . -714) (undo-tree-id11 . -755) (undo-tree-id12 . -755) 15343) nil (26832 36358 865959 0) 0 nil])
([nil nil ((14588 . 14589)) nil (26832 36358 865956 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15461 . 15462) (nil fontified nil 14589 . 15462) (14589 . 15462)) nil (26832 36358 865955 0) 0 nil])
([nil nil ((#("
" 0 1 (rear-nonsticky t fontified t)) . -15461) (undo-tree-id7 . -1) (undo-tree-id8 . -1) 15462) nil (26832 36358 865954 0) 0 nil])
([nil nil ((15564 . 15566)) nil (26832 36358 865952 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15872 . 15873) (nil fontified nil 15566 . 15873) (15566 . 15873)) nil (26832 36358 865950 0) 0 nil])
([nil nil ((#("

(defmethod repo-persist ((op (eql :delete)) (entity symbol) ctx &key id payload)
  (declare (ignore ctx payload))
  (lumen.data.db:with-tx ()
    (let ((cur (repo-show entity (list) id)))
      (unless cur (error \"not_found\"))
      (entity-delete! (row->entity entity cur))
      `((:deleted . t) (:id . ,id)))))" 0 1 (fontified t) 1 3 (fontified t) 3 12 (face font-lock-keyword-face fontified t) 12 13 (fontified t) 13 25 (face font-lock-function-name-face fontified t) 25 36 (fontified t) 36 43 (face font-lock-builtin-face fontified t) 43 66 (fontified t) 66 70 (face font-lock-type-face fontified t) 70 86 (fontified t) 86 93 (face font-lock-keyword-face fontified t) 93 119 (fontified t) 119 120 (face font-lock-keyword-face fontified t) 120 121 (face font-lock-keyword-face fontified t) 121 140 (face font-lock-keyword-face fontified t) 140 144 (fontified t) 144 149 (fontified t) 149 152 (face font-lock-keyword-face fontified t) 152 197 (fontified t) 197 203 (face font-lock-keyword-face fontified t) 203 209 (fontified t) 209 214 (face font-lock-warning-face fontified t) 214 215 (fontified t) 215 226 (face font-lock-string-face fontified t) 226 286 (fontified t) 286 294 (face font-lock-builtin-face fontified t) 294 301 (fontified t) 301 304 (face font-lock-builtin-face fontified t) 304 315 (fontified t)) . -15873) (undo-tree-id0 . -315) (undo-tree-id1 . -225) (undo-tree-id2 . -312) (undo-tree-id3 . -312) (undo-tree-id4 . -312) (undo-tree-id5 . -312) (undo-tree-id6 . -277) 16188) nil (26832 36358 865947 0) 0 nil])
([nil nil ((#("
#|
(defmethod repo-show :around (entity ctx id)
  (let ((op :show)) (repo-authorize op entity ctx :id id) (call-next-method)))
|#
" 0 1 (fontified t) 1 3 (face font-lock-comment-delimiter-face fontified t) 3 17 (face font-lock-comment-face fontified t) 17 49 (face font-lock-comment-face fontified t) 49 128 (face font-lock-comment-face fontified t) 128 130 (face font-lock-comment-delimiter-face fontified t) 130 131 (fontified t)) . 18895) (undo-tree-id39 . -131) (t 26832 36358 0 0)) nil (26833 1231 976461 0) 0 nil])
([nil nil ((18169 . 18171)) nil (26833 1231 976460 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 18996 . 18997) (nil fontified nil 18171 . 18997) (18171 . 18997)) nil (26944 14430 767521 0) 0 nil])
([nil nil ((15268 . 15275)) nil (26944 15140 400808 0) 0 nil] [nil nil ((#("

(defmethod repo-index :around (entity ctx &rest args)
  (destructuring-bind (&key filters &allow-other-keys) args
    (let* ((tid        (getf ctx :tenant-id))
           (base       (%ensure-filter-list filters))
           (ten-clause (%tenant-filter-clause tid))
           ;; Ajoute le tenant_id à la fin (AND implicite)
           (filters*   (if ten-clause (append base (list ten-clause)) base))
           ;; Remplace :filters dans les args
           (args*      (alexandria:plist-alist (lumen.utils:copy-plist args))))
      (setf (cdr (assoc :filters args*)) filters*)
      (let ((op :index))
        (repo-authorize op entity ctx)
        (apply #'call-next-method entity ctx (alexandria:alist-plist args*))))))
" 0 1 (fontified t) 1 3 (fontified t) 3 12 (face font-lock-keyword-face fontified t) 12 13 (fontified t) 13 23 (face font-lock-function-name-face fontified t) 23 24 (fontified t) 24 31 (face font-lock-builtin-face fontified t) 31 44 (fontified t) 44 49 (face font-lock-type-face fontified t) 49 59 (fontified t) 59 77 (face font-lock-keyword-face fontified t) 77 79 (fontified t) 79 83 (face font-lock-type-face fontified t) 83 92 (fontified t) 92 109 (face font-lock-type-face fontified t) 109 121 (fontified t) 121 125 (face font-lock-keyword-face fontified t) 125 149 (fontified t) 149 159 (face font-lock-builtin-face fontified t) 159 279 (fontified t) 279 282 (face font-lock-comment-delimiter-face fontified t) 282 327 (face font-lock-comment-face fontified t) 327 351 (fontified t) 351 353 (face font-lock-keyword-face fontified t) 353 415 (fontified t) 415 418 (face font-lock-comment-delimiter-face fontified t) 418 450 (face font-lock-comment-face fontified t) 450 554 (fontified t) 554 562 (face font-lock-builtin-face fontified t) 562 588 (fontified t) 588 591 (face font-lock-keyword-face fontified t) 591 597 (fontified t) 597 603 (face font-lock-builtin-face fontified t) 603 726 (fontified t)) . -18997) 19723) ((18997 . 19723) (t 26833 1529 0 0)) (26833 1527 828596 0) 0 nil])
([nil nil ((15275 . 15281)) nil (26944 15140 400808 0) 0 nil])
([nil nil ((#("(defmethod repo-show :around (entity ctx id)
  (let ((op :show))
    (repo-authorize op entity ctx :id id)
    (let* ((row (call-next-method))      ; SELECT primaire
           (tid (getf ctx :tenant-id))
           (rid (and row (cdr (assoc :tenant_id row)))))
      (cond
        ((null row) nil)                                 ; rien trouvé
        ((null tid) nil)                                 ; pas de scope tenant → prudence
        ((null rid) row)                                 ; pas de colonne tenant → renvoie
        ((string-equal (string rid) (string tid)) row)   ; même tenant → OK
        (t nil)))))                                      ; cross-tenant → masque la fuite" 0 1 (fontified t) 1 10 (face font-lock-keyword-face fontified t) 10 11 (fontified t) 11 20 (face font-lock-function-name-face fontified t) 20 21 (fontified t) 21 28 (face font-lock-builtin-face fontified t) 28 48 (fontified t) 48 51 (face font-lock-keyword-face fontified t) 51 57 (fontified t) 57 62 (face font-lock-builtin-face fontified t) 62 99 (fontified t) 99 102 (face font-lock-builtin-face fontified t) 102 112 (fontified t) 112 116 (face font-lock-keyword-face fontified t) 116 148 (fontified t) 148 166 (face font-lock-comment-face fontified t) 166 192 (fontified t) 192 202 (face font-lock-builtin-face fontified t) 202 242 (fontified t) 242 252 (face font-lock-builtin-face fontified t) 252 269 (fontified t) 269 273 (face font-lock-keyword-face fontified t) 273 331 (fontified t) 331 345 (face font-lock-comment-face fontified t) 345 402 (fontified t) 402 435 (face font-lock-comment-face fontified t) 435 492 (fontified t) 492 526 (face font-lock-comment-face fontified t) 526 583 (fontified t) 583 602 (face font-lock-comment-face fontified t) 602 659 (fontified t) 659 691 (face font-lock-comment-face fontified t)) . 18998) (undo-tree-id34 . -691) (undo-tree-id36 . -691)) ((18998 . 19689)) (26833 1527 4451 0) 0 nil])
([nil nil ((15281 . 15282)) nil (26944 15140 400808 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 20015 . 20016) (nil fontified nil 18998 . 20016) (18998 . 20016)) ((#("(defmethod repo-show :around (entity ctx id)
  (let ((op :show))
    (repo-authorize op entity ctx :id id)
    (let* ((row (call-next-method))                ; SELECT primaire
           (md  (entity-metadata entity))
           (tcol (%entity-tenant-col entity md))   ; NIL si pas de colonne tenant
           (tid (getf ctx :tenant-id)))
      (cond
        ((null row) nil)                           ; rien trouvé
        ((null tcol) row)                          ; pas de colonne tenant → OK
        ((null tid) row)                           ; pas de tenant dans ctx → on ne bloque pas
        (t
         (let* ((rid (or (cdr (assoc tcol row))
                         (cdr (assoc (string-downcase (symbol-name tcol))
                                     row :test #'string=)))))
           (if (and rid
                    (string-equal (princ-to-string rid)
                                  (princ-to-string tid)))
               row
               nil))))))                           ; cross-tenant → masque" 0 1 (fontified nil) 1 10 (face font-lock-keyword-face fontified nil) 10 11 (fontified nil) 11 20 (face font-lock-function-name-face fontified nil) 20 21 (fontified nil) 21 28 (face font-lock-builtin-face fontified nil) 28 48 (fontified nil) 48 51 (face font-lock-keyword-face fontified nil) 51 57 (fontified nil) 57 62 (face font-lock-builtin-face fontified nil) 62 99 (fontified nil) 99 102 (face font-lock-builtin-face fontified nil) 102 112 (fontified nil) 112 116 (face font-lock-keyword-face fontified nil) 116 158 (fontified nil) 158 176 (face font-lock-comment-face fontified nil) 176 269 (fontified nil) 269 300 (face font-lock-comment-face fontified nil) 300 326 (fontified nil) 326 336 (face font-lock-builtin-face fontified nil) 336 347 (fontified nil) 347 351 (face font-lock-keyword-face fontified nil) 351 403 (fontified nil) 403 417 (face font-lock-comment-face fontified nil) 417 468 (fontified nil) 468 497 (face font-lock-comment-face fontified nil) 497 548 (fontified nil) 548 592 (face font-lock-comment-face fontified nil) 592 613 (fontified nil) 613 617 (face font-lock-keyword-face fontified nil) 617 766 (fontified nil) 766 771 (face font-lock-builtin-face fontified nil) 771 799 (fontified nil) 799 801 (face font-lock-keyword-face fontified nil) 801 944 (fontified nil) 944 995 (fontified nil) 995 1017 (face font-lock-comment-face fontified nil) 1017 1018 (face font-lock-comment-face rear-nonsticky nil fontified nil)) . 18998) (undo-tree-id41 . -968) (undo-tree-id42 . -968) (undo-tree-id43 . -968) (undo-tree-id44 . -591) (undo-tree-id45 . -591) (undo-tree-id46 . -591) (undo-tree-id47 . -591) (undo-tree-id48 . -591) (undo-tree-id49 . -591) (undo-tree-id50 . -944) (undo-tree-id51 . -968) (undo-tree-id52 . -944) (undo-tree-id53 . -968) (undo-tree-id54 . -968) (undo-tree-id55 . -968) (nil fontified t 19799 . 19942) (nil fontified t 19797 . 19799) (nil fontified t 19769 . 19797) (nil fontified t 19764 . 19769) (nil fontified t 19615 . 19764) (nil fontified t 19611 . 19615) (nil fontified t 19590 . 19611) (nil fontified t 19546 . 19590) (nil fontified t 19495 . 19546) (nil fontified t 19466 . 19495) (nil fontified t 19415 . 19466) (nil fontified t 19401 . 19415) (nil fontified t 19349 . 19401) (nil fontified t 19345 . 19349) (nil fontified t 19334 . 19345) (nil fontified t 19324 . 19334) (nil fontified t 19298 . 19324) (nil fontified t 19267 . 19298) (nil fontified t 19174 . 19267) (nil fontified t 19156 . 19174) (nil fontified t 19114 . 19156) (nil fontified t 19110 . 19114) (nil fontified t 19100 . 19110) (nil fontified t 19097 . 19100) (nil fontified t 19060 . 19097) (nil fontified t 19055 . 19060) (nil fontified t 19049 . 19055) (nil fontified t 19046 . 19049) (nil fontified t 19026 . 19046) (nil fontified t 19019 . 19026) (nil fontified t 19018 . 19019) (nil fontified t 19009 . 19018) (nil fontified t 19008 . 19009) (nil fontified t 18999 . 19008) (nil fontified t 18998 . 18999) (nil rear-nonsticky t 20015 . 20016)) (26833 1526 513399 0) 0 nil])
([nil nil ((15282 . 15285)) nil (26944 15140 400807 0) 0 nil])
([nil nil ((19966 . 19967) (t 26833 1231 0 0)) ((#(")" 0 1 (fontified t)) . 19966) (undo-tree-id40 . -1) (t 26833 1253 0 0)) (26833 1253 433610 0) 0 nil])
([nil nil ((#("\"" 0 1 (face font-lock-string-face fontified t)) . -15282) (undo-tree-id1 . -1) (#("X" 0 1 (face font-lock-string-face fontified t)) . -15283) (undo-tree-id2 . -1) (#("X" 0 1 (face font-lock-string-face fontified t)) . -15284) (undo-tree-id3 . -1) 15285) nil (26944 15140 400806 0) 0 nil])
nil
([nil nil ((15282 . 15289)) nil (26944 15140 400803 0) 0 nil])
([nil nil ((#("=" 0 1 (fontified t)) . -15288) (undo-tree-id0 . -1) 15289) nil (26944 15140 400803 0) 0 nil])
([nil nil ((15288 . 15289)) nil (26944 15140 400790 0) 0 nil])
([nil nil ((15289 . 15296)) nil (26944 15140 400789 0) 0 nil])
([nil nil ((15296 . 15302)) nil (26944 15140 400789 0) 0 nil])
([nil nil ((15302 . 15303)) nil (26944 15140 400789 0) 0 nil])
([nil nil ((15303 . 15307)) nil (26944 15140 400788 0) 0 nil])
([nil nil ((14991 . 14998)) nil (26944 15140 400787 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15008 . 15009) (nil fontified nil 14998 . 15009) (14998 . 15009)) nil (26944 15140 400783 0) 0 nil])
([nil nil ((17057 . 17059) (t 26944 15140 0 0)) nil (26944 15413 353138 0) 0 nil])
([nil nil ((17059 . 17065)) nil (26944 15413 353137 0) 0 nil])
([nil nil ((17065 . 17066)) nil (26944 15413 353137 0) 0 nil])
([nil nil ((17066 . 17071)) nil (26944 15413 353136 0) 0 nil])
([nil nil ((#("é" 0 1 (face font-lock-string-face fontified t)) . -17070) (undo-tree-id15 . -1) 17071) nil (26944 15413 353136 0) 0 nil])
([nil nil ((17070 . 17072)) nil (26944 15413 353135 0) 0 nil])
([nil nil ((17000 . 17002)) nil (26944 15413 353134 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 17014 . 17015) (nil fontified nil 17014 . 17015) (nil fontified nil 17009 . 17014) (nil fontified nil 17002 . 17009) (17002 . 17015)) nil (26944 15413 353134 0) 0 nil])
([nil nil ((#("333" 0 3 (face font-lock-string-face fontified t)) . -17010) (undo-tree-id5 . -3) (undo-tree-id6 . -1) (undo-tree-id7 . -1) (undo-tree-id8 . -1) (undo-tree-id9 . -1) (undo-tree-id10 . -1) (undo-tree-id11 . -3) (undo-tree-id12 . -3) (undo-tree-id13 . -3) (undo-tree-id14 . -3) 17013) nil (26944 15413 353132 0) 0 nil])
([nil nil ((17010 . 17013)) nil (26944 15413 353125 0) 0 nil])
([nil nil ((16902 . 16909)) nil (26944 15413 353124 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 16921 . 16922) (nil fontified nil 16921 . 16922) (nil fontified nil 16916 . 16921) (nil fontified nil 16909 . 16916) (16909 . 16922)) nil (26944 15413 353123 0) 0 nil])
([nil nil ((#("333" 0 3 (face font-lock-string-face fontified t)) . 16917) (undo-tree-id4 . -3)) nil (26944 15413 353122 0) 0 nil])
([nil nil ((16917 . 16919)) nil (26944 15413 353113 0) 0 nil])
([nil nil ((16919 . 16920)) nil (26944 15413 353109 0) 0 nil])
([nil nil ((15200 . 15204) (t 26944 15413 0 0)) nil (26944 15497 302272 0) 0 nil])
([nil nil ((15204 . 15210)) nil (26944 15497 302271 0) 0 nil])
([nil nil ((15210 . 15211)) nil (26944 15497 302270 0) 0 nil])
([nil nil ((15211 . 15216)) nil (26944 15497 302267 0) 0 nil])
([nil nil ((15009 . 15016) (t 26944 15497 0 0)) nil (26944 15526 265541 0) 0 nil])
([nil nil ((nil fontified nil 15026 . 15027) (nil fontified nil 15016 . 15026) (15016 . 15027)) nil (26944 15526 265540 0) 0 nil])
([nil nil ((#("ent" 0 3 (fontified t)) . -15023) (undo-tree-id16 . -3) (undo-tree-id17 . -1) (undo-tree-id18 . -1) (undo-tree-id19 . -1) (undo-tree-id20 . -1) (undo-tree-id21 . -1) (undo-tree-id22 . -3) (undo-tree-id23 . -3) (undo-tree-id24 . -3) (undo-tree-id25 . -3) (undo-tree-id26 . -3) (undo-tree-id27 . -3) (undo-tree-id28 . -3) (undo-tree-id29 . -3) 15026) nil (26944 15526 265538 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15030 . 15031) (nil fontified nil 15023 . 15031) (15023 . 15031)) nil (26944 15526 265516 0) 0 nil])
([nil nil ((15106 . 15108) (t 26944 15526 0 0)) nil (26944 15663 667754 0) 0 nil])
([nil nil ((15108 . 15114)) nil (26944 15663 667753 0) 0 nil])
([nil nil ((15114 . 15115)) nil (26944 15663 667752 0) 0 nil])
([nil nil ((15115 . 15121)) nil (26944 15663 667749 0) 0 nil])
([nil nil ((15152 . 15161) (t 26944 15663 0 0)) nil (26944 15767 187167 0) 0 nil])
([nil nil ((15161 . 15163)) nil (26944 15767 187166 0) 0 nil])
([nil nil ((15163 . 15164)) nil (26944 15767 187165 0) 0 nil])
([nil nil ((15164 . 15170)) nil (26944 15767 187165 0) 0 nil])
([nil nil ((15170 . 15171)) nil (26944 15767 187165 0) 0 nil])
([nil nil ((15171 . 15176)) nil (26944 15767 187164 0) 0 nil])
([nil nil ((15176 . 15185)) nil (26944 15767 187164 0) 0 nil])
([nil nil ((15185 . 15187)) nil (26944 15767 187163 0) 0 nil])
([nil nil ((15187 . 15188)) nil (26944 15767 187163 0) 0 nil])
([nil nil ((15188 . 15194)) nil (26944 15767 187162 0) 0 nil])
([nil nil ((15194 . 15195)) nil (26944 15767 187162 0) 0 nil])
([nil nil ((#("(x (print " 0 10 (fontified t)) . 15185) (undo-tree-id94 . -10) (undo-tree-id95 . -1) (undo-tree-id96 . -1) (undo-tree-id97 . -1) (undo-tree-id98 . -1) (undo-tree-id99 . -3) (undo-tree-id100 . -3) (undo-tree-id101 . -3) (undo-tree-id102 . -3) (undo-tree-id103 . -6) (undo-tree-id104 . -6) (undo-tree-id105 . -7) (undo-tree-id106 . -7) (undo-tree-id107 . -8) (undo-tree-id108 . -8) (undo-tree-id109 . -10) (undo-tree-id110 . -10) (undo-tree-id111 . -10) (undo-tree-id112 . -10) (undo-tree-id113 . -10) (undo-tree-id114 . -10) (undo-tree-id115 . -10) (undo-tree-id116 . -10) (undo-tree-id117 . -10) (undo-tree-id118 . -10) (undo-tree-id119 . -10) (undo-tree-id120 . -10) (undo-tree-id121 . -10) (undo-tree-id122 . -10) 15195) nil (26944 15767 187161 0) 0 nil])
([nil nil ((#("
	       " 0 1 (fontified t) 1 9 (fontified t)) . 15176) (undo-tree-id42 . -9) (undo-tree-id43 . 9) (undo-tree-id44 . -1) (undo-tree-id45 . -9) (undo-tree-id46 . -9) (undo-tree-id47 . -9) (undo-tree-id48 . -9) (undo-tree-id49 . -1) (undo-tree-id50 . -9) (undo-tree-id51 . -1) (undo-tree-id52 . -9) (undo-tree-id53 . -9) (undo-tree-id54 . -9) (undo-tree-id55 . -1) (undo-tree-id56 . -1) (undo-tree-id57 . -1) (undo-tree-id58 . -9) (undo-tree-id59 . -9) (undo-tree-id60 . -1) (undo-tree-id61 . -9) (undo-tree-id62 . -9) (undo-tree-id63 . -1) (undo-tree-id64 . -9) (undo-tree-id65 . -9) (undo-tree-id66 . -1) (undo-tree-id67 . -9) (undo-tree-id68 . -1) (undo-tree-id69 . -9) (undo-tree-id70 . -9) (undo-tree-id71 . -9) (undo-tree-id72 . -9) (undo-tree-id73 . -9) (undo-tree-id74 . -9) (undo-tree-id75 . -9) (undo-tree-id76 . -9) (undo-tree-id77 . -9) (undo-tree-id78 . -9) (undo-tree-id79 . -9) (undo-tree-id80 . -9) (undo-tree-id81 . -9) (undo-tree-id82 . -9) (undo-tree-id83 . -9) (undo-tree-id84 . -9) (undo-tree-id85 . -9) (undo-tree-id86 . -1) (undo-tree-id87 . -9) (undo-tree-id88 . -9) (undo-tree-id89 . -9) (undo-tree-id90 . -9) (undo-tree-id91 . -9) (undo-tree-id92 . -9) (undo-tree-id93 . -9)) nil (26944 15767 187146 0) 0 nil])
([nil nil ((15207 . 15216)) nil (26944 15767 187124 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15225 . 15226) (nil fontified nil 15216 . 15226) (15216 . 15226)) nil (26944 15767 187124 0) 0 nil])
([nil nil ((15226 . 15227)) nil (26944 15767 187123 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -15226) (undo-tree-id37 . -1) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) 15227) nil (26944 15767 187122 0) 0 nil])
([nil nil ((15226 . 15230)) nil (26944 15767 187120 0) 0 nil])
([nil nil ((#("=" 0 1 (fontified t)) . -15229) (undo-tree-id30 . -1) (undo-tree-id31 . -1) (undo-tree-id32 . -1) (undo-tree-id33 . -1) (undo-tree-id34 . -1) (undo-tree-id35 . -1) (undo-tree-id36 . -1) 15230) nil (26944 15767 187118 0) 0 nil])
([nil nil ((15229 . 15231)) nil (26944 15767 187105 0) 0 nil])
([nil nil ((1117 . 1118) (t 26944 15767 0 0)) nil (26944 15915 160859 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1420 . 1421) (nil fontified nil 1309 . 1421) (nil fontified nil 1300 . 1309) (nil fontified nil 1294 . 1300) (nil fontified nil 1291 . 1294) (nil fontified nil 1287 . 1291) (nil fontified nil 1146 . 1287) (nil fontified nil 1139 . 1146) (nil fontified nil 1125 . 1139) (nil fontified nil 1124 . 1125) (nil fontified nil 1119 . 1124) (nil fontified nil 1118 . 1119) (1118 . 1421)) nil (26944 15915 160858 0) 0 nil])
([nil nil ((1421 . 1422)) nil (26944 15915 160857 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15461 . 15462) (nil fontified nil 15448 . 15462) (15448 . 15462)) nil (26944 15915 160856 0) 0 nil])
([nil nil ((15462 . 15463)) nil (26944 15915 160856 0) 0 nil])
([nil nil ((15448 . 15449)) nil (26944 15915 160855 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -15447) (undo-tree-id128 . -1) (undo-tree-id129 . -1) (undo-tree-id130 . -1) (#("\"" 0 1 (face font-lock-string-face fontified t)) . -15448) (undo-tree-id131 . -1) 15449) nil (26944 15915 160854 0) 0 nil])
([nil nil ((15447 . 15448)) nil (26944 15915 160851 0) 0 nil])
([nil nil ((#("'" 0 1 (fontified t)) . -15447) (undo-tree-id123 . -1) (undo-tree-id124 . -1) (undo-tree-id125 . -1) (undo-tree-id126 . -1) (undo-tree-id127 . -1) 15448) nil (26944 15915 160850 0) 0 nil])
([nil nil ((15447 . 15448)) nil (26944 15915 160839 0) 0 nil])
([nil nil ((15472 . 15473)) nil (26944 15915 160835 0) 0 nil])
([nil nil ((#("-" 0 1 (fontified t)) . -1395) (undo-tree-id137 . -1) (undo-tree-id138 . -1) (undo-tree-id139 . -1) 1396 (t 26944 15915 0 0)) nil (26944 16016 129467 0) 0 nil])
([nil nil ((1395 . 1396)) nil (26944 16016 129465 0) 0 nil])
([nil nil ((#("_" 0 1 (fontified t)) . -1399) (undo-tree-id132 . -1) (undo-tree-id133 . -1) (undo-tree-id134 . -1) (undo-tree-id135 . -1) (undo-tree-id136 . -1) 1400) nil (26944 16016 129463 0) 0 nil])
([nil nil ((1399 . 1400)) nil (26944 16016 129449 0) 0 nil])
([nil nil ((#("_" 0 1 (face font-lock-doc-face fontified t)) . -1165) (undo-tree-id192 . -1) 1166 (t 26944 16016 0 0)) nil (26944 16074 142963 0) 0 nil])
([nil nil ((1165 . 1166)) nil (26944 16074 142961 0) 0 nil])
([nil nil ((#("-" 0 1 (face font-lock-doc-face fontified t)) . -1171) (undo-tree-id191 . -1) 1172) nil (26944 16074 142960 0) 0 nil])
([nil nil ((1171 . 1172)) nil (26944 16074 142959 0) 0 nil])
([nil nil ((#("
	(print \"111\")" 0 1 (fontified t) 1 2 (fontified t) 2 9 (fontified t) 9 12 (fontified t face font-lock-string-face) 12 14 (face font-lock-string-face fontified t) 14 15 (fontified t rear-nonsticky t)) . 17443) (undo-tree-id190 . -15)) nil (26944 16074 142958 0) 0 nil])
([nil nil ((#("
      (print \"000\")" 0 1 (fontified t) 1 7 (fontified t) 7 14 (fontified t) 14 19 (face font-lock-string-face fontified t) 19 20 (fontified t rear-nonsticky t)) . 17325) (undo-tree-id187 . -20) (undo-tree-id188 . -20) (undo-tree-id189 . -20)) nil (26944 16074 142956 0) 0 nil])
([nil nil ((#("
	(print \"333\")" 0 1 (fontified t) 1 9 (fontified t) 9 14 (face font-lock-string-face fontified t) 14 15 (fontified t)) . 17480) (undo-tree-id182 . -15) (undo-tree-id183 . -15) (undo-tree-id184 . -15) (undo-tree-id185 . -15) (undo-tree-id186 . -15)) nil (26944 16074 142954 0) 0 nil])
([nil nil ((#("
	       (x (print col))" 0 1 (fontified t) 1 14 (fontified t) 14 16 (fontified t) 16 24 (fontified t)) . 15473) (undo-tree-id168 . -24) (undo-tree-id169 . -24) (undo-tree-id170 . -16) (undo-tree-id171 . -16) (undo-tree-id172 . -16) (undo-tree-id173 . -16) (undo-tree-id174 . -16) (undo-tree-id175 . -16) (undo-tree-id176 . -16) (undo-tree-id177 . -16) (undo-tree-id178 . -24) (undo-tree-id179 . -24) (undo-tree-id180 . -24) (undo-tree-id181 . -24)) nil (26944 16074 142949 0) 0 nil])
([nil nil ((#("
	       (x (print val))" 0 1 (fontified t) 1 9 (fontified t) 9 18 (fontified t) 18 19 (fontified t rear-nonsticky t) 19 24 (fontified t)) . 15504) (undo-tree-id162 . -24) (undo-tree-id163 . -9) (undo-tree-id164 . -24) (undo-tree-id165 . -24) (undo-tree-id166 . -24) (undo-tree-id167 . -24)) nil (26944 16074 142940 0) 0 nil])
([nil nil ((#("
	  (print slot)" 0 1 (fontified t) 1 16 (fontified t)) . 15559) (undo-tree-id157 . -16) (undo-tree-id158 . -16) (undo-tree-id159 . -16) (undo-tree-id160 . -16) (undo-tree-id161 . -16)) nil (26944 16074 142934 0) 0 nil])
([nil nil ((#("
	(print \"XXX\")" 0 1 (fontified t) 1 9 (fontified t) 9 14 (face font-lock-string-face fontified t) 14 15 (fontified t)) . 15411) (undo-tree-id152 . -15) (undo-tree-id153 . -15) (undo-tree-id154 . -15) (undo-tree-id155 . -15) (undo-tree-id156 . -15)) nil (26944 16074 142930 0) 0 nil])
([nil nil ((#("
      (print ent)
      (print payload*)" 0 1 (fontified t) 1 7 (fontified t) 7 17 (fontified t) 17 18 (fontified t rear-nonsticky t) 18 19 (fontified t) 19 25 (fontified t) 25 32 (fontified t) 32 39 (fontified t) 39 40 (fontified t rear-nonsticky t) 40 41 (fontified t rear-nonsticky t)) . 15296) (undo-tree-id145 . -41) (undo-tree-id146 . -18) (undo-tree-id147 . -32) (undo-tree-id148 . -41) (undo-tree-id149 . -41) (undo-tree-id150 . -41) (undo-tree-id151 . -41)) nil (26944 16074 142925 0) 0 nil])
([nil nil ((#("
      (print \"2222\")
      (print ent)" 0 1 (fontified t) 1 14 (fontified t) 14 20 (face font-lock-string-face fontified t) 20 22 (fontified t) 22 39 (fontified t)) . 15589) (undo-tree-id140 . -39) (undo-tree-id141 . -39) (undo-tree-id142 . -39) (undo-tree-id143 . -39) (undo-tree-id144 . -39)) nil (26944 16074 142916 0) 0 nil])
([nil nil ((14374 . 14377) (t 26944 16074 0 0)) nil (26948 13305 550554 0) 0 nil])
([nil nil ((14377 . 14383)) nil (26948 13305 550554 0) 0 nil])
([nil nil ((14383 . 14384)) nil (26948 13305 550553 0) 0 nil])
([nil nil ((14384 . 14387)) nil (26948 13305 550553 0) 0 nil])
([nil nil ((14387 . 14388)) nil (26948 13305 550552 0) 0 nil])
([nil nil ((14388 . 14392)) nil (26948 13305 550552 0) 0 nil])
([nil nil ((14392 . 14393)) nil (26948 13305 550551 0) 0 nil])
([nil nil ((14393 . 14399)) nil (26948 13305 550551 0) 0 nil])
([nil nil ((14399 . 14400)) nil (26948 13305 550550 0) 0 nil])
([nil nil ((#(")" 0 1 (face font-lock-string-face fontified t)) . -14399) (undo-tree-id1 . -1) 14400) nil (26948 13305 550549 0) 0 nil])
([nil nil ((14399 . 14401)) nil (26948 13305 550547 0) 0 nil])
([nil nil ((14561 . 14564)) nil (26948 13305 550547 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 14587 . 14588) (nil fontified nil 14587 . 14588) (nil fontified nil 14571 . 14587) (nil fontified nil 14564 . 14571) (14564 . 14588)) nil (26948 13305 550546 0) 0 nil])
([nil nil ((#("CREATE" 0 6 (face font-lock-string-face fontified t)) . -14580) (undo-tree-id0 . -6) 14586) nil (26948 13305 550544 0) 0 nil])
([nil nil ((14580 . 14587)) nil (26948 13305 550524 0) 0 nil])
([nil nil ((16852 . 16854) (t 26948 13305 0 0)) nil (26949 34653 146946 0) 0 nil])
([nil nil ((16854 . 16860)) nil (26949 34653 146946 0) 0 nil])
([nil nil ((16860 . 16861)) nil (26949 34653 146945 0) 0 nil])
([nil nil ((16861 . 16864)) nil (26949 34653 146945 0) 0 nil])
([nil nil ((16955 . 16957)) nil (26949 34653 146945 0) 0 nil])
([nil nil ((16957 . 16963)) nil (26949 34653 146944 0) 0 nil])
([nil nil ((16963 . 16964)) nil (26949 34653 146943 0) 0 nil])
([nil nil ((16964 . 16969)) nil (26949 34653 146943 0) 0 nil])
([nil nil ((16969 . 16970)) nil (26949 34653 146942 0) 0 nil])
([nil nil ((16970 . 16974)) nil (26949 34653 146941 0) 0 nil])
([nil nil ((#("=" 0 1 (fontified t)) . -16973) (undo-tree-id4 . -1) 16974) nil (26949 34653 146941 0) 0 nil])
([nil nil ((16973 . 16974)) nil (26949 34653 146939 0) 0 nil])
([nil nil ((16741 . 16748)) nil (26949 34653 146939 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 16764 . 16765) (nil fontified nil 16764 . 16765) (nil fontified nil 16755 . 16764) (nil fontified nil 16748 . 16755) (16748 . 16765)) nil (26949 34653 146938 0) 0 nil])
([nil nil ((16756 . 16758)) nil (26949 34653 146937 0) 0 nil])
([nil nil ((16758 . 16759)) nil (26949 34653 146937 0) 0 nil])
([nil nil ((#(" OK" 0 3 (face font-lock-string-face fontified t)) . 16763)) nil (26949 34653 146936 0) 0 nil])
([nil nil ((16763 . 16764)) nil (26949 34653 146935 0) 0 nil])
([nil nil ((16764 . 16769)) nil (26949 34653 146935 0) 0 nil])
([nil nil ((#("T" 0 1 (face font-lock-string-face fontified t)) . -16767) (undo-tree-id2 . -1) (#("E" 0 1 (face font-lock-string-face fontified t)) . -16768) (undo-tree-id3 . -1) 16769) nil (26949 34653 146934 0) 0 nil])
([nil nil ((16767 . 16770)) nil (26949 34653 146921 0) 0 nil])
([nil nil ((16770 . 16771)) nil (26949 34653 146920 0) 0 nil])
([nil nil ((16771 . 16777)) nil (26949 34653 146916 0) 0 nil])
([nil nil ((18615 . 18616) (t 26949 34653 0 0)) nil (26949 38479 796454 0) 0 nil])
([nil nil ((18616 . 18618)) nil (26949 38479 796454 0) 0 nil])
([nil nil ((19445 . 19447)) nil (26949 38479 796453 0) 0 nil])
([nil nil ((20100 . 20104)) nil (26949 38479 796453 0) 0 nil])
([nil nil ((20104 . 20105)) nil (26949 38479 796452 0) 0 nil])
([nil nil ((20105 . 20110)) nil (26949 38479 796452 0) 0 nil])
([nil nil ((20110 . 20111)) nil (26949 38479 796451 0) 0 nil])
([nil nil ((20179 . 20181)) nil (26949 38479 796451 0) 0 nil])
([nil nil ((20181 . 20185)) nil (26949 38479 796450 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 20233 . 20234) (nil fontified nil 20230 . 20234) (nil fontified nil 20222 . 20230) (nil fontified nil 20218 . 20222) (nil fontified nil 20215 . 20218) (nil fontified nil 20185 . 20215) (20185 . 20234)) nil (26949 38479 796449 0) 0 nil])
([nil nil ((#(" :id id :payload p1" 0 1 (fontified t) 1 4 (face font-lock-builtin-face fontified t) 4 8 (fontified t) 8 16 (face font-lock-builtin-face fontified t) 16 19 (fontified t)) . -20214) (undo-tree-id18 . -19) 20233) nil (26949 38479 796447 0) 0 nil])
([nil nil ((20219 . 20220)) nil (26949 38479 796445 0) 0 nil])
([nil nil ((20148 . 20153) (#(" " 0 1 (fontified nil)) . 20147) (undo-tree-id5 . -1) (undo-tree-id6 . -1) (undo-tree-id7 . -1) (undo-tree-id8 . -1) (undo-tree-id9 . -1) (undo-tree-id10 . -1) (undo-tree-id11 . -1) (undo-tree-id12 . -1) (undo-tree-id13 . -1) (undo-tree-id14 . -1) (undo-tree-id15 . -1) (undo-tree-id16 . -1) (undo-tree-id17 . -1) (20148 . 20149)) nil (26949 38479 796442 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -20486) (undo-tree-id23 . -1) (#(")" 0 1 (fontified t)) . -20487) (undo-tree-id24 . -1) 20488 (t 26949 38479 0 0)) nil (26949 38657 886038 0) 0 nil])
([nil nil ((20486 . 20487)) nil (26949 38657 886036 0) 0 nil])
([nil nil ((20487 . 20492)) nil (26949 38657 886036 0) 0 nil])
([nil nil ((20492 . 20496)) nil (26949 38657 886035 0) 0 nil])
([nil nil ((20496 . 20497)) nil (26949 38657 886034 0) 0 nil])
([nil nil ((#(")" 0 1 (fontified t)) . -20856) (undo-tree-id20 . -1) (undo-tree-id21 . -1) (undo-tree-id22 . -1) 20857) nil (26949 38657 886033 0) 0 nil])
([nil nil ((20926 . 20933)) nil (26949 38657 886030 0) 0 nil])
([nil nil ((20933 . 20937)) nil (26949 38657 886030 0) 0 nil])
([nil nil ((20937 . 20938)) nil (26949 38657 886030 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -20937) (undo-tree-id19 . -1) 20938) nil (26949 38657 886028 0) 0 nil])
([nil nil ((20937 . 20938)) nil (26949 38657 886020 0) 0 nil])
([nil nil ((20938 . 20939)) nil (26949 38657 886020 0) 0 nil])
([nil nil ((20939 . 20942)) nil (26949 38657 886019 0) 0 nil])
([nil nil ((20942 . 20944)) nil (26949 38657 886018 0) 0 nil])
([nil nil ((nil fontified nil 20973 . 20974) (nil fontified nil 20944 . 20973) (20944 . 20974)) nil (26949 38657 886017 0) 0 nil])
([nil nil ((20974 . 20978)) nil (26949 38657 886013 0) 0 nil])
([nil nil ((15351 . 15358) (t 26949 38657 0 0)) nil (26975 57988 132695 0) 0 nil])
([nil nil ((15358 . 15364)) nil (26975 57988 132694 0) 0 nil])
([nil nil ((15364 . 15365)) nil (26975 57988 132691 0) 0 nil])
([nil nil ((#("p" 0 1 (fontified t)) . -15359) (undo-tree-id101 . -1) (#("r" 0 1 (fontified t)) . -15360) (undo-tree-id102 . -1) (#("i" 0 1 (fontified t)) . -15361) (undo-tree-id103 . -1) (#("n" 0 1 (fontified t)) . -15362) (undo-tree-id104 . -1) (#("t" 0 1 (fontified t)) . -15363) (undo-tree-id105 . -1) (#(" " 0 1 (fontified t)) . -15364) (undo-tree-id106 . -1) 15365) nil (26975 57988 132689 0) 0 nil])
([nil nil ((15359 . 15365)) nil (26975 57988 132684 0) 0 nil])
([nil nil ((15365 . 15366)) nil (26975 57988 132684 0) 0 nil])
([nil nil ((15366 . 15367)) nil (26975 57988 132683 0) 0 nil])
([nil nil ((15367 . 15368)) nil (26975 57988 132683 0) 0 nil])
([nil nil ((15368 . 15369)) nil (26975 57988 132683 0) 0 nil])
([nil nil ((#("*" 0 1 (fontified t)) . -15368) (undo-tree-id100 . -1) 15369) nil (26975 57988 132682 0) 0 nil])
([nil nil ((15368 . 15377)) nil (26975 57988 132681 0) 0 nil])
([nil nil ((15369 . 15387)) nil (26975 57988 132680 0) 0 nil])
([nil nil ((#(";" 0 1 (face font-lock-string-face fontified t)) . -15386) (undo-tree-id99 . -1) 15387) nil (26975 57988 132680 0) 0 nil])
([nil nil ((15386 . 15387)) nil (26975 57988 132679 0) 0 nil])
([nil nil ((#(";" 0 1 (face font-lock-string-face fontified t)) . -15386) (undo-tree-id98 . -1) 15387) nil (26975 57988 132678 0) 0 nil])
([nil nil ((15386 . 15387)) nil (26975 57988 132677 0) 0 nil])
([nil nil ((#("L" 0 1 (face font-lock-string-face fontified t)) . -15388) (undo-tree-id97 . -1) 15389) nil (26975 57988 132676 0) 0 nil])
([nil nil ((15394 . 15395)) nil (26975 57988 132675 0) 0 nil])
([nil nil ((15395 . 15396)) nil (26975 57988 132675 0) 0 nil])
([nil nil ((15369 . 15371)) nil (26975 57988 132674 0) 0 nil])
([nil nil ((#(" " 0 1 (face font-lock-string-face fontified t)) . -15397) (undo-tree-id96 . -1) 15398) nil (26975 57988 132674 0) 0 nil])
([nil nil ((15397 . 15398)) nil (26975 57988 132671 0) 0 nil])
([nil nil ((#(":" 0 1 (face font-lock-string-face fontified t)) . -15397) (undo-tree-id95 . -1) 15398) nil (26975 57988 132670 0) 0 nil])
([nil nil ((15397 . 15398)) nil (26975 57988 132669 0) 0 nil])
([nil nil ((15398 . 15400)) nil (26975 57988 132669 0) 0 nil])
([nil nil ((#("!" 0 1 (face font-lock-string-face fontified t)) . -15398) (undo-tree-id93 . -1) (#("!" 0 1 (face font-lock-string-face fontified t)) . -15399) (undo-tree-id94 . -1) 15400) nil (26975 57988 132668 0) 0 nil])
([nil nil ((15398 . 15400)) nil (26975 57988 132667 0) 0 nil])
([nil nil ((#(":" 0 1 (face font-lock-string-face fontified t)) . -15399) (undo-tree-id91 . -1) (undo-tree-id92 . -1) 15400) nil (26975 57988 132666 0) 0 nil])
([nil nil ((15399 . 15400)) nil (26975 57988 132664 0) 0 nil])
([nil nil ((15400 . 15405)) nil (26975 57988 132664 0) 0 nil])
([nil nil ((#("M" 0 1 (face font-lock-string-face fontified t)) . -15403) (undo-tree-id89 . -1) (#("%" 0 1 (face font-lock-string-face fontified t)) . -15404) (undo-tree-id90 . -1) 15405) nil (26975 57988 132663 0) 0 nil])
([nil nil ((15403 . 15404)) nil (26975 57988 132661 0) 0 nil])
([nil nil ((15404 . 15405)) nil (26975 57988 132661 0) 0 nil])
([nil nil ((15405 . 15406)) nil (26975 57988 132661 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15413 . 15414) (nil fontified nil 15406 . 15414) (15406 . 15414)) nil (26975 57988 132660 0) 0 nil])
([nil nil ((15414 . 15415)) nil (26975 57988 132659 0) 0 nil])
([nil nil ((15708 . 15715)) nil (26975 57988 132659 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 15771 . 15772) (nil fontified nil 15771 . 15772) (nil fontified nil 15770 . 15771) (nil fontified nil 15763 . 15770) (nil fontified nil 15762 . 15763) (nil fontified nil 15725 . 15762) (nil fontified nil 15715 . 15725) (15715 . 15772)) nil (26975 57988 132658 0) 0 nil])
([nil nil ((#("PAYLOAD" 0 7 (face font-lock-string-face fontified t)) . -15746) (undo-tree-id78 . -7) (undo-tree-id79 . -2) (undo-tree-id80 . -2) (undo-tree-id81 . -2) (undo-tree-id82 . -2) (undo-tree-id83 . -2) (undo-tree-id84 . -2) (undo-tree-id85 . -7) (undo-tree-id86 . -7) (undo-tree-id87 . -7) (undo-tree-id88 . -7) 15753) nil (26975 57988 132657 0) 0 nil])
([nil nil ((#("*" 0 1 (face font-lock-string-face fontified t)) . 15746)) nil (26975 57988 132649 0) 0 nil])
([nil nil ((15746 . 15756)) nil (26975 57988 132649 0) 0 nil])
([nil nil ((15756 . 15757)) nil (26975 57988 132648 0) 0 nil])
([nil nil ((15757 . 15759)) nil (26975 57988 132648 0) 0 nil])
([nil nil ((15746 . 15752)) nil (26975 57988 132647 0) 0 nil])
([nil nil ((15752 . 15753)) nil (26975 57988 132647 0) 0 nil])
([nil nil ((#(" " 0 1 (face font-lock-string-face fontified t)) . -15768) (undo-tree-id75 . -1) (#("~" 0 1 (face font-lock-string-face fontified t)) . -15769) (undo-tree-id76 . -1) (#("A" 0 1 (face font-lock-string-face fontified t)) . -15770) (undo-tree-id77 . -1) 15771) nil (26975 57988 132646 0) 0 nil])
([nil nil ((#(" " 0 1 (face font-lock-string-face fontified t)) . -15766) (undo-tree-id73 . -1) (#(":" 0 1 (face font-lock-string-face fontified t)) . -15767) (undo-tree-id74 . -1) 15768) nil (26975 57988 132643 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -15769) (undo-tree-id10 . -1) (undo-tree-id11 . -1) (undo-tree-id12 . -1) (undo-tree-id13 . -1) (undo-tree-id14 . -1) (undo-tree-id15 . -1) (undo-tree-id16 . -1) (#("p" 0 1 (fontified t)) . -15770) (undo-tree-id17 . -1) (undo-tree-id18 . -1) (undo-tree-id19 . -1) (undo-tree-id20 . -1) (undo-tree-id21 . -1) (undo-tree-id22 . -1) (undo-tree-id23 . -1) (#("a" 0 1 (fontified t)) . -15771) (undo-tree-id24 . -1) (undo-tree-id25 . -1) (undo-tree-id26 . -1) (undo-tree-id27 . -1) (undo-tree-id28 . -1) (undo-tree-id29 . -1) (undo-tree-id30 . -1) (#("y" 0 1 (fontified t)) . -15772) (undo-tree-id31 . -1) (undo-tree-id32 . -1) (undo-tree-id33 . -1) (undo-tree-id34 . -1) (undo-tree-id35 . -1) (undo-tree-id36 . -1) (undo-tree-id37 . -1) (#("l" 0 1 (fontified t)) . -15773) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) (undo-tree-id42 . -1) (undo-tree-id43 . -1) (undo-tree-id44 . -1) (#("o" 0 1 (fontified t)) . -15774) (undo-tree-id45 . -1) (undo-tree-id46 . -1) (undo-tree-id47 . -1) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (undo-tree-id50 . -1) (undo-tree-id51 . -1) (#("a" 0 1 (fontified t)) . -15775) (undo-tree-id52 . -1) (undo-tree-id53 . -1) (undo-tree-id54 . -1) (undo-tree-id55 . -1) (undo-tree-id56 . -1) (undo-tree-id57 . -1) (undo-tree-id58 . -1) (#("d" 0 1 (fontified t)) . -15776) (undo-tree-id59 . -1) (undo-tree-id60 . -1) (undo-tree-id61 . -1) (undo-tree-id62 . -1) (undo-tree-id63 . -1) (undo-tree-id64 . -1) (undo-tree-id65 . -1) (#("*" 0 1 (fontified t rear-nonsticky t)) . -15777) (undo-tree-id66 . -1) (undo-tree-id67 . -1) (undo-tree-id68 . -1) (undo-tree-id69 . -1) (undo-tree-id70 . -1) (undo-tree-id71 . -1) (undo-tree-id72 . -1) 15778) nil (26975 57988 132638 0) 0 nil])
([nil nil ((15923 . 15927)) nil (26975 57988 132599 0) 0 nil])
([nil nil ((nil fontified nil 15981 . 15982) (nil fontified nil 15937 . 15981) (nil fontified nil 15927 . 15937) (15927 . 15982)) nil (26975 57988 132598 0) 0 nil])
([nil nil ((#("VALIDATION" 0 10 (face font-lock-string-face fontified t)) . -15965) (undo-tree-id0 . -10) (undo-tree-id1 . -2) (undo-tree-id2 . -2) (undo-tree-id3 . -2) (undo-tree-id4 . -2) (undo-tree-id5 . -2) (undo-tree-id6 . -10) (undo-tree-id7 . -10) (undo-tree-id8 . -10) (undo-tree-id9 . -10) 15975) nil (26975 57988 132596 0) 0 nil])
([nil nil ((15965 . 15971)) nil (26975 57988 132570 0) 0 nil])
([nil nil ((#("
#|
(defmethod repo-index :around (entity ctx &rest args)
  (destructuring-bind (&key filters &allow-other-keys) args
    (let* ((md   (entity-metadata entity))
           (tcol (%entity-tenant-col entity md))       ; NIL si pas de colonne tenant
           (tid  (getf ctx :tenant-id))
           (base (%ensure-filter-list filters))
           (filters*
             (if (and tcol tid (not (%has-tenant-clause-p base tcol tid)))
                 (append base (list (list '= tcol tid)))
                 base))
           ;; Remplacer :filters dans les args
           (args* (alexandria:plist-alist (lumen.utils:copy-plist args))))
      (setf (cdr (assoc :filters args*)) filters*)
      (let ((op :index))
        (repo-authorize op entity ctx)
        (apply #'call-next-method entity ctx (alexandria:alist-plist args*))))))
|#" 0 1 (fontified t) 1 3 (face font-lock-comment-delimiter-face fontified t) 3 830 (face font-lock-comment-face fontified t) 830 832 (face font-lock-comment-delimiter-face fontified t)) . 18796) (undo-tree-id3 . -832) (t 26975 57988 0 0)) nil (26976 37468 366616 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -18795) (undo-tree-id1 . -1) (undo-tree-id2 . -1) 18796) nil (26976 37468 366613 0) 0 nil])
([nil nil ((#("
;; index/show — lecture (pas de BEGIN obligatoire)
#|
(defmethod repo-index :around (entity ctx &rest args)
  (let ((op :index))
    (repo-authorize op entity ctx)
    ;; ⚠️ relayer les args !
    (apply #'call-next-method entity ctx args)))
|#" 0 1 (fontified t) 1 4 (face font-lock-comment-delimiter-face fontified t) 4 52 (face font-lock-comment-face fontified t) 52 54 (face font-lock-comment-delimiter-face fontified t) 54 198 (face font-lock-comment-face fontified t) 198 243 (face font-lock-comment-face fontified t) 243 245 (face font-lock-comment-delimiter-face fontified t)) . 18038) (undo-tree-id0 . -245)) nil (26976 37468 366607 0) 0 nil])
([nil nil ((#("(defun entity-allowed-cols (entity &key include-pk? include-tenant? include-lock?)
  \"Union des colonnes :fields + timestamps + (optionnel) pk/tenant/lock_version.
N’ajoute la colonne tenant que si elle existe effectivement sur l’entité.\"
  (let* ((md        (entity-metadata entity))
         (fields    (getf md :fields))
         (pk        (and include-pk?     (%kw-col (or (getf md :primary-key) :id))))
         (tcol      (%entity-tenant-col entity md))
         (tenantcol (and include-tenant? tcol))
         ;; lock_version seulement si déclaré ET présent côté fields
         (lock-decl (getf md :lock-version))
         (lockcol   (and include-lock?
                         lock-decl
                         (some (lambda (f) (eq (getf f :col) lock-decl)) fields)
                         (%kw-col lock-decl))))
    (remove-duplicates
     (remove nil
             (append (entity-field-cols entity)
                     (entity-timestamp-cols entity)  ; created_at/updated_at si timestamps présents
                     (list pk tenantcol lockcol)))
     :test #'eq)))" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 26 (face font-lock-function-name-face fontified t) 26 35 (fontified t) 35 39 (face font-lock-type-face fontified t) 39 85 (fontified t) 85 238 (face font-lock-doc-face fontified t) 238 242 (fontified t) 242 246 (face font-lock-keyword-face fontified t) 246 314 (fontified t) 314 321 (face font-lock-builtin-face fontified t) 321 387 (fontified t) 387 399 (face font-lock-builtin-face fontified t) 399 401 (fontified t) 401 404 (face font-lock-builtin-face fontified t) 404 518 (fontified t) 518 521 (face font-lock-comment-delimiter-face fontified t) 521 578 (face font-lock-comment-face fontified t) 578 607 (fontified t) 607 620 (face font-lock-builtin-face fontified t) 620 729 (fontified t) 729 734 (face font-lock-keyword-face fontified t) 734 735 (face font-lock-keyword-face fontified t) 735 752 (fontified t) 752 756 (face font-lock-builtin-face fontified t) 756 778 (fontified t) 778 967 (fontified t) 967 1014 (face font-lock-comment-face fontified t) 1014 1070 (fontified t) 1070 1075 (face font-lock-builtin-face fontified t) 1075 1083 (fontified t)) . 11383) (undo-tree-id6 . -26) (undo-tree-id7 . -1083) 12466 (t 26976 63397 0 0)) nil (26977 18485 927099 0) 0 nil])
([nil current ((#("
" 0 1 (fontified t)) . -11381) (undo-tree-id0 . -1) (undo-tree-id1 . -1) (undo-tree-id2 . -1) (#("
" 0 1 (fontified t)) . -11382) (undo-tree-id3 . -1) (undo-tree-id4 . -1) (undo-tree-id5 . -1) 11383) nil (26977 18485 927091 0) 0 nil])
nil
