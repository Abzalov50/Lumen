(undo-tree-save-format-version . 1)
"09557ca4d4e89fe6f17b559c7b6f393ce87a492f"
[nil nil nil nil (26996 56199 427638 0) 0 nil]
([nil nil ((#("ine-" 0 4 (face font-lock-builtin-face fontified t)) . -466) (undo-tree-id3 . -4) 470 (t 26993 53276 0 0)) nil (26996 56199 427637 0) 0 nil])
([nil nil ((#("(define-middleware tenant-from-host (req next)
  \"Résout le tenant à partir du Host (ou X-Forwarded-Host si trust-proxy) et
   renseigne ctx[:tenant-id] + ctx[:tenant-code].
   - Comportement configurable via ENV :
     TENANT_REQUIRE_HOST=1 (défaut 0) → si T et non résolu, 404.
     TENANT_ALLOW_HEADERS=1 (défaut 1) → si T, fallback X-Tenant-Code / X-Tenant-Id.\"
  (print \"IN TENANT FROM HOST\")
  (flet ((fallback-from-headers ()
           (let* ((h (req-headers req))
                  (tid (lumen.utils:alist-get h \"x-tenant-id\"))
                  (tcd (lumen.utils:alist-get h \"x-tenant-code\")))
             (cond
               (tid
                (values tid (tenant-code-by-id tid)))
               (tcd
                (let ((tid2 (tenant-id-by-code tcd)))
                  (when tid2 (values tid2 tcd))))
               (t (values nil nil))))))
    (let* ((require-host (lumen.core.config:cfg-get-bool :tenant/require-host
							 :default nil))
           (allow-hdrs   (lumen.core.config:cfg-get-bool :tenant/allow-headers
							 :default t))
           (host-raw     (%host-header req))
           (host         (normalize-host host-raw))
           (tid          (and host (tenant-id-for-host host)))
           (code         (and tid (tenant-code-by-id tid))))
      (format t \"~&HOST RAW: ~A~%HOST: ~A~%\" host-raw host)
      (format t \"~&TID: ~A~%CODE: ~A~%\" tid code)
      (multiple-value-bind (tid2 code2)
          (if (or tid code)
              (values tid code)
              (and allow-hdrs (fallback-from-headers)))
        (cond
          (tid2
           ;; installe dans le contexte
           (ctx-set! req :tenant-id   tid2)
           (when code2 (ctx-set! req :tenant-code code2))
           (funcall next req))
          (require-host
           ;; exigeant → 404
           (make-instance 'lumen.core.http:response
                          :status 404
                          :headers '((\"Content-Type\" . \"application/json; charset=utf-8\")
                                     (\"Cache-Control\" . \"no-store\"))
                          :body \"{\\\"error\\\":{\\\"type\\\":\\\"tenant\\\",\\\"message\\\":\\\"unknown tenant for host\\\"}}\"))
          (t
           ;; permissif → on laisse passer (ex: /health), sans installer de tenant
           (funcall next req)))))))
" 0 1 (fontified t) 1 18 (face font-lock-keyword-face fontified t) 18 49 (fontified t) 49 190 (face font-lock-string-face fontified t) 190 215 (face font-lock-string-face fontified t) 215 365 (face font-lock-string-face fontified t) 365 375 (fontified t) 375 396 (face font-lock-string-face fontified t) 396 401 (fontified t) 401 405 (face font-lock-keyword-face fontified t) 405 445 (fontified t) 445 449 (face font-lock-keyword-face fontified t) 449 521 (fontified t) 521 534 (face font-lock-string-face fontified t) 534 585 (fontified t) 585 600 (face font-lock-string-face fontified t) 600 618 (fontified t) 618 622 (face font-lock-keyword-face fontified t) 622 671 (fontified t) 671 697 (fontified t) 697 734 (fontified t) 734 737 (face font-lock-keyword-face fontified t) 737 790 (fontified t) 790 794 (face font-lock-keyword-face fontified t) 794 866 (fontified t) 866 870 (face font-lock-keyword-face fontified t) 870 918 (fontified t) 918 938 (face font-lock-builtin-face fontified t) 938 947 (fontified t) 947 955 (face font-lock-builtin-face fontified t) 955 1019 (fontified t) 1019 1040 (face font-lock-builtin-face fontified t) 1040 1049 (fontified t) 1049 1057 (face font-lock-builtin-face fontified t) 1057 1299 (fontified t) 1299 1327 (face font-lock-string-face fontified t) 1327 1359 (fontified t) 1359 1382 (face font-lock-string-face fontified t) 1382 1400 (fontified t) 1400 1419 (face font-lock-keyword-face fontified t) 1419 1444 (fontified t) 1444 1446 (face font-lock-keyword-face fontified t) 1446 1558 (fontified t) 1558 1562 (face font-lock-keyword-face fontified t) 1562 1590 (fontified t) 1590 1593 (face font-lock-comment-delimiter-face fontified t) 1593 1619 (face font-lock-comment-face fontified t) 1619 1644 (fontified t) 1644 1654 (face font-lock-builtin-face fontified t) 1654 1675 (fontified t) 1675 1679 (face font-lock-keyword-face fontified t) 1679 1700 (fontified t) 1700 1712 (face font-lock-builtin-face fontified t) 1712 1715 (fontified t) 1715 1721 (fontified t) 1721 1787 (fontified t) 1787 1790 (face font-lock-comment-delimiter-face fontified t) 1790 1805 (face font-lock-comment-face fontified t) 1805 1883 (fontified t) 1883 1890 (face font-lock-builtin-face fontified t) 1890 1921 (fontified t) 1921 1929 (face font-lock-builtin-face fontified t) 1929 1933 (fontified t) 1933 1947 (face font-lock-string-face fontified t) 1947 1950 (fontified t) 1950 1983 (face font-lock-string-face fontified t) 1983 2023 (fontified t) 2023 2038 (face font-lock-string-face fontified t) 2038 2041 (fontified t) 2041 2051 (face font-lock-string-face fontified t) 2051 2080 (fontified t) 2080 2085 (face font-lock-builtin-face fontified t) 2085 2086 (fontified t) 2086 2161 (face font-lock-string-face fontified t) 2161 2188 (fontified t) 2188 2191 (face font-lock-comment-delimiter-face fontified t) 2191 2197 (face font-lock-comment-face fontified t) 2197 2260 (face font-lock-comment-face fontified t) 2260 2296 (fontified t)) . -1307) (undo-tree-id1 . -2296) (undo-tree-id2 . -1222) 3603) nil (26996 56199 427623 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4029 . 4030) (nil fontified nil 1307 . 4030) (1307 . 4030)) nil (26996 56199 427620 0) 0 nil])
([nil nil ((#("Middleware (drop-in): tenant-from-host" 0 38 (face font-lock-comment-face fontified t)) . -1185) (undo-tree-id0 . -38) 1223) nil (26996 56199 427618 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1211 . 1212) (nil fontified nil 1185 . 1212) (1185 . 1212)) nil (26996 56199 427600 0) 0 nil])
([nil nil ((4019 . 4020)) nil (26996 56199 427596 0) 0 nil])
([nil nil ((#("lumen.core.tenant" 0 17 (fontified t)) . -1882) (undo-tree-id3 . -17) 1899 (t 26996 56199 0 0)) nil (26996 56668 948847 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1899 . 1900) (nil fontified nil 1882 . 1900) (1882 . 1900)) nil (26996 56668 948845 0) 0 nil])
([nil nil ((#(":" 0 1 (face font-lock-builtin-face fontified t)) . -1882) (undo-tree-id0 . -1) (undo-tree-id1 . -1) (undo-tree-id2 . -1) 1883) nil (26996 56668 948844 0) 0 nil])
([nil nil ((#("lumen.core.tenant" 0 17 (fontified t)) . -2833) (2850 . 2867) (#("lumen.core.tenant" 0 17 (fontified t)) . -2397) (2414 . 2431) (#("lumen.core.tenant" 0 17 (fontified t)) . -2317) (2334 . 2351)) nil (26996 56821 551324 0) 0 nil])
([nil current ((#("(defun %maybe-real-host-from-proxy (req)
  \"Si un mw 'trust-proxy' alimente ctx [:real-host], l’utiliser en priorité.\"
  (or (ctx-get req :real-host)
      (cdr (assoc \"x-forwarded-host\" (req-headers req) :test #'string-equal))
      (cdr (assoc \"x-real-host\"      (req-headers req) :test #'string-equal))))

(defun %host-header (req)
  (or (%maybe-real-host-from-proxy req)
      (cdr (assoc \"host\" (req-headers req) :test #'string-equal))))

;;;; -----------------------------------------------------------------------------
;;;; TENANT FROM HOST MIDDLEWARE
;;;; -----------------------------------------------------------------------------
(defun %host-header (req)
  (let ((h (lumen.core.http:req-headers req)))
    (or (cdr (assoc \"x-forwarded-host\" h :test #'string-equal))
        (cdr (assoc \"x-real-host\"      h :test #'string-equal))
        (cdr (assoc \"host\"             h :test #'string-equal)))))

(defun %normalize-host (raw)
  (when raw
    (let ((pos (position #\\: raw)))
      (if pos (subseq raw 0 pos) raw))))

(defmiddleware tenant-middleware
    ((require-host :initarg :require-host :initform nil)
     (allow-headers :initarg :allow-headers :initform t)
     (resolver-fn :initarg :resolver-fn :initform 'lumen.data.tenant:tenant-id-for-host))
    (req next)
  
  (with-slots (require-host allow-headers resolver-fn) mw
    (labels ((fallback-from-headers ()
               (let* ((h (lumen.core.http:req-headers req))
                      (tid (cdr (assoc \"x-tenant-id\" h :test #'string-equal)))
                      (tcd (cdr (assoc \"x-tenant-code\" h :test #'string-equal))))
                 (cond
                   (tid (values tid (lumen.data.tenant:tenant-code-by-id tid)))
                   (tcd (let ((tid2 (lumen.data.tenant:tenant-id-by-code tcd)))
                          (when tid2 (values tid2 tcd))))
                   (t (values nil nil))))))
      
      (let* ((host-raw (%host-header req))
             (host (%normalize-host host-raw))
             ;; On utilise funcall pour permettre l'injection de mock en test
             (tid (and host (handler-case (funcall resolver-fn host) (error () nil))))
             (code (and tid (lumen.data.tenant:tenant-code-by-id tid))))
        
        (multiple-value-bind (tid2 code2)
            (if tid
                (values tid code)
                (and allow-headers (fallback-from-headers)))
          
          (cond
            ;; Cas Succès : Tenant Trouvé
            (tid2
             (lumen.core.http:ctx-set! req :tenant-id tid2)
             (when code2 (lumen.core.http:ctx-set! req :tenant-code code2))
             (funcall next req))
            
            ;; Cas Échec Strict : 404
            (require-host
             (lumen.core.http:respond-json 
              '((:error . ((:type . \"tenant\") (:message . \"Unknown tenant for host\")))) 
              :status 404))
            
            ;; Cas Échec Permissif : On continue (Mode \"Public\" ou \"Admin global\")
            (t 
             (funcall next req))))))))

;;; Factory Helper (Optionnel)
(defun tenant-auto ()
  \"Configure le middleware Tenant via ENV.\"
  (make-instance 'tenant-middleware
                 :require-host (lumen.core.config:cfg-get-bool :tenant/require-host :default nil)
                 :allow-headers (lumen.core.config:cfg-get-bool :tenant/allow-headers :default t)))
" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 34 (face font-lock-function-name-face fontified t) 34 43 (fontified t) 43 118 (face font-lock-doc-face fontified t) 118 138 (fontified t) 138 148 (face font-lock-builtin-face fontified t) 148 168 (fontified t) 168 186 (face font-lock-string-face fontified t) 186 205 (fontified t) 205 210 (face font-lock-builtin-face fontified t) 210 246 (fontified t) 246 259 (face font-lock-string-face fontified t) 259 283 (fontified t) 283 288 (face font-lock-builtin-face fontified t) 288 310 (fontified t) 310 315 (face font-lock-keyword-face fontified t) 315 316 (fontified t) 316 328 (face font-lock-function-name-face fontified t) 328 393 (fontified t) 393 399 (face font-lock-string-face fontified t) 399 418 (fontified t) 418 423 (face font-lock-builtin-face fontified t) 423 444 (fontified t) 444 449 (face font-lock-comment-delimiter-face fontified t) 449 527 (face font-lock-comment-face fontified t) 527 532 (face font-lock-comment-delimiter-face fontified t) 532 560 (face font-lock-comment-face fontified t) 560 565 (face font-lock-comment-delimiter-face fontified t) 565 643 (face font-lock-comment-face fontified t) 643 644 (fontified t) 644 649 (face font-lock-keyword-face fontified t) 649 650 (fontified t) 650 662 (face font-lock-function-name-face fontified t) 662 672 (fontified t) 672 675 (face font-lock-keyword-face fontified t) 675 736 (fontified t) 736 754 (face font-lock-string-face fontified t) 754 757 (fontified t) 757 762 (face font-lock-builtin-face fontified t) 762 800 (fontified t) 800 813 (face font-lock-string-face fontified t) 813 821 (fontified t) 821 826 (face font-lock-builtin-face fontified t) 826 848 (fontified t) 848 864 (fontified t) 864 870 (face font-lock-string-face fontified t) 870 885 (fontified t) 885 890 (face font-lock-builtin-face fontified t) 890 911 (fontified t) 911 913 (fontified t) 913 918 (face font-lock-keyword-face fontified t) 918 919 (fontified t) 919 934 (face font-lock-function-name-face fontified t) 934 944 (fontified t) 944 948 (face font-lock-keyword-face fontified t) 948 958 (fontified t) 958 961 (face font-lock-keyword-face fontified t) 961 996 (fontified t) 996 998 (face font-lock-keyword-face fontified t) 998 1031 (fontified t) 1031 1083 (fontified t) 1083 1091 (face font-lock-builtin-face fontified t) 1091 1092 (fontified t) 1092 1105 (face font-lock-builtin-face fontified t) 1105 1106 (fontified t) 1106 1115 (face font-lock-builtin-face fontified t) 1115 1141 (fontified t) 1141 1149 (face font-lock-builtin-face fontified t) 1149 1150 (fontified t) 1150 1164 (face font-lock-builtin-face fontified t) 1164 1165 (fontified t) 1165 1174 (face font-lock-builtin-face fontified t) 1174 1178 (fontified t) 1178 1196 (fontified t) 1196 1204 (face font-lock-builtin-face fontified t) 1204 1205 (fontified t) 1205 1217 (face font-lock-builtin-face fontified t) 1217 1218 (fontified t) 1218 1227 (face font-lock-builtin-face fontified t) 1227 1229 (fontified t) 1229 1245 (fontified t) 1245 1246 (rear-nonsticky t fontified t) 1246 1265 (fontified t) 1265 1268 (fontified t) 1268 1289 (fontified t) 1289 1299 (face font-lock-keyword-face fontified t) 1299 1349 (fontified t) 1349 1355 (face font-lock-keyword-face fontified t) 1355 1399 (fontified t) 1399 1403 (face font-lock-keyword-face fontified t) 1403 1482 (fontified t) 1482 1495 (face font-lock-string-face fontified t) 1495 1498 (fontified t) 1498 1500 (face font-lock-builtin-face fontified t) 1500 1503 (face font-lock-builtin-face fontified t) 1503 1522 (fontified t) 1522 1561 (fontified t) 1561 1576 (face font-lock-string-face fontified t) 1576 1579 (fontified t) 1579 1584 (face font-lock-builtin-face fontified t) 1584 1622 (fontified t) 1622 1626 (face font-lock-keyword-face fontified t) 1626 1627 (fontified t) 1627 1664 (fontified t) 1664 1681 (fontified t) 1681 1707 (fontified t) 1707 1732 (fontified t) 1732 1735 (face font-lock-keyword-face fontified t) 1735 1744 (fontified t) 1744 1761 (fontified t) 1761 1787 (fontified t) 1787 1814 (fontified t) 1814 1818 (face font-lock-keyword-face fontified t) 1818 1903 (fontified t) 1903 1907 (face font-lock-keyword-face fontified t) 1907 1999 (fontified t) 1999 2002 (face font-lock-comment-delimiter-face fontified t) 2002 2064 (face font-lock-comment-face fontified t) 2064 2093 (fontified t) 2093 2105 (face font-lock-keyword-face fontified t) 2105 2134 (fontified t) 2134 2139 (face font-lock-warning-face fontified t) 2139 2151 (fontified t) 2151 2180 (fontified t) 2180 2197 (fontified t) 2197 2224 (fontified t) 2224 2242 (fontified t) 2242 2261 (face font-lock-keyword-face fontified t) 2261 2288 (fontified t) 2288 2290 (face font-lock-keyword-face fontified t) 2290 2411 (fontified t) 2411 2412 (fontified t) 2412 2416 (face font-lock-keyword-face fontified t) 2416 2417 (fontified t) 2417 2429 (fontified t) 2429 2432 (face font-lock-comment-delimiter-face fontified t) 2432 2459 (face font-lock-comment-face fontified t) 2459 2520 (fontified t) 2520 2530 (face font-lock-builtin-face fontified t) 2530 2551 (fontified t) 2551 2555 (face font-lock-keyword-face fontified t) 2555 2592 (fontified t) 2592 2604 (face font-lock-builtin-face fontified t) 2604 2613 (fontified t) 2613 2671 (fontified t) 2671 2674 (face font-lock-comment-delimiter-face fontified t) 2674 2697 (face font-lock-comment-face fontified t) 2697 2768 (fontified t) 2768 2784 (fontified t) 2784 2790 (face font-lock-builtin-face fontified t) 2790 2795 (fontified t) 2795 2800 (face font-lock-builtin-face fontified t) 2800 2803 (fontified t) 2803 2811 (face font-lock-string-face fontified t) 2811 2814 (fontified t) 2814 2822 (face font-lock-builtin-face fontified t) 2822 2825 (fontified t) 2825 2850 (face font-lock-string-face fontified t) 2850 2856 (fontified t) 2856 2870 (fontified t) 2870 2877 (face font-lock-builtin-face fontified t) 2877 2909 (fontified t) 2909 2912 (face font-lock-comment-delimiter-face fontified t) 2912 2980 (face font-lock-comment-face fontified t) 2980 3034 (fontified t) 3034 3036 (fontified t) 3036 3040 (face font-lock-comment-delimiter-face fontified t) 3040 3067 (face font-lock-comment-face fontified t) 3067 3068 (fontified t) 3068 3073 (face font-lock-keyword-face fontified t) 3073 3074 (fontified t) 3074 3085 (face font-lock-function-name-face fontified t) 3085 3091 (fontified t) 3091 3127 (face font-lock-doc-face fontified t) 3127 3132 (face font-lock-doc-face fontified t) 3132 3133 (fontified t) 3133 3186 (fontified t) 3186 3199 (face font-lock-builtin-face fontified t) 3199 3232 (fontified t) 3232 3252 (face font-lock-builtin-face fontified t) 3252 3253 (fontified t) 3253 3261 (face font-lock-builtin-face fontified t) 3261 3284 (fontified t) 3284 3298 (face font-lock-builtin-face fontified t) 3298 3331 (fontified t) 3331 3352 (face font-lock-builtin-face fontified t) 3352 3353 (fontified t) 3353 3361 (face font-lock-builtin-face fontified t) 3361 3367 (fontified t)) . 653) (undo-tree-id28 . -3367) (undo-tree-id29 . -2646) (undo-tree-id30 . -3367) (undo-tree-id31 . -3367) (undo-tree-id32 . -3036) (undo-tree-id33 . -3367) 4020 (t 26996 56668 0 0)) nil (26996 56952 178514 0) 0 nil] [nil nil ((#("(defun %maybe-real-host-from-proxy (req)
  \"Si un mw 'trust-proxy' alimente ctx [:real-host], l’utiliser en priorité.\"
  (or (ctx-get req :real-host)
      (cdr (assoc \"x-forwarded-host\" (req-headers req) :test #'string-equal))
      (cdr (assoc \"x-real-host\"      (req-headers req) :test #'string-equal))))

(defun %host-header (req)
  (or (%maybe-real-host-from-proxy req)
      (cdr (assoc \"host\" (req-headers req) :test #'string-equal))))

;;;; -----------------------------------------------------------------------------
;;;; TENANT FROM HOST MIDDLEWARE
;;;; -----------------------------------------------------------------------------
(defun %host-header (req)
  (let ((h (lumen.core.http:req-headers req)))
    (or (cdr (assoc \"x-forwarded-host\" h :test #'string-equal))
        (cdr (assoc \"x-real-host\"      h :test #'string-equal))
        (cdr (assoc \"host\"             h :test #'string-equal)))))

(defun %normalize-host (raw)
  (when raw
    (let ((pos (position #\\: raw)))
      (if pos (subseq raw 0 pos) raw))))

(defmiddleware tenant-middleware
    ((require-host :initarg :require-host :initform nil)
     (allow-headers :initarg :allow-headers :initform t)
     (resolver-fn :initarg :resolver-fn :initform 'lumen.data.tenant:tenant-id-for-host))
    (req next)
  
  (with-slots (require-host allow-headers resolver-fn) mw
    (labels ((fallback-from-headers ()
               (let* ((h (lumen.core.http:req-headers req))
                      (tid (cdr (assoc \"x-tenant-id\" h :test #'string-equal)))
                      (tcd (cdr (assoc \"x-tenant-code\" h :test #'string-equal))))
                 (cond
                   (tid (values tid (lumen.data.tenant:tenant-code-by-id tid)))
                   (tcd (let ((tid2 (lumen.data.tenant:tenant-id-by-code tcd)))
                          (when tid2 (values tid2 tcd))))
                   (t (values nil nil))))))
      
      (let* ((host-raw (%host-header req))
             (host (%normalize-host host-raw))
             ;; On utilise funcall pour permettre l'injection de mock en test
             (tid (and host (handler-case (funcall resolver-fn host) (error () nil))))
             (code (and tid (lumen.data.tenant:tenant-code-by-id tid))))
        
        (multiple-value-bind (tid2 code2)
            (if tid
                (values tid code)
                (and allow-headers (fallback-from-headers)))
          
          (cond
            ;; Cas Succès : Tenant Trouvé
            (tid2
             (lumen.core.http:ctx-set! req :tenant-id tid2)
             (when code2 (lumen.core.http:ctx-set! req :tenant-code code2))
             (funcall next req))
            
            ;; Cas Échec Strict : 404
            (require-host
             (lumen.core.http:respond-json 
              '((:error . ((:type . \"tenant\") (:message . \"Unknown tenant for host\")))) 
              :status 404))
            
            ;; Cas Échec Permissif : On continue (Mode \"Public\" ou \"Admin global\")
            (t 
             (funcall next req))))))))

;;; Factory Helper (Optionnel)
(defun tenant-auto ()
  \"Configure le middleware Tenant via ENV.\"
  (make-instance 'tenant-middleware
                 :require-host (lumen.core.config:cfg-get-bool :tenant/require-host :default nil)
                 :allow-headers (lumen.core.config:cfg-get-bool :tenant/allow-headers :default t)))
" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 34 (face font-lock-function-name-face fontified t) 34 43 (fontified t) 43 118 (face font-lock-doc-face fontified t) 118 138 (fontified t) 138 148 (face font-lock-builtin-face fontified t) 148 168 (fontified t) 168 186 (face font-lock-string-face fontified t) 186 205 (fontified t) 205 210 (face font-lock-builtin-face fontified t) 210 246 (fontified t) 246 259 (face font-lock-string-face fontified t) 259 283 (fontified t) 283 288 (face font-lock-builtin-face fontified t) 288 310 (fontified t) 310 315 (face font-lock-keyword-face fontified t) 315 316 (fontified t) 316 328 (face font-lock-function-name-face fontified t) 328 393 (fontified t) 393 399 (face font-lock-string-face fontified t) 399 418 (fontified t) 418 423 (face font-lock-builtin-face fontified t) 423 444 (fontified t) 444 449 (face font-lock-comment-delimiter-face fontified t) 449 527 (face font-lock-comment-face fontified t) 527 532 (face font-lock-comment-delimiter-face fontified t) 532 560 (face font-lock-comment-face fontified t) 560 565 (face font-lock-comment-delimiter-face fontified t) 565 643 (face font-lock-comment-face fontified t) 643 644 (fontified t) 644 649 (face font-lock-keyword-face fontified t) 649 650 (fontified t) 650 662 (face font-lock-function-name-face fontified t) 662 672 (fontified t) 672 675 (face font-lock-keyword-face fontified t) 675 736 (fontified t) 736 754 (face font-lock-string-face fontified t) 754 757 (fontified t) 757 762 (face font-lock-builtin-face fontified t) 762 800 (fontified t) 800 813 (face font-lock-string-face fontified t) 813 821 (fontified t) 821 826 (face font-lock-builtin-face fontified t) 826 848 (fontified t) 848 864 (fontified t) 864 870 (face font-lock-string-face fontified t) 870 885 (fontified t) 885 890 (face font-lock-builtin-face fontified t) 890 911 (fontified t) 911 913 (fontified t) 913 918 (face font-lock-keyword-face fontified t) 918 919 (fontified t) 919 934 (face font-lock-function-name-face fontified t) 934 944 (fontified t) 944 948 (face font-lock-keyword-face fontified t) 948 958 (fontified t) 958 961 (face font-lock-keyword-face fontified t) 961 996 (fontified t) 996 998 (face font-lock-keyword-face fontified t) 998 1031 (fontified t) 1031 1083 (fontified t) 1083 1091 (face font-lock-builtin-face fontified t) 1091 1092 (fontified t) 1092 1105 (face font-lock-builtin-face fontified t) 1105 1106 (fontified t) 1106 1115 (face font-lock-builtin-face fontified t) 1115 1141 (fontified t) 1141 1149 (face font-lock-builtin-face fontified t) 1149 1150 (fontified t) 1150 1164 (face font-lock-builtin-face fontified t) 1164 1165 (fontified t) 1165 1174 (face font-lock-builtin-face fontified t) 1174 1178 (fontified t) 1178 1196 (fontified t) 1196 1204 (face font-lock-builtin-face fontified t) 1204 1205 (fontified t) 1205 1217 (face font-lock-builtin-face fontified t) 1217 1218 (fontified t) 1218 1227 (face font-lock-builtin-face fontified t) 1227 1229 (fontified t) 1229 1245 (fontified t) 1245 1246 (rear-nonsticky t fontified t) 1246 1265 (fontified t) 1265 1268 (fontified t) 1268 1289 (fontified t) 1289 1299 (face font-lock-keyword-face fontified t) 1299 1349 (fontified t) 1349 1355 (face font-lock-keyword-face fontified t) 1355 1399 (fontified t) 1399 1403 (face font-lock-keyword-face fontified t) 1403 1482 (fontified t) 1482 1495 (face font-lock-string-face fontified t) 1495 1498 (fontified t) 1498 1503 (face font-lock-builtin-face fontified t) 1503 1561 (fontified t) 1561 1576 (face font-lock-string-face fontified t) 1576 1579 (fontified t) 1579 1584 (face font-lock-builtin-face fontified t) 1584 1622 (fontified t) 1622 1626 (face font-lock-keyword-face fontified t) 1626 1627 (fontified t) 1627 1664 (fontified t) 1664 1681 (fontified t) 1681 1707 (fontified t) 1707 1732 (fontified t) 1732 1735 (face font-lock-keyword-face fontified t) 1735 1744 (fontified t) 1744 1761 (fontified t) 1761 1787 (fontified t) 1787 1814 (fontified t) 1814 1818 (face font-lock-keyword-face fontified t) 1818 1903 (fontified t) 1903 1907 (face font-lock-keyword-face fontified t) 1907 1999 (fontified t) 1999 2002 (face font-lock-comment-delimiter-face fontified t) 2002 2064 (face font-lock-comment-face fontified t) 2064 2093 (fontified t) 2093 2105 (face font-lock-keyword-face fontified t) 2105 2134 (fontified t) 2134 2139 (face font-lock-warning-face fontified t) 2139 2151 (fontified t) 2151 2180 (fontified t) 2180 2197 (fontified t) 2197 2224 (fontified t) 2224 2242 (fontified t) 2242 2261 (face font-lock-keyword-face fontified t) 2261 2288 (fontified t) 2288 2290 (face font-lock-keyword-face fontified t) 2290 2411 (fontified t) 2411 2412 (fontified t) 2412 2416 (face font-lock-keyword-face fontified t) 2416 2417 (fontified t) 2417 2429 (fontified t) 2429 2432 (face font-lock-comment-delimiter-face fontified t) 2432 2459 (face font-lock-comment-face fontified t) 2459 2520 (fontified t) 2520 2530 (face font-lock-builtin-face fontified t) 2530 2551 (fontified t) 2551 2555 (face font-lock-keyword-face fontified t) 2555 2592 (fontified t) 2592 2604 (face font-lock-builtin-face fontified t) 2604 2671 (fontified t) 2671 2674 (face font-lock-comment-delimiter-face fontified t) 2674 2697 (face font-lock-comment-face fontified t) 2697 2768 (fontified t) 2768 2784 (fontified t) 2784 2790 (face font-lock-builtin-face fontified t) 2790 2795 (fontified t) 2795 2800 (face font-lock-builtin-face fontified t) 2800 2803 (fontified t) 2803 2811 (face font-lock-string-face fontified t) 2811 2814 (fontified t) 2814 2822 (face font-lock-builtin-face fontified t) 2822 2825 (fontified t) 2825 2850 (face font-lock-string-face fontified t) 2850 2856 (fontified t) 2856 2870 (fontified t) 2870 2877 (face font-lock-builtin-face fontified t) 2877 2909 (fontified t) 2909 2912 (face font-lock-comment-delimiter-face fontified t) 2912 2980 (face font-lock-comment-face fontified t) 2980 3034 (fontified t) 3034 3036 (fontified t) 3036 3040 (face font-lock-comment-delimiter-face fontified t) 3040 3067 (face font-lock-comment-face fontified t) 3067 3068 (fontified t) 3068 3073 (face font-lock-keyword-face fontified t) 3073 3074 (fontified t) 3074 3085 (face font-lock-function-name-face fontified t) 3085 3091 (fontified t) 3091 3127 (face font-lock-doc-face fontified t) 3127 3132 (face font-lock-doc-face fontified t) 3132 3133 (fontified t) 3133 3186 (fontified t) 3186 3199 (face font-lock-builtin-face fontified t) 3199 3232 (fontified t) 3232 3252 (face font-lock-builtin-face fontified t) 3252 3253 (fontified t) 3253 3261 (face font-lock-builtin-face fontified t) 3261 3284 (fontified t) 3284 3298 (face font-lock-builtin-face fontified t) 3298 3331 (fontified t) 3331 3352 (face font-lock-builtin-face fontified t) 3352 3353 (fontified t) 3353 3361 (face font-lock-builtin-face fontified t) 3361 3367 (fontified t)) . 653) (undo-tree-id4 . -3169) (undo-tree-id5 . -953) (undo-tree-id6 . -3367) 4020 (t 26996 56668 0 0)) ((653 . 4020)) (26996 56821 550638 0) 0 nil])
([nil nil ((#("(in-package :cl)

(defpackage :lumen.data.mws
  (:use :cl :alexandria)
  (:import-from :lumen.core.config :cfg-get :cfg-get-bool :cfg-get-int)
  (:import-from :lumen.core.http :request :response :resp-body :resp-status
   :resp-headers :respond-500 :respond-404 :req-query :req-headers :ctx-get :ctx-set!)
  (:import-from :lumen.utils :-> :->> :str-prefix-p :ensure-header :parse-http-date
		:format-http-date :alist-get)
  (:import-from :lumen.core.middleware :defmiddleware)
  (:import-from :lumen.data.tenant :tenant-code-by-id :tenant-id-for-host
   :tenant-id-by-code :normalize-host)
  (:export :tenant-from-host))

(in-package :lumen.data.mws)

" 0 1 (fontified t) 1 11 (face font-lock-keyword-face fontified t) 11 12 (fontified t) 12 15 (face font-lock-builtin-face fontified t) 15 19 (fontified t) 19 29 (face font-lock-keyword-face fontified t) 29 30 (fontified t) 30 45 (face font-lock-type-face fontified t) 45 49 (fontified t) 49 53 (face font-lock-builtin-face fontified t) 53 54 (fontified t) 54 57 (face font-lock-builtin-face fontified t) 57 58 (fontified t) 58 69 (face font-lock-builtin-face fontified t) 69 74 (fontified t) 74 86 (face font-lock-builtin-face fontified t) 86 87 (fontified t) 87 105 (face font-lock-builtin-face fontified t) 105 106 (fontified t) 106 114 (face font-lock-builtin-face fontified t) 114 115 (fontified t) 115 128 (face font-lock-builtin-face fontified t) 128 129 (fontified t) 129 141 (face font-lock-builtin-face fontified t) 141 146 (fontified t) 146 158 (face font-lock-builtin-face fontified t) 158 159 (fontified t) 159 175 (face font-lock-builtin-face fontified t) 175 176 (fontified t) 176 184 (face font-lock-builtin-face fontified t) 184 185 (fontified t) 185 194 (face font-lock-builtin-face fontified t) 194 195 (fontified t) 195 205 (face font-lock-builtin-face fontified t) 205 206 (fontified t) 206 218 (face font-lock-builtin-face fontified t) 218 222 (fontified t) 222 235 (face font-lock-builtin-face fontified t) 235 236 (fontified t) 236 248 (face font-lock-builtin-face fontified t) 248 249 (fontified t) 249 261 (face font-lock-builtin-face fontified t) 261 262 (fontified t) 262 272 (face font-lock-builtin-face fontified t) 272 273 (fontified t) 273 285 (face font-lock-builtin-face fontified t) 285 286 (fontified t) 286 294 (face font-lock-builtin-face fontified t) 294 295 (fontified t) 295 304 (face font-lock-builtin-face fontified t) 304 309 (fontified t) 309 321 (face font-lock-builtin-face fontified t) 321 322 (fontified t) 322 334 (face font-lock-builtin-face fontified t) 334 335 (fontified t) 335 338 (face font-lock-builtin-face fontified t) 338 339 (fontified t) 339 343 (face font-lock-builtin-face fontified t) 343 344 (fontified t) 344 357 (face font-lock-builtin-face fontified t) 357 358 (fontified t) 358 372 (face font-lock-builtin-face fontified t) 372 373 (fontified t) 373 389 (face font-lock-builtin-face fontified t) 389 392 (fontified t) 392 409 (face font-lock-builtin-face fontified t) 409 410 (fontified t) 410 420 (face font-lock-builtin-face fontified t) 420 425 (fontified t) 425 437 (face font-lock-builtin-face fontified t) 437 438 (fontified t) 438 460 (face font-lock-builtin-face fontified t) 460 461 (fontified t) 461 475 (face font-lock-builtin-face fontified t) 475 480 (fontified t) 480 492 (face font-lock-builtin-face fontified t) 492 493 (fontified t) 493 511 (face font-lock-builtin-face fontified t) 511 512 (fontified t) 512 530 (face font-lock-builtin-face fontified t) 530 531 (fontified t) 531 550 (face font-lock-builtin-face fontified t) 550 554 (fontified t) 554 572 (face font-lock-builtin-face fontified t) 572 573 (fontified t) 573 588 (face font-lock-builtin-face fontified t) 588 593 (fontified t) 593 600 (face font-lock-builtin-face fontified t) 600 601 (fontified t) 601 618 (face font-lock-builtin-face fontified t) 618 623 (fontified t) 623 633 (face font-lock-keyword-face fontified t) 633 634 (fontified t) 634 649 (face font-lock-builtin-face fontified t) 649 652 (fontified t)) . 1) (undo-tree-id7 . -652) (undo-tree-id8 . -650) (undo-tree-id9 . -499) (undo-tree-id10 . -493) (undo-tree-id11 . -589) (undo-tree-id12 . -652) (undo-tree-id13 . -652) (undo-tree-id15 . -652) (undo-tree-id17 . -652) (undo-tree-id19 . -652) (undo-tree-id21 . -652) (undo-tree-id23 . -652) (undo-tree-id25 . -652) (undo-tree-id26 . -652) (undo-tree-id27 . -652)) ((1 . 653) (t 26996 56937 0 0)) (26996 56937 594072 0) 0 nil])
nil
nil
