(undo-tree-save-format-version . 1)
"bb5cbd19d1c07b085c9a9a57399c73979254dd33"
[nil nil nil nil (26802 48488 26815 0) 0 nil]
([nil nil ((nil rear-nonsticky nil 5276 . 5277) (nil fontified nil 1 . 5277) (1 . 5277) (t 26802 48488 0 0)) nil (26802 54107 710978 0) 0 nil])
([nil nil ((#(";;;; lumen/data/errors.lisp" 0 5 (face font-lock-comment-delimiter-face fontified t) 5 27 (face font-lock-comment-face fontified t)) . 1)) nil (26802 54107 710976 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 1)) nil (26802 54107 710975 0) 0 nil])
([nil nil ((22 . 23)) nil (26802 54107 710974 0) 0 nil])
([nil nil ((351 . 352)) nil (26802 54107 710970 0) 0 nil])
([nil nil ((#("(defun map-db-error (condition)
  \"Retourne **un objet** condition Lumen (ne le signale pas).\"
  (labels ((mk (class &key msg constraint sqlstate)
             (make-condition class
                             :message   (or msg (%coerce-message condition))
                             :constraint constraint
                             :sqlstate  sqlstate)))
    (let* ((msg (%coerce-message condition))
           (st  (%maybe-sqlstate condition)))
      (cond
        ;; --- Constraint violations (SQLSTATE 23xxx)
        ((typep condition 'cl-postgres-error:unique-violation)
         (mk 'db-constraint-violation :constraint :unique :sqlstate \"23505\" :msg msg))
        ((typep condition 'cl-postgres-error:not-null-violation)
         (mk 'db-constraint-violation :constraint :not-null :sqlstate \"23502\" :msg msg))
        ((typep condition 'cl-postgres-error:foreign-key-violation)
         (mk 'db-constraint-violation :constraint :foreign-key :sqlstate \"23503\" :msg msg))
        ((typep condition 'cl-postgres-error:check-violation)
         (mk 'db-constraint-violation :constraint :check :sqlstate \"23514\" :msg msg))

        ;; --- Concurrency / retryable
        ((typep condition 'cl-postgres-error:deadlock-detected)
         (mk 'db-deadlock-retryable :sqlstate \"40P01\" :msg msg))
        ((typep condition 'cl-postgres-error:serialization-failure)
         (mk 'db-serialization-retryable :sqlstate \"40001\" :msg msg))
        ((typep condition 'cl-postgres-error:lock-not-available)
         (mk 'db-deadlock-retryable :sqlstate \"55P03\" :msg msg))

        ;; --- Timeouts / cancellations / admin
        ((typep condition 'cl-postgres-error:query-canceled)
         (mk 'db-timeout :sqlstate \"57014\" :msg msg))
        ((typep condition 'cl-postgres-error:admin-shutdown)
         (mk 'db-timeout :sqlstate \"57P01\" :msg msg))
        ((typep condition 'postmodern:database-connection-error)
         (mk 'db-timeout :msg msg))  ;; panne réseau → retry possible selon contexte

        ;; --- Fallback
        (t (make-condition 'db-error :message msg :sqlstate st))))))
" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 19 (face font-lock-function-name-face fontified t) 19 34 (fontified t) 34 94 (face font-lock-doc-face fontified t) 94 98 (fontified t) 98 104 (face font-lock-keyword-face fontified t) 104 117 (fontified t) 117 121 (face font-lock-type-face fontified t) 121 211 (fontified t) 211 219 (face font-lock-builtin-face fontified t) 219 288 (fontified t) 288 290 (face font-lock-builtin-face fontified t) 290 299 (face font-lock-builtin-face fontified t) 299 311 (fontified t) 311 340 (fontified t) 340 349 (face font-lock-builtin-face fontified t) 349 368 (fontified t) 368 372 (face font-lock-keyword-face fontified t) 372 461 (fontified t) 461 465 (face font-lock-keyword-face fontified t) 465 474 (fontified t) 474 477 (face font-lock-comment-delimiter-face fontified t) 477 520 (face font-lock-comment-face fontified t) 520 621 (fontified t) 621 632 (face font-lock-builtin-face fontified t) 632 633 (fontified t) 633 640 (face font-lock-builtin-face fontified t) 640 641 (fontified t) 641 650 (face font-lock-builtin-face fontified t) 650 651 (fontified t) 651 658 (face font-lock-string-face fontified t) 658 659 (fontified t) 659 663 (face font-lock-builtin-face fontified t) 663 773 (fontified t) 773 784 (face font-lock-builtin-face fontified t) 784 785 (fontified t) 785 794 (face font-lock-builtin-face fontified t) 794 795 (fontified t) 795 804 (face font-lock-builtin-face fontified t) 804 805 (fontified t) 805 812 (face font-lock-string-face fontified t) 812 813 (fontified t) 813 817 (face font-lock-builtin-face fontified t) 817 930 (fontified t) 930 941 (face font-lock-builtin-face fontified t) 941 942 (fontified t) 942 954 (face font-lock-builtin-face fontified t) 954 955 (fontified t) 955 964 (face font-lock-builtin-face fontified t) 964 965 (fontified t) 965 972 (face font-lock-string-face fontified t) 972 973 (fontified t) 973 977 (face font-lock-builtin-face fontified t) 977 1084 (fontified t) 1084 1095 (face font-lock-builtin-face fontified t) 1095 1096 (fontified t) 1096 1102 (face font-lock-builtin-face fontified t) 1102 1103 (fontified t) 1103 1112 (face font-lock-builtin-face fontified t) 1112 1113 (fontified t) 1113 1120 (face font-lock-string-face fontified t) 1120 1121 (fontified t) 1121 1125 (face font-lock-builtin-face fontified t) 1125 1141 (fontified t) 1141 1144 (face font-lock-comment-delimiter-face fontified t) 1144 1172 (face font-lock-comment-face fontified t) 1172 1272 (fontified t) 1272 1281 (face font-lock-builtin-face fontified t) 1281 1282 (fontified t) 1282 1289 (face font-lock-string-face fontified t) 1289 1290 (fontified t) 1290 1294 (face font-lock-builtin-face fontified t) 1294 1410 (fontified t) 1410 1419 (face font-lock-builtin-face fontified t) 1419 1420 (fontified t) 1420 1427 (face font-lock-string-face fontified t) 1427 1428 (fontified t) 1428 1432 (face font-lock-builtin-face fontified t) 1432 1540 (fontified t) 1540 1549 (face font-lock-builtin-face fontified t) 1549 1550 (fontified t) 1550 1557 (face font-lock-string-face fontified t) 1557 1558 (fontified t) 1558 1562 (face font-lock-builtin-face fontified t) 1562 1578 (fontified t) 1578 1581 (face font-lock-comment-delimiter-face fontified t) 1581 1618 (face font-lock-comment-face fontified t) 1618 1704 (fontified t) 1704 1713 (face font-lock-builtin-face fontified t) 1713 1714 (fontified t) 1714 1721 (face font-lock-string-face fontified t) 1721 1722 (fontified t) 1722 1726 (face font-lock-builtin-face fontified t) 1726 1811 (fontified t) 1811 1819 (fontified t) 1819 1828 (face font-lock-builtin-face fontified t) 1828 1829 (fontified t) 1829 1836 (face font-lock-string-face fontified t) 1836 1837 (fontified t) 1837 1841 (face font-lock-builtin-face fontified t) 1841 1848 (fontified t) 1848 1938 (fontified t) 1938 1942 (face font-lock-builtin-face fontified t) 1942 1950 (fontified t) 1950 1953 (face font-lock-comment-delimiter-face fontified t) 1953 1998 (face font-lock-comment-face fontified t) 1998 2007 (fontified t) 2007 2010 (face font-lock-comment-delimiter-face fontified t) 2010 2023 (face font-lock-comment-face fontified t) 2023 2060 (fontified t) 2060 2068 (face font-lock-builtin-face fontified t) 2068 2073 (fontified t) 2073 2082 (face font-lock-builtin-face fontified t) 2082 2092 (fontified t)) . -2730) (undo-tree-id5 . -2092) (undo-tree-id6 . -670) 4822 (t 26802 54107 0 0)) nil (26807 58583 627308 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5076 . 5077) (nil fontified nil 2730 . 5077) (2730 . 5077)) nil (26807 58583 627305 0) 0 nil])
([nil nil ((5077 . 5078)) nil (26807 58583 627304 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5492 . 5493) (nil fontified nil 5078 . 5493) (5078 . 5493)) nil (26807 58583 627303 0) 0 nil])
([nil nil ((#("
(defun translate-db-error (condition)
  \"Mappe et **signale** la condition Lumen correspondante.\"
  (error (map-db-error condition)))
" 0 1 (fontified t) 1 2 (fontified t) 2 7 (face font-lock-keyword-face fontified t) 7 8 (fontified t) 8 26 (face font-lock-function-name-face fontified t) 26 41 (fontified t) 41 98 (face font-lock-doc-face fontified t) 98 102 (fontified t) 102 107 (face font-lock-warning-face fontified t) 107 135 (fontified t)) . -5493) (undo-tree-id0 . -135) (undo-tree-id1 . -135) (undo-tree-id2 . -1) (undo-tree-id3 . -1) (undo-tree-id4 . -135) 5628) nil (26807 58583 627300 0) 0 nil])
([nil current ((3416 . 3418) (t 26807 58583 0 0)) nil (26807 58643 913914 0) 0 nil])
nil
